var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,n=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,i=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,s=(t,s)=>{for(var o in s||(s={}))e.call(s,o)&&i(t,o,s[o]);if(n)for(var o of n(s))r.call(s,o)&&i(t,o,s[o]);return t},o=(t,i)=>{var s={};for(var o in t)e.call(t,o)&&i.indexOf(o)<0&&(s[o]=t[o]);if(null!=t&&n)for(var o of n(t))i.indexOf(o)<0&&r.call(t,o)&&(s[o]=t[o]);return s},a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(t){var e={exports:{}};return t(e,e.exports),e.exports}var c=u((function(t,e){t.exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},n="\n";function r(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function s(t,e){t||i(e)}function o(t){return t?": "+t:""}function a(t,e,n){t in e||i("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join())}function u(e,n){t(e)||i("invalid parameter type"+o(n)+". must be a typed array")}function c(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function l(t,e,n){c(t,e)||i("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t)}function h(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+o(e)+". must be a nonnegative integer")}function f(t,e,n){e.indexOf(t)<0&&i("invalid value"+o(n)+". must be one of: "+e)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(t){Object.keys(t).forEach((function(t){d.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+d)}))}function m(t,e){for(t+="";t.length<e;)t=" "+t;return t}function g(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function _(t,e){this.number=t,this.line=e,this.errors=[]}function v(t,e,n){this.file=t,this.line=e,this.message=n}function y(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function b(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function x(t,e){var n=t.split("\n"),i=1,s=0,o={unknown:new g,0:new g};o.unknown.name=o[0].name=e||y(),o.unknown.lines.push(new _(0,""));for(var a=0;a<n.length;++a){var u=n[a],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(c[2]);l&&(i=0|l[1],l[2]&&((s=0|l[2])in o||(o[s]=new g)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);h&&(o[s].name=h[1]?r(h[2]):h[2])}o[s].lines.push(new _(i++,u))}return Object.keys(o).forEach((function(t){var e=o[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),o}function w(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new v(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new v("unknown",0,t))}})),e}function A(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function T(t,e,r,i,o){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var a=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";I(r,"string",u+" shader source must be a string",o);var c=x(r,o),l=w(a);A(c,l),Object.keys(c).forEach((function(t){var e=c[t];if(e.hasErrors){var r=[""],i=[""];s("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){s(m(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),s(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(r){var i=r.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(o){var a=o[1];switch(i=o[2],a){case"assign":a="="}e=Math.max(t.line.indexOf(a,e),0)}else e=0;s(m("| ",6)),s(m("^^^",e+3)+n,"font-weight:bold"),s(m("| ",6)),s(i+n,"font-weight:bold")})),s(m("| ",6)+n)}else s(m(t.number,4)+"|  "),s(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function s(t,e){r.push(t),i.push(e||"")}})),s.raise("Error compiling "+u+" shader, "+c[0].name)}}function S(t,e,r,i,o){if(!t.getProgramParameter(e,t.LINK_STATUS)){var a=t.getProgramInfoLog(e),u=x(r,o),c='Error linking program with vertex shader, "'+x(i,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+c+n+"%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+n+a),s.raise(c)}}function k(t){t._commandRef=y()}function C(t,e,n,r){function i(t){return t?r.id(t):0}function s(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}k(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var o=t._uniformSet={};s(o,e.static),s(o,e.dynamic);var a=t._attributeSet={};s(a,n.static),s(a,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function O(t,e){var n=b();i(t+" in command "+(e||y())+("unknown"===n?"":" called from "+n))}function E(t,e,n){t||O(e,n||y())}function M(t,e,n,r){t in e||O("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join(),r||y())}function I(t,e,n,r){c(t,e)||O("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t,r||y())}function D(t){t()}function R(t,e,n){t.texture?f(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):f(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var N=33071,V=9728,j=9984,F=9985,P=9986,q=9987,B=5121,L=5122,W=5123,U=5124,z=5125,H=5126,G=32819,X=32820,Y=33635,Q=34042,Z=36193,$={};function J(t,e){return t===X||t===G||t===Y?2:t===Q?4:$[t]*e}function K(t){return!(t&t-1||!t)}function tt(t,e,n){var r,i=e.width,o=e.height,a=e.channels;s(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),t.wrapS===N&&t.wrapT===N||s(K(i)&&K(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==o&&s(t.minFilter!==j&&t.minFilter!==P&&t.minFilter!==F&&t.minFilter!==q,"min filter requires mipmap"):(s(K(i)&&K(o),"texture must be a square power of 2 to support mipmapping"),s(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===H&&(n.extensions.indexOf("oes_texture_float_linear")<0&&s(t.minFilter===V&&t.magFilter===V,"filter not supported, must enable oes_texture_float_linear"),s(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,l=o>>r;s(e.mipmask&1<<r,"missing mipmap data");var h=u[r];if(s(h.width===c&&h.height===l,"invalid shape for mip images"),s(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(J(h.type,a)*c/h.unpackAlignment)*h.unpackAlignment;s(h.data.byteLength===f*l,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||s(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&s(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,n,r){var i=t.width,o=t.height,a=t.channels;s(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),s(i===o,"cube map must be square"),s(e.wrapS===N&&e.wrapT===N,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];s(c.width===i&&c.height===o,"inconsistent cube map face shape"),e.genMipmaps&&(s(!c.compressed,"can not generate mipmap for compressed textures"),s(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,h=0;h<16;++h){var f=l[h];if(f){var d=i>>h,p=o>>h;s(c.mipmask&1<<h,"missing mipmap data"),s(f.width===d&&f.height===p,"invalid shape for mip images"),s(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed||(f.data?s(f.data.byteLength===d*p*Math.max(J(f.type,a),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}$[5120]=$[B]=1,$[L]=$[W]=$[Z]=$[Y]=$[G]=$[X]=2,$[U]=$[z]=$[H]=$[Q]=4;var nt=e(s,{optional:D,raise:i,commandRaise:O,command:E,parameter:a,commandParameter:M,constructor:p,type:l,commandType:I,isTypedArray:u,nni:h,oneOf:f,shaderError:T,linkError:S,callSite:b,saveCommandRef:k,saveDrawInfo:C,framebufferFormat:R,guessCommand:y,texture2D:tt,textureCube:et}),rt=0,it=0,st=5,ot=6;function at(t,e){this.id=rt++,this.type=t,this.data=e}function ut(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ct(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+ut(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return ct(t.substr(0,r.index)).concat(ct(r[1])).concat(ct(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+ut(t)+'"'];for(var s=[],o=0;o<i.length;++o)s=s.concat(ct(i[o]));return s}function lt(t){return"["+ct(t).join("][")+"]"}function ht(t,e){return new at(t,lt(e+""))}function ft(t){return"function"==typeof t&&!t._reglType||t instanceof at}function dt(t,e){return"function"==typeof t?new at(it,t):"number"==typeof t||"boolean"==typeof t?new at(st,t):Array.isArray(t)?new at(ot,t.map((function(t,n){return dt(t,e+"["+n+"]")}))):t instanceof at?t:void nt(!1,"invalid option type in uniform "+e)}var pt={DynamicVariable:at,define:ht,isDynamic:ft,unbox:dt,accessor:lt},mt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},gt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function _t(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function vt(t,n,r){var i,s=document.createElement("canvas");function o(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=s.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}s.width=r*e,s.height=r*n}function a(){i?i.disconnect():window.removeEventListener("resize",o),t.removeChild(s)}return e(s.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(s),t===document.body&&(s.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(o)}))).observe(t):window.addEventListener("resize",o,!1),o(),{canvas:s,onDestroy:a}}function yt(t,e){function n(n){try{return t.getContext(n,e)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function bt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function xt(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function wt(t){return"string"==typeof t?t.split():(nt(Array.isArray(t),"invalid extension array"),t)}function At(t){return"string"==typeof t?(nt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function Tt(t){var e,n,r,i,s=t||{},o={},a=[],u=[],c="undefined"==typeof window?1:window.devicePixelRatio,l=!1,h=function(t){t&&nt.raise(t)},f=function(){};if("string"==typeof s?(nt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),e=document.querySelector(s),nt(e,"invalid query string for element")):"object"==typeof s?bt(s)?e=s:xt(s)?r=(i=s).canvas:(nt.constructor(s),"gl"in s?i=s.gl:"canvas"in s?r=At(s.canvas):"container"in s&&(n=At(s.container)),"attributes"in s&&(o=s.attributes,nt.type(o,"object","invalid context attributes")),"extensions"in s&&(a=wt(s.extensions)),"optionalExtensions"in s&&(u=wt(s.optionalExtensions)),"onDone"in s&&(nt.type(s.onDone,"function","invalid or missing onDone callback"),h=s.onDone),"profile"in s&&(l=!!s.profile),"pixelRatio"in s&&(c=+s.pixelRatio,nt(c>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){nt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=vt(n||document.body,h,c);if(!d)return null;r=d.canvas,f=d.onDestroy}void 0===o.premultipliedAlpha&&(o.premultipliedAlpha=!0),i=yt(r,o)}return i?{gl:i,canvas:r,container:n,extensions:a,optionalExtensions:u,pixelRatio:c,profile:l,onDone:h,onDestroy:f}:(f(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function St(t,e){var n={};function r(e){nt.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=t.getExtension(i)}catch(s){}return!!r}for(var i=0;i<e.extensions.length;++i){var s=e.extensions[i];if(!r(s))return e.onDestroy(),e.onDone('"'+s+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function kt(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var Ct=5120,Ot=5121,Et=5122,Mt=5123,It=5124,Dt=5125,Rt=5126;function Nt(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Vt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function jt(){var t=kt(8,(function(){return[]}));function e(e){var n=Nt(e),r=t[Vt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[Vt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case Ct:r=new Int8Array(e(n),0,n);break;case Ot:r=new Uint8Array(e(n),0,n);break;case Et:r=new Int16Array(e(2*n),0,n);break;case Mt:r=new Uint16Array(e(2*n),0,n);break;case It:r=new Int32Array(e(4*n),0,n);break;case Dt:r=new Uint32Array(e(4*n),0,n);break;case Rt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Ft=jt();Ft.zero=jt();var Pt=3408,qt=3410,Bt=3411,Lt=3412,Wt=3413,Ut=3414,zt=3415,Ht=33901,Gt=33902,Xt=3379,Yt=3386,Qt=34921,Zt=36347,$t=36348,Jt=35661,Kt=35660,te=34930,ee=36349,ne=34076,re=34024,ie=7936,se=7937,oe=7938,ae=35724,ue=34047,ce=36063,le=34852,he=3553,fe=34067,de=34069,pe=33984,me=6408,ge=5126,_e=5121,ve=36160,ye=36053,be=36064,xe=16384,we=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ue));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(le),i=t.getParameter(ce));var s=!!e.oes_texture_float;if(s){var o=t.createTexture();t.bindTexture(he,o),t.texImage2D(he,0,me,1,1,0,me,ge,null);var a=t.createFramebuffer();if(t.bindFramebuffer(ve,a),t.framebufferTexture2D(ve,be,he,o,0),t.bindTexture(he,null),t.checkFramebufferStatus(ve)!==ye)s=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(xe);var u=Ft.allocType(ge,4);t.readPixels(0,0,1,1,me,ge,u),t.getError()?s=!1:(t.deleteFramebuffer(a),t.deleteTexture(o),s=1===u[0]),Ft.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=t.createTexture(),h=Ft.allocType(_e,36);t.activeTexture(pe),t.bindTexture(fe,l),t.texImage2D(de,0,me,3,3,0,me,_e,h),Ft.freeType(h),t.bindTexture(fe,null),t.deleteTexture(l),c=!t.getError()}return{colorBits:[t.getParameter(qt),t.getParameter(Bt),t.getParameter(Lt),t.getParameter(Wt)],depthBits:t.getParameter(Ut),stencilBits:t.getParameter(zt),subpixelBits:t.getParameter(Pt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(Ht),lineWidthDims:t.getParameter(Gt),maxViewportDims:t.getParameter(Yt),maxCombinedTextureUnits:t.getParameter(Jt),maxCubeMapSize:t.getParameter(ne),maxRenderbufferSize:t.getParameter(re),maxTextureUnits:t.getParameter(te),maxTextureSize:t.getParameter(Xt),maxAttributes:t.getParameter(Qt),maxVertexUniforms:t.getParameter(Zt),maxVertexTextureUnits:t.getParameter(Kt),maxVaryingVectors:t.getParameter($t),maxFragmentUniforms:t.getParameter(ee),glsl:t.getParameter(ae),renderer:t.getParameter(se),vendor:t.getParameter(ie),version:t.getParameter(oe),readFloat:s,npotTextureCube:c}};function Ae(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var Te=function(t){return Object.keys(t).map((function(e){return t[e]}))},Se={shape:Ie,flatten:Me};function ke(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Ce(t,e,n,r){for(var i=0,s=0;s<e;++s)for(var o=t[s],a=0;a<n;++a)r[i++]=o[a]}function Oe(t,e,n,r,i,s){for(var o=s,a=0;a<e;++a)for(var u=t[a],c=0;c<n;++c)for(var l=u[c],h=0;h<r;++h)i[o++]=l[h]}function Ee(t,e,n,r,i){for(var s=1,o=n+1;o<e.length;++o)s*=e[o];var a=e[n];if(e.length-n==4){var u=e[n+1],c=e[n+2],l=e[n+3];for(o=0;o<a;++o)Oe(t[o],u,c,l,r,i),i+=s}else for(o=0;o<a;++o)Ee(t[o],e,n+1,r,i),i+=s}function Me(t,e,n,r){var i=1;if(e.length)for(var s=0;s<e.length;++s)i*=e[s];else i=0;var o=r||Ft.allocType(n,i);switch(e.length){case 0:break;case 1:ke(t,e[0],o);break;case 2:Ce(t,e[0],e[1],o);break;case 3:Oe(t,e[0],e[1],e[2],o,0);break;default:Ee(t,e,0,o,0)}return o}function Ie(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var De={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Re={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Ne={dynamic:35048,stream:35040,static:35044},Ve=Se.flatten,je=Se.shape,Fe=35044,Pe=35040,qe=5121,Be=5126,Le=[];function We(t){return 0|De[Object.prototype.toString.call(t)]}function Ue(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function ze(t,e,n,r,i,s,o){for(var a=0,u=0;u<n;++u)for(var c=0;c<r;++c)t[a++]=e[i*u+s*c+o]}function He(e,n,r,i){var s=0,o={};function a(t){this.id=s++,this.buffer=e.createBuffer(),this.type=t,this.usage=Fe,this.byteLength=0,this.dimension=1,this.dtype=qe,this.persistentData=null,r.profile&&(this.stats={size:0})}a.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},a.prototype.destroy=function(){d(this)};var u=[];function c(t,e){var n=u.pop();return n||(n=new a(t)),n.bind(),f(n,e,Pe,0,1,!1),n}function l(t){u.push(t)}function h(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function f(e,n,r,i,s,o){var a,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||Be,n.length>0)if(Array.isArray(n[0])){a=je(n);for(var c=1,l=1;l<a.length;++l)c*=a[l];e.dimension=c,h(e,u=Ve(n,a,e.dtype),r),o?e.persistentData=u:Ft.freeType(u)}else if("number"==typeof n[0]){e.dimension=s;var f=Ft.allocType(e.dtype,n.length);Ue(f,n),h(e,f,r),o?e.persistentData=f:Ft.freeType(f)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||We(n[0])||Be,h(e,u=Ve(n,[n.length,n[0].length],e.dtype),r),o?e.persistentData=u:Ft.freeType(u)):nt.raise("invalid buffer data")}else if(t(n))e.dtype=i||We(n),e.dimension=s,h(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ae(n)){a=n.shape;var d=n.stride,p=n.offset,m=0,g=0,_=0,v=0;1===a.length?(m=a[0],g=1,_=d[0],v=0):2===a.length?(m=a[0],g=a[1],_=d[0],v=d[1]):nt.raise("invalid shape"),e.dtype=i||We(n.data)||Be,e.dimension=g;var y=Ft.allocType(e.dtype,m*g);ze(y,n.data,m,g,_,v,p),h(e,y,r),o?e.persistentData=y:Ft.freeType(y)}else n instanceof ArrayBuffer?(e.dtype=qe,e.dimension=s,h(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):nt.raise("invalid buffer data")}function d(t){n.bufferCount--,i(t);var r=t.buffer;nt(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete o[t.id]}function p(i,s,u,c){n.bufferCount++;var l=new a(s);function h(n){var i=Fe,s=null,o=0,a=0,u=1;return Array.isArray(n)||t(n)||Ae(n)||n instanceof ArrayBuffer?s=n:"number"==typeof n?o=0|n:n&&(nt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(nt(null===s||Array.isArray(s)||t(s)||Ae(s),"invalid data for buffer"),s=n.data),"usage"in n&&(nt.parameter(n.usage,Ne,"invalid buffer usage"),i=Ne[n.usage]),"type"in n&&(nt.parameter(n.type,Re,"invalid buffer type"),a=Re[n.type]),"dimension"in n&&(nt.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(nt.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),l.bind(),s?f(l,s,i,a,u,c):(o&&e.bufferData(l.type,o,i),l.dtype=a||qe,l.usage=i,l.dimension=u,l.byteLength=o),r.profile&&(l.stats.size=l.byteLength*Le[l.dtype]),h}function p(t,n){nt(n+t.byteLength<=l.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+l.byteLength),e.bufferSubData(l.type,n,t)}function m(e,n){var r,i=0|(n||0);if(l.bind(),t(e)||e instanceof ArrayBuffer)p(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var s=Ft.allocType(l.dtype,e.length);Ue(s,e),p(s,i),Ft.freeType(s)}else if(Array.isArray(e[0])||t(e[0])){r=je(e);var o=Ve(e,r,l.dtype);p(o,i),Ft.freeType(o)}else nt.raise("invalid buffer data")}else if(Ae(e)){r=e.shape;var a=e.stride,u=0,c=0,f=0,d=0;1===r.length?(u=r[0],c=1,f=a[0],d=0):2===r.length?(u=r[0],c=r[1],f=a[0],d=a[1]):nt.raise("invalid shape");var m=Array.isArray(e.data)?l.dtype:We(e.data),g=Ft.allocType(m,u*c);ze(g,e.data,u,c,f,d,e.offset),p(g,i),Ft.freeType(g)}else nt.raise("invalid data for buffer subdata");return h}return o[l.id]=l,u||h(i),h._reglType="buffer",h._buffer=l,h.subdata=m,r.profile&&(h.stats=l.stats),h.destroy=function(){d(l)},h}function m(){Te(o).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(o).forEach((function(e){t+=o[e].stats.size})),t}),{create:p,createStream:c,destroyStream:l,clear:function(){Te(o).forEach(d),u.forEach(d)},getBuffer:function(t){return t&&t._buffer instanceof a?t._buffer:null},restore:m,_initBuffer:f}}Le[5120]=1,Le[5122]=2,Le[5124]=4,Le[5121]=1,Le[5123]=2,Le[5125]=4,Le[5126]=4;var Ge={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Xe=0,Ye=1,Qe=4,Ze=5120,$e=5121,Je=5122,Ke=5123,tn=5124,en=5125,nn=34963,rn=35040,sn=35044;function on(e,n,r,i){var s={},o=0,a={uint8:$e,uint16:Ke};function u(t){this.id=o++,s[this.id]=this,this.buffer=t,this.primType=Qe,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(a.uint32=en),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(t){var e=c.pop();return e||(e=new u(r.create(null,nn,!0,!1)._buffer)),f(e,t,rn,-1,-1,0,0),e}function h(t){c.push(t)}function f(i,s,o,a,u,c,l){var h;if(i.buffer.bind(),s){var f=l;l||t(s)&&(!Ae(s)||t(s.data))||(f=n.oes_element_index_uint?en:Ke),r._initBuffer(i.buffer,s,o,f,3)}else e.bufferData(nn,c,o),i.buffer.dtype=h||$e,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=c;if(h=l,!l){switch(i.buffer.dtype){case $e:case Ze:h=$e;break;case Ke:case Je:h=Ke;break;case en:case tn:h=en;break;default:nt.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,nt(h!==en||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=u;d<0&&(d=i.buffer.byteLength,h===Ke?d>>=1:h===en&&(d>>=2)),i.vertCount=d;var p=a;if(a<0){p=Qe;var m=i.buffer.dimension;1===m&&(p=Xe),2===m&&(p=Ye),3===m&&(p=Qe)}i.primType=p}function d(t){i.elementsCount--,nt(null!==t.buffer,"must not double destroy elements"),delete s[t.id],t.buffer.destroy(),t.buffer=null}function p(e,n){var s=r.create(null,nn,!0),o=new u(s._buffer);function c(e){if(e)if("number"==typeof e)s(e),o.primType=Qe,o.vertCount=0|e,o.type=$e;else{var n=null,r=sn,i=-1,u=-1,l=0,h=0;Array.isArray(e)||t(e)||Ae(e)?n=e:(nt.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,nt(Array.isArray(n)||t(n)||Ae(n),"invalid data for element buffer")),"usage"in e&&(nt.parameter(e.usage,Ne,"invalid element buffer usage"),r=Ne[e.usage]),"primitive"in e&&(nt.parameter(e.primitive,Ge,"invalid element buffer primitive"),i=Ge[e.primitive]),"count"in e&&(nt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(nt.parameter(e.type,a,"invalid buffer type"),h=a[e.type]),"length"in e?l=0|e.length:(l=u,h===Ke||h===Je?l*=2:h!==en&&h!==tn||(l*=4))),f(o,n,r,i,u,l,h)}else s(),o.primType=Qe,o.vertCount=0,o.type=$e;return c}return i.elementsCount++,c(e),c._reglType="elements",c._elements=o,c.subdata=function(t,e){return s.subdata(t,e),c},c.destroy=function(){d(o)},c}return{create:p,createStream:l,destroyStream:h,getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){Te(s).forEach(d)}}}var an=new Float32Array(1),un=new Uint32Array(an.buffer),cn=5123;function ln(t){for(var e=Ft.allocType(cn,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{an[0]=t[n];var r=un[0],i=r>>>31<<15,s=(r<<1>>>24)-127,o=r>>13&1023;if(s<-24)e[n]=i;else if(s<-14){var a=-14-s;e[n]=i+(o+1024>>a)}else e[n]=s>15?i+31744:i+(s+15<<10)+o}return e}function hn(e){return Array.isArray(e)||t(e)}var fn=function(t){return!(t&t-1||!t)},dn=34467,pn=3553,mn=34067,gn=34069,_n=6408,vn=6406,yn=6407,bn=6409,xn=6410,wn=32854,An=32855,Tn=36194,Sn=32819,kn=32820,Cn=33635,On=34042,En=6402,Mn=34041,In=35904,Dn=35906,Rn=36193,Nn=33776,Vn=33777,jn=33778,Fn=33779,Pn=35986,qn=35987,Bn=34798,Ln=35840,Wn=35841,Un=35842,zn=35843,Hn=36196,Gn=5121,Xn=5123,Yn=5125,Qn=5126,Zn=10242,$n=10243,Jn=10497,Kn=33071,tr=33648,er=10240,nr=10241,rr=9728,ir=9729,sr=9984,or=9985,ar=9986,ur=9987,cr=33170,lr=4352,hr=4353,fr=4354,dr=34046,pr=3317,mr=37440,gr=37441,_r=37443,vr=37444,yr=33984,br=[sr,ar,or,ur],xr=[0,bn,xn,yn,_n],wr={};function Ar(t){return"[object "+t+"]"}wr[bn]=wr[vn]=wr[En]=1,wr[Mn]=wr[xn]=2,wr[yn]=wr[In]=3,wr[_n]=wr[Dn]=4;var Tr=Ar("HTMLCanvasElement"),Sr=Ar("OffscreenCanvas"),kr=Ar("CanvasRenderingContext2D"),Cr=Ar("ImageBitmap"),Or=Ar("HTMLImageElement"),Er=Ar("HTMLVideoElement"),Mr=Object.keys(De).concat([Tr,Sr,kr,Cr,Or,Er]),Ir=[];Ir[Gn]=1,Ir[Qn]=4,Ir[Rn]=2,Ir[Xn]=2,Ir[Yn]=4;var Dr=[];function Rr(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Nr(t){return!!Array.isArray(t)&&!(0===t.length||!hn(t[0]))}function Vr(t){return Object.prototype.toString.call(t)}function jr(t){return Vr(t)===Tr}function Fr(t){return Vr(t)===Sr}function Pr(t){return Vr(t)===kr}function qr(t){return Vr(t)===Cr}function Br(t){return Vr(t)===Or}function Lr(t){return Vr(t)===Er}function Wr(t){if(!t)return!1;var e=Vr(t);return Mr.indexOf(e)>=0||Rr(t)||Nr(t)||Ae(t)}function Ur(t){return 0|De[Object.prototype.toString.call(t)]}function zr(t,e){var n=e.length;switch(t.type){case Gn:case Xn:case Yn:case Qn:var r=Ft.allocType(t.type,n);r.set(e),t.data=r;break;case Rn:t.data=ln(e);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Hr(t,e){return Ft.allocType(t.type===Rn?Qn:t.type,e)}function Gr(t,e){t.type===Rn?(t.data=ln(e),Ft.freeType(e)):t.data=e}function Xr(t,e,n,r,i,s){for(var o=t.width,a=t.height,u=t.channels,c=Hr(t,o*a*u),l=0,h=0;h<a;++h)for(var f=0;f<o;++f)for(var d=0;d<u;++d)c[l++]=e[n*f+r*h+i*d+s];Gr(t,c)}function Yr(t,e,n,r,i,s){var o;if(o=void 0!==Dr[t]?Dr[t]:wr[t]*Ir[e],s&&(o*=6),i){for(var a=0,u=n;u>=1;)a+=o*u*u,u/=2;return a}return o*n*r}function Qr(n,r,i,s,o,a,u){var c={"don't care":lr,"dont care":lr,nice:fr,fast:hr},l={repeat:Jn,clamp:Kn,mirror:tr},h={nearest:rr,linear:ir},f=e({mipmap:ur,"nearest mipmap nearest":sr,"linear mipmap nearest":or,"nearest mipmap linear":ar,"linear mipmap linear":ur},h),d={none:0,browser:vr},p={uint8:Gn,rgba4:Sn,rgb565:Cn,"rgb5 a1":kn},m={alpha:vn,luminance:bn,"luminance alpha":xn,rgb:yn,rgba:_n,rgba4:wn,"rgb5 a1":An,rgb565:Tn},g={};r.ext_srgb&&(m.srgb=In,m.srgba=Dn),r.oes_texture_float&&(p.float32=p.float=Qn),r.oes_texture_half_float&&(p.float16=p["half float"]=Rn),r.webgl_depth_texture&&(e(m,{depth:En,"depth stencil":Mn}),e(p,{uint16:Xn,uint32:Yn,"depth stencil":On})),r.webgl_compressed_texture_s3tc&&e(g,{"rgb s3tc dxt1":Nn,"rgba s3tc dxt1":Vn,"rgba s3tc dxt3":jn,"rgba s3tc dxt5":Fn}),r.webgl_compressed_texture_atc&&e(g,{"rgb atc":Pn,"rgba atc explicit alpha":qn,"rgba atc interpolated alpha":Bn}),r.webgl_compressed_texture_pvrtc&&e(g,{"rgb pvrtc 4bppv1":Ln,"rgb pvrtc 2bppv1":Wn,"rgba pvrtc 4bppv1":Un,"rgba pvrtc 2bppv1":zn}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=Hn);var _=Array.prototype.slice.call(n.getParameter(dn));Object.keys(g).forEach((function(t){var e=g[t];_.indexOf(e)>=0&&(m[t]=e)}));var v=Object.keys(m);i.textureFormats=v;var y=[];Object.keys(m).forEach((function(t){var e=m[t];y[e]=t}));var b=[];Object.keys(p).forEach((function(t){var e=p[t];b[e]=t}));var x=[];Object.keys(h).forEach((function(t){var e=h[t];x[e]=t}));var w=[];Object.keys(f).forEach((function(t){var e=f[t];w[e]=t}));var A=[];Object.keys(l).forEach((function(t){var e=l[t];A[e]=t}));var T=v.reduce((function(t,e){var n=m[e];return n===bn||n===vn||n===bn||n===xn||n===En||n===Mn||r.ext_srgb&&(n===In||n===Dn)?t[n]=n:n===An||e.indexOf("rgba")>=0?t[n]=_n:t[n]=yn,t}),{});function S(){this.internalformat=_n,this.format=_n,this.type=Gn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=vr,this.width=0,this.height=0,this.channels=0}function k(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function C(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(nt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(nt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(nt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(nt.parameter(e.colorSpace,d,"invalid colorSpace"),t.colorSpace=d[e.colorSpace]),"type"in e){var n=e.type;nt(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(n,p,"invalid texture type"),t.type=p[n]}var s=t.width,o=t.height,a=t.channels,u=!1;"shape"in e?(nt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),s=e.shape[0],o=e.shape[1],3===e.shape.length&&(a=e.shape[2],nt(a>0&&a<=4,"invalid number of channels"),u=!0),nt(s>=0&&s<=i.maxTextureSize,"invalid width"),nt(o>=0&&o<=i.maxTextureSize,"invalid height")):("radius"in e&&(s=o=e.radius,nt(s>=0&&s<=i.maxTextureSize,"invalid radius")),"width"in e&&(s=e.width,nt(s>=0&&s<=i.maxTextureSize,"invalid width")),"height"in e&&(o=e.height,nt(o>=0&&o<=i.maxTextureSize,"invalid height")),"channels"in e&&(a=e.channels,nt(a>0&&a<=4,"invalid number of channels"),u=!0)),t.width=0|s,t.height=0|o,t.channels=0|a;var c=!1;if("format"in e){var l=e.format;nt(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(l,m,"invalid texture format");var h=t.internalformat=m[l];t.format=T[h],l in p&&("type"in e||(t.type=p[l])),l in g&&(t.compressed=!0),c=!0}!u&&c?t.channels=wr[t.format]:u&&!c?t.channels!==xr[t.format]&&(t.format=t.internalformat=xr[t.channels]):c&&u&&nt(t.channels===wr[t.format],"number of channels inconsistent with specified format")}}function O(t){n.pixelStorei(mr,t.flipY),n.pixelStorei(gr,t.premultiplyAlpha),n.pixelStorei(_r,t.colorSpace),n.pixelStorei(pr,t.unpackAlignment)}function E(){S.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function M(e,n){var r=null;if(Wr(n)?r=n:n&&(nt.type(n,"object","invalid pixel data type"),C(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Wr(n.data)&&(r=n.data)),nt(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){nt(!r,"can not specify copy and data field for the same texture");var s=o.viewportWidth,a=o.viewportHeight;e.width=e.width||s-e.xOffset,e.height=e.height||a-e.yOffset,e.needsCopy=!0,nt(e.xOffset>=0&&e.xOffset<s&&e.yOffset>=0&&e.yOffset<a&&e.width>0&&e.width<=s&&e.height>0&&e.height<=a,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==Gn||(e.type=Ur(r));else if(Rr(r))e.channels=e.channels||4,zr(e,r),e.alignment=1,e.needsFree=!0;else if(Ae(r)){var u=r.data;Array.isArray(u)||e.type!==Gn||(e.type=Ur(u));var c,l,h,f,d,p,m=r.shape,g=r.stride;3===m.length?(h=m[2],p=g[2]):(nt(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,p=1),c=m[0],l=m[1],f=g[0],d=g[1],e.alignment=1,e.width=c,e.height=l,e.channels=h,e.format=e.internalformat=xr[h],e.needsFree=!0,Xr(e,u,f,d,p,r.offset)}else if(jr(r)||Fr(r)||Pr(r))jr(r)||Fr(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(qr(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(Br(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Lr(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(Nr(r)){var _=e.width||r[0].length,v=e.height||r.length,y=e.channels;y=hn(r[0][0])?y||r[0][0].length:y||1;for(var b=Se.shape(r),x=1,w=0;w<b.length;++w)x*=b[w];var A=Hr(e,x);Se.flatten(r,b,"",A),Gr(e,A),e.alignment=1,e.width=_,e.height=v,e.channels=y,e.format=e.internalformat=xr[y],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Qn?nt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===Rn&&nt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function I(t,e,r){var i=t.element,o=t.data,a=t.internalformat,u=t.format,c=t.type,l=t.width,h=t.height;O(t),i?n.texImage2D(e,r,u,u,c,i):t.compressed?n.compressedTexImage2D(e,r,a,l,h,0,o):t.needsCopy?(s(),n.copyTexImage2D(e,r,u,t.xOffset,t.yOffset,l,h,0)):n.texImage2D(e,r,u,l,h,0,u,c,o||null)}function D(t,e,r,i,o){var a=t.element,u=t.data,c=t.internalformat,l=t.format,h=t.type,f=t.width,d=t.height;O(t),a?n.texSubImage2D(e,o,r,i,l,h,a):t.compressed?n.compressedTexSubImage2D(e,o,r,i,c,f,d,u):t.needsCopy?(s(),n.copyTexSubImage2D(e,o,r,i,t.xOffset,t.yOffset,f,d)):n.texSubImage2D(e,o,r,i,f,d,l,h,u)}var R=[];function N(){return R.pop()||new E}function V(t){t.needsFree&&Ft.freeType(t.data),E.call(t),R.push(t)}function j(){S.call(this),this.genMipmaps=!1,this.mipmapHint=lr,this.mipmask=0,this.images=Array(16)}function F(t,e,n){var r=t.images[0]=N();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function P(t,e){var n=null;if(Wr(e))k(n=t.images[0]=N(),t),M(n,e),t.mipmask=1;else if(C(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)k(n=t.images[i]=N(),t),n.width>>=i,n.height>>=i,M(n,r[i]),t.mipmask|=1<<i;else k(n=t.images[0]=N(),t),M(n,e),t.mipmask=1;k(t,t.images[0]),!t.compressed||t.internalformat!==Nn&&t.internalformat!==Vn&&t.internalformat!==jn&&t.internalformat!==Fn||nt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function q(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;I(n[r],e,r)}}var B=[];function L(){var t=B.pop()||new j;S.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function W(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&V(e[n]),e[n]=null;B.push(t)}function U(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Kn,this.wrapT=Kn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=lr}function z(t,e){if("min"in e){var n=e.min;nt.parameter(n,f),t.minFilter=f[n],br.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;nt.parameter(r,h),t.magFilter=h[r]}var s=t.wrapS,o=t.wrapT;if("wrap"in e){var a=e.wrap;"string"==typeof a?(nt.parameter(a,l),s=o=l[a]):Array.isArray(a)&&(nt.parameter(a[0],l),nt.parameter(a[1],l),s=l[a[0]],o=l[a[1]])}else{if("wrapS"in e){var u=e.wrapS;nt.parameter(u,l),s=l[u]}if("wrapT"in e){var d=e.wrapT;nt.parameter(d,l),o=l[d]}}if(t.wrapS=s,t.wrapT=o,"anisotropic"in e){var p=e.anisotropic;nt("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var m=!1;switch(typeof e.mipmap){case"string":nt.parameter(e.mipmap,c,"invalid mipmap hint"),t.mipmapHint=c[e.mipmap],t.genMipmaps=!0,m=!0;break;case"boolean":m=t.genMipmaps=e.mipmap;break;case"object":nt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,m=!0;break;default:nt.raise("invalid mipmap type")}m&&!("min"in e)&&(t.minFilter=sr)}}function H(t,e){n.texParameteri(e,nr,t.minFilter),n.texParameteri(e,er,t.magFilter),n.texParameteri(e,Zn,t.wrapS),n.texParameteri(e,$n,t.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(e,dr,t.anisotropic),t.genMipmaps&&(n.hint(cr,t.mipmapHint),n.generateMipmap(e))}var G=0,X={},Y=i.maxTextureUnits,Q=Array(Y).map((function(){return null}));function Z(t){S.call(this),this.mipmask=0,this.internalformat=_n,this.id=G++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new U,u.profile&&(this.stats={size:0})}function $(t){n.activeTexture(yr),n.bindTexture(t.target,t.texture)}function J(){var t=Q[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(pn,null)}function K(t){var e=t.texture;nt(e,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(n.activeTexture(yr+r),n.bindTexture(i,null),Q[r]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete X[t.id],a.textureCount--}function tt(t,e){var r=new Z(pn);function s(t,e){var n=r.texInfo;U.call(n);var o=L();return"number"==typeof t?F(o,0|t,"number"==typeof e?0|e:0|t):t?(nt.type(t,"object","invalid arguments to regl.texture"),z(n,t),P(o,t)):F(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,k(r,o),nt.texture2D(n,o,i),r.internalformat=o.internalformat,s.width=o.width,s.height=o.height,$(r),q(o,pn),H(n,pn),J(),W(o),u.profile&&(r.stats.size=Yr(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),s.format=y[r.internalformat],s.type=b[r.type],s.mag=x[n.magFilter],s.min=w[n.minFilter],s.wrapS=A[n.wrapS],s.wrapT=A[n.wrapT],s}function o(t,e,n,i){nt(!!t,"must specify image data");var o=0|e,a=0|n,u=0|i,c=N();return k(c,r),c.width=0,c.height=0,M(c,t),c.width=c.width||(r.width>>u)-o,c.height=c.height||(r.height>>u)-a,nt(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),nt(o>=0&&a>=0&&o+c.width<=r.width&&a+c.height<=r.height,"texture.subimage write out of bounds"),nt(r.mipmask&1<<u,"missing mipmap data"),nt(c.data||c.element||c.needsCopy,"missing image data"),$(r),D(c,pn,o,a,u),J(),V(c),s}function c(t,e){var i=0|t,o=0|e||i;if(i===r.width&&o===r.height)return s;s.width=r.width=i,s.height=r.height=o,$(r);for(var a=0;r.mipmask>>a;++a){var c=i>>a,l=o>>a;if(!c||!l)break;n.texImage2D(pn,a,r.format,c,l,0,r.format,r.type,null)}return J(),u.profile&&(r.stats.size=Yr(r.internalformat,r.type,i,o,!1,!1)),s}return X[r.id]=r,a.textureCount++,s(t,e),s.subimage=o,s.resize=c,s._reglType="texture2d",s._texture=r,u.profile&&(s.stats=r.stats),s.destroy=function(){r.decRef()},s}function et(t,e,r,s,o,c){var l=new Z(mn);X[l.id]=l,a.cubeCount++;var h=new Array(6);function f(t,e,n,r,s,o){var a,c=l.texInfo;for(U.call(c),a=0;a<6;++a)h[a]=L();if("number"!=typeof t&&t)if("object"==typeof t)if(e)P(h[0],t),P(h[1],e),P(h[2],n),P(h[3],r),P(h[4],s),P(h[5],o);else if(z(c,t),C(l,t),"faces"in t){var d=t.faces;for(nt(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),a=0;a<6;++a)nt("object"==typeof d[a]&&!!d[a],"invalid input for cube map face"),k(h[a],l),P(h[a],d[a])}else for(a=0;a<6;++a)P(h[a],t);else nt.raise("invalid arguments to cube map");else{var p=0|t||1;for(a=0;a<6;++a)F(h[a],p,p)}for(k(l,h[0]),nt.optional((function(){i.npotTextureCube||nt(fn(l.width)&&fn(l.height),"your browser does not support non power or two texture dimensions")})),c.genMipmaps?l.mipmask=(h[0].width<<1)-1:l.mipmask=h[0].mipmask,nt.textureCube(l,c,h,i),l.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,$(l),a=0;a<6;++a)q(h[a],gn+a);for(H(c,mn),J(),u.profile&&(l.stats.size=Yr(l.internalformat,l.type,f.width,f.height,c.genMipmaps,!0)),f.format=y[l.internalformat],f.type=b[l.type],f.mag=x[c.magFilter],f.min=w[c.minFilter],f.wrapS=A[c.wrapS],f.wrapT=A[c.wrapT],a=0;a<6;++a)W(h[a]);return f}function d(t,e,n,r,i){nt(!!e,"must specify image data"),nt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var s=0|n,o=0|r,a=0|i,u=N();return k(u,l),u.width=0,u.height=0,M(u,e),u.width=u.width||(l.width>>a)-s,u.height=u.height||(l.height>>a)-o,nt(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),nt(s>=0&&o>=0&&s+u.width<=l.width&&o+u.height<=l.height,"texture.subimage write out of bounds"),nt(l.mipmask&1<<a,"missing mipmap data"),nt(u.data||u.element||u.needsCopy,"missing image data"),$(l),D(u,gn+t,s,o,a),J(),V(u),f}function p(t){var e=0|t;if(e!==l.width){f.width=l.width=e,f.height=l.height=e,$(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(gn+r,i,l.format,e>>i,e>>i,0,l.format,l.type,null);return J(),u.profile&&(l.stats.size=Yr(l.internalformat,l.type,f.width,f.height,!1,!0)),f}}return f(t,e,r,s,o,c),f.subimage=d,f.resize=p,f._reglType="textureCube",f._texture=l,u.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f}function rt(){for(var t=0;t<Y;++t)n.activeTexture(yr+t),n.bindTexture(pn,null),Q[t]=null;Te(X).forEach(K),a.cubeCount=0,a.textureCount=0}function it(){for(var t=0;t<Y;++t){var e=Q[t];e&&(e.bindCount=0,e.unit=-1,Q[t]=null)}Te(X).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(0!=(t.mipmask&1<<e))if(t.target===pn)n.texImage2D(pn,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)n.texImage2D(gn+r,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);H(t.texInfo,t.target)}))}function st(){for(var t=0;t<Y;++t){var e=Q[t];e&&(e.bindCount=0,e.unit=-1,Q[t]=null),n.activeTexture(yr+t),n.bindTexture(pn,null),n.bindTexture(mn,null)}}return e(Z.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var r=0;r<Y;++r){var i=Q[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Q[r]=t,e=r;break}e>=Y&&nt.raise("insufficient number of texture units"),u.profile&&a.maxTextureUnits<e+1&&(a.maxTextureUnits=e+1),t.unit=e,n.activeTexture(yr+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&K(this)}}),u.profile&&(a.getTotalTextureSize=function(){var t=0;return Object.keys(X).forEach((function(e){t+=X[e].stats.size})),t}),{create2D:tt,createCube:et,clear:rt,getTexture:function(t){return null},restore:it,refresh:st}}Dr[wn]=2,Dr[An]=2,Dr[Tn]=2,Dr[Mn]=4,Dr[Nn]=.5,Dr[Vn]=.5,Dr[jn]=1,Dr[Fn]=1,Dr[Pn]=.5,Dr[qn]=1,Dr[Bn]=1,Dr[Ln]=.5,Dr[Wn]=.25,Dr[Un]=.5,Dr[zn]=.25,Dr[Hn]=.5;var Zr=36161,$r=32854,Jr=32855,Kr=36194,ti=33189,ei=36168,ni=34041,ri=35907,ii=34836,si=34842,oi=34843,ai=[];function ui(t,e,n){return ai[t]*e*n}ai[$r]=2,ai[Jr]=2,ai[Kr]=2,ai[ti]=2,ai[ei]=1,ai[ni]=4,ai[ri]=4,ai[ii]=16,ai[si]=8,ai[oi]=6;var ci=function(t,e,n,r,i){var s={rgba4:$r,rgb565:Kr,"rgb5 a1":Jr,depth:ti,stencil:ei,"depth stencil":ni};e.ext_srgb&&(s.srgba=ri),e.ext_color_buffer_half_float&&(s.rgba16f=si,s.rgb16f=oi),e.webgl_color_buffer_float&&(s.rgba32f=ii);var o=[];Object.keys(s).forEach((function(t){var e=s[t];o[e]=t}));var a=0,u={};function c(t){this.id=a++,this.refCount=1,this.renderbuffer=t,this.format=$r,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(e){var n=e.renderbuffer;nt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(Zr,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}function h(e,a){var l=new c(t.createRenderbuffer());function h(e,r){var a=0,u=0,c=$r;if("object"==typeof e&&e){var f=e;if("shape"in f){var d=f.shape;nt(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),a=0|d[0],u=0|d[1]}else"radius"in f&&(a=u=0|f.radius),"width"in f&&(a=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(nt.parameter(f.format,s,"invalid renderbuffer format"),c=s[f.format])}else"number"==typeof e?(a=0|e,u="number"==typeof r?0|r:a):e?nt.raise("invalid arguments to renderbuffer constructor"):a=u=1;if(nt(a>0&&u>0&&a<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),a!==l.width||u!==l.height||c!==l.format)return h.width=l.width=a,h.height=l.height=u,l.format=c,t.bindRenderbuffer(Zr,l.renderbuffer),t.renderbufferStorage(Zr,c,a,u),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=ui(l.format,l.width,l.height)),h.format=o[l.format],h}function f(e,r){var s=0|e,o=0|r||s;return s===l.width&&o===l.height||(nt(s>0&&o>0&&s<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=l.width=s,h.height=l.height=o,t.bindRenderbuffer(Zr,l.renderbuffer),t.renderbufferStorage(Zr,l.format,s,o),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=ui(l.format,l.width,l.height))),h}return u[l.id]=l,r.renderbufferCount++,h(e,a),h.resize=f,h._reglType="renderbuffer",h._renderbuffer=l,i.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h}function f(){Te(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Zr,e.renderbuffer),t.renderbufferStorage(Zr,e.format,e.width,e.height)})),t.bindRenderbuffer(Zr,null)}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:h,clear:function(){Te(u).forEach(l)},restore:f}},li=36160,hi=36161,fi=3553,di=34069,pi=36064,mi=36096,gi=36128,_i=33306,vi=36053,yi=36054,bi=36055,xi=36057,wi=36061,Ai=36193,Ti=5121,Si=5126,ki=6407,Ci=6408,Oi=6402,Ei=[ki,Ci],Mi=[];Mi[Ci]=4,Mi[ki]=3;var Ii=[];Ii[Ti]=1,Ii[Si]=4,Ii[Ai]=2;var Di=33189,Ri=36168,Ni=34041,Vi=[32854,32855,36194,35907,34842,34843,34836],ji={};function Fi(t,n,r,i,s,o){var a={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function h(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function d(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),s=Math.max(1,r.height);nt(i===e&&s===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=t.renderbuffer._renderbuffer;nt(o.width===e&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function p(e,n){n&&(n.texture?t.framebufferTexture2D(li,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(li,e,hi,n.renderbuffer._renderbuffer.renderbuffer))}function m(t){var e=fi,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),nt.type(i,"function","invalid attachment data");var s=i._reglType;return"texture2d"===s?(n=i,nt(e===fi)):"textureCube"===s?(n=i,nt(e>=di&&e<di+6,"invalid cube map target")):"renderbuffer"===s?(r=i,e=hi):nt.raise("invalid regl object for attachment"),new h(e,n,r)}function g(t,e,n,r,o){if(n){var a=i.create2D({width:t,height:e,format:r,type:o});return a._texture.refCount=0,new h(fi,a,null)}var u=s.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new h(hi,null,u)}function _(t){return t&&(t.texture||t.renderbuffer)}function v(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var y=0,b={};function x(){this.id=y++,b[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(f),f(t.depthAttachment),f(t.stencilAttachment),f(t.depthStencilAttachment)}function A(e){var n=e.framebuffer;nt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,o.framebufferCount--,delete b[e.id]}function T(e){var n;t.bindFramebuffer(li,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)p(pi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(li,pi+n,fi,null,0);t.framebufferTexture2D(li,_i,fi,null,0),t.framebufferTexture2D(li,mi,fi,null,0),t.framebufferTexture2D(li,gi,fi,null,0),p(mi,e.depthAttachment),p(gi,e.stencilAttachment),p(_i,e.depthStencilAttachment);var s=t.checkFramebufferStatus(li);t.isContextLost()||s===vi||nt.raise("framebuffer configuration not supported, status = "+ji[s]),t.bindFramebuffer(li,a.next?a.next.framebuffer:null),a.cur=a.next,t.getError()}function S(t,i){var s=new x;function h(t,e){var i;nt(a.next!==s,"can not update framebuffer which is currently in use");var o=0,f=0,p=!0,v=!0,y=null,b=!0,x="rgba",A="uint8",S=1,k=null,C=null,O=null,E=!1;if("number"==typeof t)o=0|t,f=0|e||o;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var M=t;if("shape"in M){var I=M.shape;nt(Array.isArray(I)&&I.length>=2,"invalid shape for framebuffer"),o=I[0],f=I[1]}else"radius"in M&&(o=f=M.radius),"width"in M&&(o=M.width),"height"in M&&(f=M.height);("color"in M||"colors"in M)&&(y=M.color||M.colors,Array.isArray(y)&&nt(1===y.length||n.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in M&&(S=0|M.colorCount,nt(S>0,"invalid color buffer count")),"colorTexture"in M&&(b=!!M.colorTexture,x="rgba4"),"colorType"in M&&(A=M.colorType,b?(nt(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(nt(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==A&&"float32"!==A||(nt(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),nt.oneOf(A,l,"invalid color type")),"colorFormat"in M&&(x=M.colorFormat,u.indexOf(x)>=0?b=!0:c.indexOf(x)>=0?b=!1:nt.optional((function(){b?nt.oneOf(M.colorFormat,u,"invalid color format for texture"):nt.oneOf(M.colorFormat,c,"invalid color format for renderbuffer")})))),("depthTexture"in M||"depthStencilTexture"in M)&&(E=!(!M.depthTexture&&!M.depthStencilTexture),nt(!E||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in M&&("boolean"==typeof M.depth?p=M.depth:(k=M.depth,v=!1)),"stencil"in M&&("boolean"==typeof M.stencil?v=M.stencil:(C=M.stencil,p=!1)),"depthStencil"in M&&("boolean"==typeof M.depthStencil?p=v=M.depthStencil:(O=M.depthStencil,p=!1,v=!1))}else o=f=1;var D=null,R=null,N=null,V=null;if(Array.isArray(y))D=y.map(m);else if(y)D=[m(y)];else for(D=new Array(S),i=0;i<S;++i)D[i]=g(o,f,b,x,A);nt(n.webgl_draw_buffers||D.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(D.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||D[0].width,f=f||D[0].height,k?R=m(k):p&&!v&&(R=g(o,f,E,"depth","uint32")),C?N=m(C):v&&!p&&(N=g(o,f,!1,"stencil","uint8")),O?V=m(O):!k&&!C&&v&&p&&(V=g(o,f,E,"depth stencil","depth stencil")),nt(!!k+!!C+!!O<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var j=null;for(i=0;i<D.length;++i)if(d(D[i],o,f),nt(!D[i]||D[i].texture&&Ei.indexOf(D[i].texture._texture.format)>=0||D[i].renderbuffer&&Vi.indexOf(D[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),D[i]&&D[i].texture){var F=Mi[D[i].texture._texture.format]*Ii[D[i].texture._texture.type];null===j?j=F:nt(j===F,"all color attachments much have the same number of bits per pixel.")}return d(R,o,f),nt(!R||R.texture&&R.texture._texture.format===Oi||R.renderbuffer&&R.renderbuffer._renderbuffer.format===Di,"invalid depth attachment for framebuffer object"),d(N,o,f),nt(!N||N.renderbuffer&&N.renderbuffer._renderbuffer.format===Ri,"invalid stencil attachment for framebuffer object"),d(V,o,f),nt(!V||V.texture&&V.texture._texture.format===Ni||V.renderbuffer&&V.renderbuffer._renderbuffer.format===Ni,"invalid depth-stencil attachment for framebuffer object"),w(s),s.width=o,s.height=f,s.colorAttachments=D,s.depthAttachment=R,s.stencilAttachment=N,s.depthStencilAttachment=V,h.color=D.map(_),h.depth=_(R),h.stencil=_(N),h.depthStencil=_(V),h.width=s.width,h.height=s.height,T(s),h}function f(t,e){nt(a.next!==s,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===s.width&&r===s.height)return h;for(var i=s.colorAttachments,o=0;o<i.length;++o)v(i[o],n,r);return v(s.depthAttachment,n,r),v(s.stencilAttachment,n,r),v(s.depthStencilAttachment,n,r),s.width=h.width=n,s.height=h.height=r,T(s),h}return o.framebufferCount++,h(t,i),e(h,{resize:f,_reglType:"framebuffer",_framebuffer:s,destroy:function(){A(s),w(s)},use:function(t){a.setFBO({framebuffer:h},t)}})}function k(t){var s=Array(6);function o(t){var r;nt(s.indexOf(a.next)<0,"can not update framebuffer which is currently in use");var c,h={color:null},f=0,d=null,p="rgba",m="uint8",g=1;if("number"==typeof t)f=0|t;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var _=t;if("shape"in _){var v=_.shape;nt(Array.isArray(v)&&v.length>=2,"invalid shape for framebuffer"),nt(v[0]===v[1],"cube framebuffer must be square"),f=v[0]}else"radius"in _&&(f=0|_.radius),"width"in _?(f=0|_.width,"height"in _&&nt(_.height===f,"must be square")):"height"in _&&(f=0|_.height);("color"in _||"colors"in _)&&(d=_.color||_.colors,Array.isArray(d)&&nt(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in _&&(g=0|_.colorCount,nt(g>0,"invalid color buffer count")),"colorType"in _&&(nt.oneOf(_.colorType,l,"invalid color type"),m=_.colorType),"colorFormat"in _&&(p=_.colorFormat,nt.oneOf(_.colorFormat,u,"invalid color format for texture"))),"depth"in _&&(h.depth=_.depth),"stencil"in _&&(h.stencil=_.stencil),"depthStencil"in _&&(h.depthStencil=_.depthStencil)}else f=1;if(d)if(Array.isArray(d))for(c=[],r=0;r<d.length;++r)c[r]=d[r];else c=[d];else{c=Array(g);var y={radius:f,format:p,type:m};for(r=0;r<g;++r)c[r]=i.createCube(y)}for(h.color=Array(c.length),r=0;r<c.length;++r){var b=c[r];nt("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,nt(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:di,data:c[r]}}for(r=0;r<6;++r){for(var x=0;x<c.length;++x)h.color[x].target=di+r;r>0&&(h.depth=s[0].depth,h.stencil=s[0].stencil,h.depthStencil=s[0].depthStencil),s[r]?s[r](h):s[r]=S(h)}return e(o,{width:f,height:f,color:c})}function c(t){var e,n=0|t;if(nt(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var i=o.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)s[e].resize(n);return o.width=o.height=n,o}return o(t),e(o,{faces:s,resize:c,_reglType:"framebufferCube",destroy:function(){s.forEach((function(t){t.destroy()}))}})}function C(){a.cur=null,a.next=null,a.dirty=!0,Te(b).forEach((function(e){e.framebuffer=t.createFramebuffer(),T(e)}))}return e(a,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof x)return e}return null},create:S,createCube:k,clear:function(){Te(b).forEach(A)},restore:C})}ji[vi]="complete",ji[yi]="incomplete attachment",ji[xi]="incomplete dimensions",ji[bi]="incomplete, missing attachment",ji[wi]="unsupported";var Pi=5126,qi=34962,Bi=34963,Li=["attributes","elements","offset","count","primitive","instances"];function Wi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pi,this.offset=0,this.stride=0,this.divisor=0}function Ui(e,n,r,i,s,o,a){for(var u=r.maxAttributes,c=new Array(u),l=0;l<u;++l)c[l]=new Wi;var h=0,f={},d={Record:Wi,scope:{},state:c,currentVAO:null,targetVAO:null,restore:m()?w:function(){},createVAO:A,getVAO:_,destroyBuffer:p,setVAO:m()?v:y,clear:m()?b:function(){}};function p(t){for(var n=0;n<c.length;++n){var r=c[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}}function m(){return n.oes_vertex_array_object}function g(){return n.angle_instanced_arrays}function _(t){return"function"==typeof t&&t._vao?t._vao:null}function v(t){if(t!==d.currentVAO){var e=m();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),d.currentVAO=t}}function y(t){if(t!==d.currentVAO){if(t)t.bindAttrs();else{for(var n=g(),r=0;r<c.length;++r){var i=c[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}a.elements?e.bindBuffer(Bi,a.elements.buffer.buffer):e.bindBuffer(Bi,null)}d.currentVAO=t}}function b(){Te(f).forEach((function(t){t.destroy()}))}function x(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=m();this.vao=t?t.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}function w(){m()&&Te(f).forEach((function(t){t.refresh()}))}function A(e){var r=new x;function a(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(nt("object"==typeof e,"invalid arguments for create vao"),nt("attributes"in e,"must specify attributes for vao"),e.elements){var c=e.elements;r.ownsElements?"function"==typeof c&&"elements"===c._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(c),r.ownsElements=!1):o.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=o.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(nt(e.primitive in Ge,"bad primitive type: "+e.primitive),r.primitive=Ge[e.primitive]),nt.optional((()=>{for(var t=Object.keys(e),n=0;n<t.length;++n)nt(Li.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Li)})),nt(Array.isArray(i),"attributes must be an array")}nt(i.length<u,"too many attributes"),nt(i.length>0,"must specify at least one attribute");var l={},h=r.attributes;h.length=i.length;for(var f=0;f<i.length;++f){var d,p=i[f],m=h[f]=new Wi,g=p.data||p;Array.isArray(g)||t(g)||Ae(g)?(r.buffers[f]&&(d=r.buffers[f],t(g)&&d._buffer.byteLength>=g.byteLength?d.subdata(g):(d.destroy(),r.buffers[f]=null)),r.buffers[f]||(d=r.buffers[f]=s.create(p,qi,!1,!0)),m.buffer=s.getBuffer(d),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1,l[f]=1):s.getBuffer(p)?(m.buffer=s.getBuffer(p),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1):s.getBuffer(p.buffer)?(m.buffer=s.getBuffer(p.buffer),m.size=0|(+p.size||m.buffer.dimension),m.normalized=!!p.normalized||!1,"type"in p?(nt.parameter(p.type,Re,"invalid buffer type"),m.type=Re[p.type]):m.type=m.buffer.dtype,m.offset=0|(p.offset||0),m.stride=0|(p.stride||0),m.divisor=0|(p.divisor||0),m.state=1,nt(m.size>=1&&m.size<=4,"size must be between 1 and 4"),nt(m.offset>=0,"invalid offset"),nt(m.stride>=0&&m.stride<=255,"stride must be between 0 and 255"),nt(m.divisor>=0,"divisor must be positive"),nt(!m.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in p?(nt(f>0,"first attribute must not be a constant"),m.x=+p.x||0,m.y=+p.y||0,m.z=+p.z||0,m.w=+p.w||0,m.state=2):nt(!1,"invalid attribute spec for location "+f)}for(var _=0;_<r.buffers.length;++_)!l[_]&&r.buffers[_]&&(r.buffers[_].destroy(),r.buffers[_]=null);return r.refresh(),a}return i.vaoCount+=1,a.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},a._vao=r,a._reglType="vao",a(e)}return x.prototype.bindAttrs=function(){for(var t=g(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(qi,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var s=n.length;s<u;++s)e.disableVertexAttribArray(s);var a=o.getElements(this.elements);a?e.bindBuffer(Bi,a.buffer.buffer):e.bindBuffer(Bi,null)},x.prototype.refresh=function(){var t=m();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=null,t.bindVertexArrayOES(null))},x.prototype.destroy=function(){if(this.vao){var t=m();this===d.currentVAO&&(d.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),f[this.id]&&(delete f[this.id],i.vaoCount-=1)},d}var zi=35632,Hi=35633,Gi=35718,Xi=35721;function Yi(t,n,r,i){var s={},o={};function a(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function c(e,r,i){var a=e===zi?s:o,u=a[r];if(!u){var c=n.str(r);u=t.createShader(e),t.shaderSource(u,c),t.compileShader(u),nt.shaderError(t,u,c,e,i),a[r]=u}return u}var l={},h=[],f=0;function d(t,e){this.id=f++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(e,r,s){var o,l,h=c(zi,e.fragId),f=c(Hi,e.vertId),d=e.program=t.createProgram();if(t.attachShader(d,h),t.attachShader(d,f),s)for(o=0;o<s.length;++o){var p=s[o];t.bindAttribLocation(d,p[0],p[1])}t.linkProgram(d),nt.linkError(t,d,n.str(e.fragId),n.str(e.vertId),r);var m=t.getProgramParameter(d,Gi);i.profile&&(e.stats.uniformsCount=m);var g=e.uniforms;for(o=0;o<m;++o)if(l=t.getActiveUniform(d,o)){if(l.size>1)for(var _=0;_<l.size;++_){var v=l.name.replace("[0]","["+_+"]");u(g,new a(v,n.id(v),t.getUniformLocation(d,v),l))}var y=l.name;l.size>1&&(y=y.replace("[0]","")),u(g,new a(y,n.id(y),t.getUniformLocation(d,y),l))}var b=t.getProgramParameter(d,Xi);i.profile&&(e.stats.attributesCount=b);var x=e.attributes;for(o=0;o<b;++o)(l=t.getActiveAttrib(d,o))&&u(x,new a(l.name,n.id(l.name),t.getAttribLocation(d,l.name),l))}function m(){s={},o={};for(var t=0;t<h.length;++t)p(h[t],null,h[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return h.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return h.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Te(s).forEach(e),s={},Te(o).forEach(e),o={},h.forEach((function(e){t.deleteProgram(e.program)})),h.length=0,l={},r.shaderCount=0},program:function(n,i,a,u){nt.command(n>=0,"missing vertex shader",a),nt.command(i>=0,"missing fragment shader",a);var c=l[i];c||(c=l[i]={});var f=c[n];if(f&&(f.refCount++,!u))return f;var m=new d(i,n);return r.shaderCount++,p(m,a,u),f||(c[n]=m),h.push(m),e(m,{destroy:function(){if(m.refCount--,m.refCount<=0){t.deleteProgram(m.program);var e=h.indexOf(m);h.splice(e,1),r.shaderCount--}c[m.vertId].refCount<=0&&(t.deleteShader(o[m.vertId]),delete o[m.vertId],delete l[m.fragId][m.vertId]),Object.keys(l[m.fragId]).length||(t.deleteShader(s[m.fragId]),delete s[m.fragId],delete l[m.fragId])}})},restore:m,shader:c,frag:-1,vert:-1}}var Qi=6408,Zi=5121,$i=3333,Ji=5126;function Ki(e,n,r,i,s,o,a){function u(u){var c;null===n.next?(nt(s.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=Zi):(nt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,nt.optional((function(){o.oes_texture_float?(nt(c===Zi||c===Ji,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),c===Ji&&nt(a.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(c===Zi,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var l=0,h=0,f=i.framebufferWidth,d=i.framebufferHeight,p=null;t(u)?p=u:u&&(nt.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,h=0|u.y,nt(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),nt(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-l),d=0|(u.height||i.framebufferHeight-h),p=u.data||null),p&&(c===Zi?nt(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):c===Ji&&nt(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(f>0&&f+l<=i.framebufferWidth,"invalid width for read pixels"),nt(d>0&&d+h<=i.framebufferHeight,"invalid height for read pixels"),r();var m=f*d*4;return p||(c===Zi?p=new Uint8Array(m):c===Ji&&(p=p||new Float32Array(m))),nt.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),nt(p.byteLength>=m,"data buffer for regl.read() too small"),e.pixelStorei($i,4),e.readPixels(l,h,f,d,Qi,c,p),p}function c(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function l(t){return t&&"framebuffer"in t?c(t):u(t)}return l}function ts(t){return Array.prototype.slice.call(t)}function es(t){return ts(t).join("")}function ns(){var t=0,n=[],r=[];function i(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var s="g"+t++;return n.push(s),r.push(e),s}function s(){var n=[];function r(){n.push.apply(n,ts(arguments))}var i=[];function s(){var e="v"+t++;return i.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,ts(arguments)),n.push(";")),e}return e(r,{def:s,toString:function(){return es([i.length>0?"var "+i.join(",")+";":"",es(n)])}})}function o(){var t=s(),n=s(),r=t.toString,i=n.toString;function o(e,r){n(e,r,"=",t.def(e,r),";")}return e((function(){t.apply(t,ts(arguments))}),{def:t.def,entry:t,exit:n,save:o,set:function(e,n,r){o(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function a(){var t=es(arguments),n=o(),r=o(),i=n.toString,s=r.toString;return e(n,{then:function(){return n.apply(n,ts(arguments)),this},else:function(){return r.apply(r,ts(arguments)),this},toString:function(){var e=s();return e&&(e="else{"+e+"}"),es(["if(",t,"){",i(),"}",e])}})}var u=s(),c={};function l(t,n){var r=[];function i(){var t="a"+r.length;return r.push(t),t}n=n||0;for(var s=0;s<n;++s)i();var a=o(),u=a.toString;return c[t]=e(a,{arg:i,toString:function(){return es(["function(",r.join(),"){",u(),"}"])}})}function h(){var t=['"use strict";',u,"return {"];Object.keys(c).forEach((function(e){t.push('"',e,'":',c[e].toString(),",")})),t.push("}");var e=es(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,r)}return{global:u,link:i,block:s,proc:l,scope:o,cond:a,compile:h}}var rs="xyzw".split(""),is=5121,ss=1,os=2,as=0,us=1,cs=2,ls=3,hs=4,fs=5,ds=6,ps="dither",ms="blend.enable",gs="blend.color",_s="blend.equation",vs="blend.func",ys="depth.enable",bs="depth.func",xs="depth.range",ws="depth.mask",As="colorMask",Ts="cull.enable",Ss="cull.face",ks="frontFace",Cs="lineWidth",Os="polygonOffset.enable",Es="polygonOffset.offset",Ms="sample.alpha",Is="sample.enable",Ds="sample.coverage",Rs="stencil.enable",Ns="stencil.mask",Vs="stencil.func",js="stencil.opFront",Fs="stencil.opBack",Ps="scissor.enable",qs="scissor.box",Bs="viewport",Ls="profile",Ws="framebuffer",Us="vert",zs="frag",Hs="elements",Gs="primitive",Xs="count",Ys="offset",Qs="instances",Zs="vao",$s="Width",Js="Height",Ks=Ws+$s,to=Ws+Js,eo=Bs+$s,no=Bs+Js,ro="drawingBuffer",io=ro+$s,so=ro+Js,oo=[vs,_s,Vs,js,Fs,Ds,Bs,qs,Es],ao=34962,uo=34963,co=3553,lo=34067,ho=2884,fo=3042,po=3024,mo=2960,go=2929,_o=3089,vo=32823,yo=32926,bo=32928,xo=5126,wo=35664,Ao=35665,To=35666,So=5124,ko=35667,Co=35668,Oo=35669,Eo=35670,Mo=35671,Io=35672,Do=35673,Ro=35674,No=35675,Vo=35676,jo=35678,Fo=35680,Po=4,qo=1028,Bo=1029,Lo=2304,Wo=2305,Uo=32775,zo=32776,Ho=519,Go=7680,Xo=0,Yo=1,Qo=32774,Zo=513,$o=36160,Jo=36064,Ko={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ta=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ea={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},na={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ra={frag:35632,vert:35633},ia={cw:Lo,ccw:Wo};function sa(e){return Array.isArray(e)||t(e)||Ae(e)}function oa(t){return t.sort((function(t,e){return t===Bs?-1:e===Bs?1:t<e?-1:1}))}function aa(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function ua(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function ca(t){return new aa(!1,!1,!1,t)}function la(t,e){var n=t.type;if(n===as){var r=t.data.length;return new aa(!0,r>=1,r>=2,e)}if(n===hs){var i=t.data;return new aa(i.thisDep,i.contextDep,i.propDep,e)}if(n===fs)return new aa(!1,!1,!1,e);if(n===ds){for(var s=!1,o=!1,a=!1,u=0;u<t.data.length;++u){var c=t.data[u];if(c.type===us)a=!0;else if(c.type===cs)o=!0;else if(c.type===ls)s=!0;else if(c.type===as){s=!0;var l=c.data;l>=1&&(o=!0),l>=2&&(a=!0)}else c.type===hs&&(s=s||c.data.thisDep,o=o||c.data.contextDep,a=a||c.data.propDep)}return new aa(s,o,a,e)}return new aa(n===ls,n===cs,n===us,e)}var ha=new aa(!1,!1,!1,(function(){}));function fa(t,n,r,i,s,o,a,u,c,l,h,f,d,p,m){var g=l.Record,_={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(_.min=Uo,_.max=zo);var v=r.angle_instanced_arrays,y=r.webgl_draw_buffers,b=r.oes_vertex_array_object,x={dirty:!0,profile:m.profile},w={},A=[],T={},S={};function k(t){return t.replace(".","_")}function C(t,e,n){var r=k(t);A.push(t),w[r]=x[r]=!!n,T[r]=e}function O(t,e,n){var r=k(t);A.push(t),Array.isArray(n)?(x[r]=n.slice(),w[r]=n.slice()):x[r]=w[r]=n,S[r]=e}C(ps,po),C(ms,fo),O(gs,"blendColor",[0,0,0,0]),O(_s,"blendEquationSeparate",[Qo,Qo]),O(vs,"blendFuncSeparate",[Yo,Xo,Yo,Xo]),C(ys,go,!0),O(bs,"depthFunc",Zo),O(xs,"depthRange",[0,1]),O(ws,"depthMask",!0),O(As,As,[!0,!0,!0,!0]),C(Ts,ho),O(Ss,"cullFace",Bo),O(ks,ks,Wo),O(Cs,Cs,1),C(Os,vo),O(Es,"polygonOffset",[0,0]),C(Ms,yo),C(Is,bo),O(Ds,"sampleCoverage",[1,!1]),C(Rs,mo),O(Ns,"stencilMask",-1),O(Vs,"stencilFunc",[Ho,0,-1]),O(js,"stencilOpSeparate",[qo,Go,Go,Go]),O(Fs,"stencilOpSeparate",[Bo,Go,Go,Go]),C(Ps,_o),O(qs,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),O(Bs,Bs,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var E={gl:t,context:d,strings:n,next:w,current:x,draw:f,elements:o,buffer:s,shader:h,attributes:l.state,vao:l,uniforms:c,framebuffer:u,extensions:r,timer:p,isBufferArgs:sa},M={primTypes:Ge,compareFuncs:ea,blendFuncs:Ko,blendEquations:_,stencilOps:na,glTypes:Re,orientationType:ia};nt.optional((function(){E.isArrayLike=hn})),y&&(M.backBuffer=[Bo],M.drawBuffer=kt(i.maxDrawbuffers,(function(t){return 0===t?[0]:kt(t,(function(t){return Jo+t}))})));var I=0;function D(){var t=ns(),e=t.link,r=t.global;t.id=I++,t.batchId="0";var i=e(E),s=t.shared={props:"a0"};Object.keys(E).forEach((function(t){s[t]=r.def(i,".",t)})),nt.optional((function(){t.CHECK=e(nt),t.commandStr=nt.guessCommand(),t.command=e(t.commandStr),t.assert=function(t,n,r){t("if(!(",n,"))",this.CHECK,".commandRaise(",e(r),",",this.command,");")},M.invalidBlendCombinations=ta}));var o=t.next={},a=t.current={};Object.keys(S).forEach((function(t){Array.isArray(x[t])&&(o[t]=r.def(s.next,".",t),a[t]=r.def(s.current,".",t))}));var u=t.constants={};Object.keys(M).forEach((function(t){u[t]=r.def(JSON.stringify(M[t]))})),t.invoke=function(n,r){switch(r.type){case as:var i=["this",s.context,s.props,t.batchId];return n.def(e(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case us:return n.def(s.props,r.data);case cs:return n.def(s.context,r.data);case ls:return n.def("this",r.data);case hs:return r.data.append(t,n),r.data.ref;case fs:return r.data.toString();case ds:return r.data.map((function(e){return t.invoke(n,e)}))}},t.attribCache={};var c={};return t.scopeAttrib=function(t){var r=n.id(t);if(r in c)return c[r];var i=l.scope[r];return i||(i=l.scope[r]=new g),c[r]=e(i)},t}function R(t){var e,n=t.static,r=t.dynamic;if(Ls in n){var i=!!n[Ls];(e=ca((function(t,e){return i}))).enable=i}else if(Ls in r){var s=r[Ls];e=la(s,(function(t,e){return t.invoke(e,s)}))}return e}function N(t,e){var n=t.static,r=t.dynamic;if(Ws in n){var i=n[Ws];return i?(i=u.getFramebuffer(i),nt.command(i,"invalid framebuffer object"),ca((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var s=r.context;return e.set(s,"."+Ks,n+".width"),e.set(s,"."+to,n+".height"),n}))):ca((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Ks,r+"."+io),e.set(r,"."+to,r+"."+so),"null"}))}if(Ws in r){var s=r[Ws];return la(s,(function(t,e){var n=t.invoke(e,s),r=t.shared,i=r.framebuffer,o=e.def(i,".getFramebuffer(",n,")");nt.optional((function(){t.assert(e,"!"+n+"||"+o,"invalid framebuffer object")})),e.set(i,".next",o);var a=r.context;return e.set(a,"."+Ks,o+"?"+o+".width:"+a+"."+io),e.set(a,"."+to,o+"?"+o+".height:"+a+"."+so),o}))}return null}function V(t,e,n){var r=t.static,i=t.dynamic;function s(t){if(t in r){var s=r[t];nt.commandType(s,"object","invalid "+t,n.commandStr);var o,a,u=!0,c=0|s.x,l=0|s.y;return"width"in s?(o=0|s.width,nt.command(o>=0,"invalid "+t,n.commandStr)):u=!1,"height"in s?(a=0|s.height,nt.command(a>=0,"invalid "+t,n.commandStr)):u=!1,new aa(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=o;"width"in s||(r=e.def(n,".",Ks,"-",c));var i=a;return"height"in s||(i=e.def(n,".",to,"-",l)),[c,l,r,i]}))}if(t in i){var h=i[t],f=la(h,(function(e,n){var r=e.invoke(n,h);nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,s=n.def(r,".x|0"),o=n.def(r,".y|0"),a=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Ks,"-",s,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",to,"-",o,")");return nt.optional((function(){e.assert(n,a+">=0&&"+u+">=0","invalid "+t)})),[s,o,a,u]}));return e&&(f.thisDep=f.thisDep||e.thisDep,f.contextDep=f.contextDep||e.contextDep,f.propDep=f.propDep||e.propDep),f}return e?new aa(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Ks),e.def(n,".",to)]})):null}var o=s(Bs);if(o){var a=o;o=new aa(o.thisDep,o.contextDep,o.propDep,(function(t,e){var n=a.append(t,e),r=t.shared.context;return e.set(r,"."+eo,n[2]),e.set(r,"."+no,n[3]),n}))}return{viewport:o,scissor_box:s(qs)}}function j(t,e){var n=t.static;if("string"==typeof n[zs]&&"string"==typeof n[Us]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var s=[],o=0;o<i.length;++o)nt("number"==typeof r[i[o]],"must specify all vertex attribute locations when using vaos"),s.push([0|r[i[o]],i[o]]);return s}}return null}function F(t,e,r){var i=t.static,s=t.dynamic;function o(t){if(t in i){var e=n.id(i[t]);nt.optional((function(){h.shader(ra[t],e,nt.guessCommand())}));var r=ca((function(){return e}));return r.id=e,r}if(t in s){var o=s[t];return la(o,(function(e,n){var r=e.invoke(n,o),i=n.def(e.shared.strings,".id(",r,")");return nt.optional((function(){n(e.shared.shader,".shader(",ra[t],",",i,",",e.command,");")})),i}))}return null}var a,u=o(zs),c=o(Us),l=null;return ua(u)&&ua(c)?(l=h.program(c.id,u.id,null,r),a=ca((function(t,e){return t.link(l)}))):a=new aa(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",zs);var i=r+".program("+(c?c.append(t,e):e.def(r,".",Us))+","+n;return nt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:c,progVar:a,program:l}}function P(t,e){var n=t.static,r=t.dynamic,i={},s=!1;function a(){if(Zs in n){var t=n[Zs];return null!==t&&null===l.getVAO(t)&&(t=l.createVAO(t)),s=!0,i.vao=t,ca((function(e){var n=l.getVAO(t);return n?e.link(n):"null"}))}if(Zs in r){s=!0;var e=r[Zs];return la(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=a(),c=!1;function h(){if(Hs in n){var t=n[Hs];if(i.elements=t,sa(t)){var a=i.elements=o.create(t,!0);t=o.getElements(a),c=!0}else t&&(t=o.getElements(t),c=!0,nt.command(t,"invalid elements",e.commandStr));var l=ca((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return l.value=t,l}if(Hs in r){c=!0;var h=r[Hs];return la(h,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,s=t.invoke(e,h),o=e.def("null"),a=e.def(r,"(",s,")"),u=t.cond(a).then(o,"=",i,".createStream(",s,");").else(o,"=",i,".getElements(",s,");");return nt.optional((function(){t.assert(u.else,"!"+s+"||"+o,"invalid elements")})),e.entry(u),e.exit(t.cond(a).then(i,".destroyStream(",o,");")),t.ELEMENTS=o,o}))}return s?new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var f=h();function d(){if(Gs in n){var t=n[Gs];return i.primitive=t,nt.commandParameter(t,Ge,"invalid primitve",e.commandStr),ca((function(e,n){return Ge[t]}))}if(Gs in r){var o=r[Gs];return la(o,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,o);return nt.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Ge))})),e.def(n,"[",r,"]")}))}return c?ua(f)?f.value?ca((function(t,e){return e.def(t.ELEMENTS,".primType")})):ca((function(){return Po})):new aa(f.thisDep,f.contextDep,f.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",Po)})):s?new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+Po)})):null}function p(t,o){if(t in n){var a=0|n[t];return o?i.offset=a:i.instances=a,nt.command(!o||a>=0,"invalid "+t,e.commandStr),ca((function(t,e){return o&&(t.OFFSET=a),a}))}if(t in r){var l=r[t];return la(l,(function(e,n){var r=e.invoke(n,l);return o&&(e.OFFSET=r,nt.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(o){if(c)return ca((function(t,e){return t.OFFSET=0,0}));if(s)return new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(s)return new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var m=p(Ys,!0);function g(){if(Xs in n){var t=0|n[Xs];return i.count=t,nt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),ca((function(){return t}))}if(Xs in r){var o=r[Xs];return la(o,(function(t,e){var n=t.invoke(e,o);return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(c){if(ua(f)){if(f)return m?new aa(m.thisDep,m.contextDep,m.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return nt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):ca((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var a=ca((function(){return-1}));return nt.optional((function(){a.MISSING=!0})),a}var l=new aa(f.thisDep||m.thisDep,f.contextDep||m.contextDep,f.propDep||m.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return nt.optional((function(){l.DYNAMIC=!0})),l}return s?new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")})):null}var _=d(),v=g(),y=p(Qs,!1);return{elements:f,primitive:_,count:v,instances:y,offset:m,vao:u,vaoActive:s,elementsActive:c,static:i}}function q(t,e){var n=t.static,r=t.dynamic,s={};return A.forEach((function(t){var o=k(t);function a(e,i){if(t in n){var a=e(n[t]);s[o]=ca((function(){return a}))}else if(t in r){var u=r[t];s[o]=la(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case Ts:case ms:case ps:case Rs:case ys:case Ps:case Os:case Ms:case Is:case ws:return a((function(n){return nt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return nt.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case bs:return a((function(n){return nt.commandParameter(n,ea,"invalid "+t,e.commandStr),ea[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return nt.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(ea))})),n.def(i,"[",r,"]")}));case xs:return a((function(t){return nt.command(hn(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case vs:return a((function(t){nt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,s="dstAlpha"in t?t.dstAlpha:t.dst;return nt.commandParameter(n,Ko,o+".srcRGB",e.commandStr),nt.commandParameter(r,Ko,o+".srcAlpha",e.commandStr),nt.commandParameter(i,Ko,o+".dstRGB",e.commandStr),nt.commandParameter(s,Ko,o+".dstAlpha",e.commandStr),nt.command(-1===ta.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[Ko[n],Ko[i],Ko[r],Ko[s]]}),(function(e,n,r){var i=e.constants.blendFuncs;function s(s,o){var a=n.def('"',s,o,'" in ',r,"?",r,".",s,o,":",r,".",s);return nt.optional((function(){e.assert(n,a+" in "+i,"invalid "+t+"."+s+o+", must be one of "+Object.keys(Ko))})),a}nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=s("src","RGB"),a=s("dst","RGB");nt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+o+'+", "+'+a+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",o,"]"),c=n.def(i,"[",s("src","Alpha"),"]");return[u,n.def(i,"[",a,"]"),c,n.def(i,"[",s("dst","Alpha"),"]")]}));case _s:return a((function(n){return"string"==typeof n?(nt.commandParameter(n,_,"invalid "+t,e.commandStr),[_[n],_[n]]):"object"==typeof n?(nt.commandParameter(n.rgb,_,t+".rgb",e.commandStr),nt.commandParameter(n.alpha,_,t+".alpha",e.commandStr),[_[n.rgb],_[n.alpha]]):void nt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,s=n.def(),o=n.def(),a=e.cond("typeof ",r,'==="string"');return nt.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(_))}n(a.then,t,r),e.assert(a.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(a.else,t+".rgb",r+".rgb"),n(a.else,t+".alpha",r+".alpha")})),a.then(s,"=",o,"=",i,"[",r,"];"),a.else(s,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(a),[s,o]}));case gs:return a((function(t){return nt.command(hn(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),kt(4,(function(e){return+t[e]}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),kt(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Ns:return a((function(t){return nt.commandType(t,"number",o,e.commandStr),0|t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Vs:return a((function(n){nt.commandType(n,"object",o,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,s="mask"in n?n.mask:-1;return nt.commandParameter(r,ea,t+".cmp",e.commandStr),nt.commandType(i,"number",t+".ref",e.commandStr),nt.commandType(s,"number",t+".mask",e.commandStr),[ea[r],i,s]}),(function(t,e,n){var r=t.constants.compareFuncs;return nt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Go),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case js:case Fs:return a((function(n){nt.commandType(n,"object",o,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",s=n.zpass||"keep";return nt.commandParameter(r,na,t+".fail",e.commandStr),nt.commandParameter(i,na,t+".zfail",e.commandStr),nt.commandParameter(s,na,t+".zpass",e.commandStr),[t===Fs?Bo:qo,na[r],na[i],na[s]]}),(function(e,n,r){var i=e.constants.stencilOps;function s(s){return nt.optional((function(){e.assert(n,'!("'+s+'" in '+r+")||("+r+"."+s+" in "+i+")","invalid "+t+"."+s+", must be one of "+Object.keys(na))})),n.def('"',s,'" in ',r,"?",i,"[",r,".",s,"]:",Go)}return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Fs?Bo:qo,s("fail"),s("zfail"),s("zpass")]}));case Es:return a((function(t){nt.commandType(t,"object",o,e.commandStr);var n=0|t.factor,r=0|t.units;return nt.commandType(n,"number",o+".factor",e.commandStr),nt.commandType(r,"number",o+".units",e.commandStr),[n,r]}),(function(e,n,r){return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ss:return a((function(t){var n=0;return"front"===t?n=qo:"back"===t&&(n=Bo),nt.command(!!n,o,e.commandStr),n}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',qo,":",Bo)}));case Cs:return a((function(t){return nt.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case ks:return a((function(t){return nt.commandParameter(t,ia,o,e.commandStr),ia[t]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Lo+":"+Wo)}));case As:return a((function(t){return nt.command(hn(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),kt(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Ds:return a((function(t){nt.command("object"==typeof t&&t,o,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return nt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),s}function B(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,s=n[t];if("number"==typeof s||"boolean"==typeof s)r=ca((function(){return s}));else if("function"==typeof s){var o=s._reglType;"texture2d"===o||"textureCube"===o?r=ca((function(t){return t.link(s)})):"framebuffer"===o||"framebufferCube"===o?(nt.command(s.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=ca((function(t){return t.link(s.color[0])}))):nt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else hn(s)?r=ca((function(e){return e.global.def("[",kt(s.length,(function(n){return nt.command("number"==typeof s[n]||"boolean"==typeof s[n],"invalid uniform "+t,e.commandStr),s[n]})),"]")})):nt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=s,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=la(e,(function(t,n){return t.invoke(n,e)}))})),i}function L(t,e){var r=t.static,i=t.dynamic,o={};return Object.keys(r).forEach((function(t){var i=r[t],a=n.id(t),u=new g;if(sa(i))u.state=ss,u.buffer=s.getBuffer(s.create(i,ao,!1,!0)),u.type=0;else{var c=s.getBuffer(i);if(c)u.state=ss,u.buffer=c,u.type=0;else if(nt.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=os,"number"==typeof l?u.x=l:(nt.command(hn(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+t,e.commandStr),rs.forEach((function(t,e){e<l.length&&(u[t]=l[e])})))}else{c=sa(i.buffer)?s.getBuffer(s.create(i.buffer,ao,!1,!0)):s.getBuffer(i.buffer),nt.command(!!c,'missing buffer for attribute "'+t+'"',e.commandStr);var h=0|i.offset;nt.command(h>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var f=0|i.stride;nt.command(f>=0&&f<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var d=0|i.size;nt.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var p=!!i.normalized,m=0;"type"in i&&(nt.commandParameter(i.type,Re,"invalid type for attribute "+t,e.commandStr),m=Re[i.type]);var _=0|i.divisor;nt.optional((function(){"divisor"in i&&(nt.command(0===_||v,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),nt.command(_>=0,'invalid divisor for attribute "'+t+'"',e.commandStr));var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){nt.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=ss,u.size=d,u.normalized=p,u.type=m||c.dtype,u.offset=h,u.stride=f,u.divisor=_}}o[t]=ca((function(t,e){var n=t.attribCache;if(a in n)return n[a];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[a]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),s=n.shared,o=n.constants,a=s.isBufferArgs,u=s.buffer;nt.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+a+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+a+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+s.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var c={isStream:r.def(!1)},l=new g;l.state=ss,Object.keys(l).forEach((function(t){c[t]=r.def(""+l[t])}));var h=c.buffer,f=c.type;function d(t){r(c[t],"=",i,".",t,"|0;")}return r("if(",a,"(",i,")){",c.isStream,"=true;",h,"=",u,".createStream(",ao,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",os,";","if(typeof "+i+'.constant === "number"){',c[rs[0]],"=",i,".constant;",rs.slice(1).map((function(t){return c[t]})).join("="),"=0;","}else{",rs.map((function(t,e){return c[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",a,"(",i,".buffer)){",h,"=",u,".createStream(",ao,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",h,".dtype;",c.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",h,");","}"),c}o[t]=la(e,n)})),o}function W(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=ca((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=la(e,(function(t,n){return t.invoke(n,e)}))})),r}function U(t,e,n,i,s){var o=t.static,a=t.dynamic;nt.optional((function(){var t=[Ws,Us,zs,Hs,Gs,Ys,Xs,Qs,Ls,Zs].concat(A);function e(e){Object.keys(e).forEach((function(e){nt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',s.commandStr)}))}e(o),e(a)}));var u=j(t,e),c=N(t),h=V(t,c,s),f=P(t,s),d=q(t,s),p=F(t,s,u);function m(t){var e=h[t];e&&(d[t]=e)}m(Bs),m(k(qs));var g=Object.keys(d).length>0,_={framebuffer:c,draw:f,shader:p,state:d,dirty:g,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(_.profile=R(t),_.uniforms=B(n,s),_.drawVAO=_.scopeVAO=f.vao,!_.drawVAO&&p.program&&!u&&r.angle_instanced_arrays&&f.static.elements){var v=!0,y=p.program.attributes.map((function(t){var n=e.static[t];return v=v&&!!n,n}));if(v&&y.length>0){var b=l.getVAO(l.createVAO({attributes:y,elements:f.static.elements}));_.drawVAO=new aa(null,null,null,(function(t,e){return t.link(b)})),_.useVAO=!0}}return u?_.useVAO=!0:_.attributes=L(e,s),_.context=W(i),_}function z(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(s){e.save(r,"."+s);var o=n[s].append(t,e);Array.isArray(o)?i(r,".",s,"=[",o.join(),"];"):i(r,".",s,"=",o,";")})),e(i)}function H(t,e,n,r){var i,s=t.shared,o=s.gl,a=s.framebuffer;y&&(i=e.def(s.extensions,".webgl_draw_buffers"));var u,c=t.constants,l=c.drawBuffer,h=c.backBuffer;u=n?n.append(t,e):e.def(a,".next"),r||e("if(",u,"!==",a,".cur){"),e("if(",u,"){",o,".bindFramebuffer(",$o,",",u,".framebuffer);"),y&&e(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),e("}else{",o,".bindFramebuffer(",$o,",null);"),y&&e(i,".drawBuffersWEBGL(",h,");"),e("}",a,".cur=",u,";"),r||e("}")}function G(t,e,n){var r=t.shared,i=r.gl,s=t.current,o=t.next,a=r.current,u=r.next,c=t.cond(a,".dirty");A.forEach((function(e){var r,l,h=k(e);if(!(h in n.state))if(h in o){r=o[h],l=s[h];var f=kt(x[h].length,(function(t){return c.def(r,"[",t,"]")}));c(t.cond(f.map((function(t,e){return t+"!=="+l+"["+e+"]"})).join("||")).then(i,".",S[h],"(",f,");",f.map((function(t,e){return l+"["+e+"]="+t})).join(";"),";"))}else{r=c.def(u,".",h);var d=t.cond(r,"!==",a,".",h);c(d),h in T?d(t.cond(r).then(i,".enable(",T[h],");").else(i,".disable(",T[h],");"),a,".",h,"=",r,";"):d(i,".",S[h],"(",r,");",a,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&c(a,".dirty=false;"),e(c)}function X(t,e,n,r){var i=t.shared,s=t.current,o=i.current,a=i.gl;oa(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(t,e);if(T[i]){var l=T[i];ua(u)?e(a,c?".enable(":".disable(",l,");"):e(t.cond(c).then(a,".enable(",l,");").else(a,".disable(",l,");")),e(o,".",i,"=",c,";")}else if(hn(c)){var h=s[i];e(a,".",S[i],"(",c,");",c.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(a,".",S[i],"(",c,");",o,".",i,"=",c,";")}}))}function Y(t,e){v&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function Q(t,e,n,r,i){var s,o,a,u=t.shared,c=t.stats,l=u.current,h=u.timer,f=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(t){t(s=e.def(),"=",d(),";"),"string"==typeof i?t(c,".count+=",i,";"):t(c,".count++;"),p&&(r?t(o=e.def(),"=",h,".getNumPendingQueries();"):t(h,".beginQuery(",c,");"))}function g(t){t(c,".cpuTime+=",d(),"-",s,";"),p&&(r?t(h,".pushScopeStats(",o,",",h,".getNumPendingQueries(),",c,");"):t(h,".endQuery();"))}function _(t){var n=e.def(l,".profile");e(l,".profile=",t,";"),e.exit(l,".profile=",n,";")}if(f){if(ua(f))return void(f.enable?(m(e),g(e.exit),_("true")):_("false"));_(a=f.append(t,e))}else a=e.def(l,".profile");var v=t.block();m(v),e("if(",a,"){",v,"}");var y=t.block();g(y),e.exit("if(",a,"){",y,"}")}function Z(t,e,n,r,i){var s=t.shared;function o(t){switch(t){case wo:case ko:case Mo:return 2;case Ao:case Co:case Io:return 3;case To:case Oo:case Do:return 4;default:return 1}}function a(n,r,i){var o=s.gl,a=e.def(n,".location"),u=e.def(s.attributes,"[",a,"]"),c=i.state,l=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function d(){e("if(!",u,".buffer){",o,".enableVertexAttribArray(",a,");}");var n,s=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",s,"||",u,".size!==",n,"||",f.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",o,".bindBuffer(",ao,",",l,".buffer);",o,".vertexAttribPointer(",[a,n,s,i.normalized,i.stride,i.offset],");",u,".type=",s,";",u,".size=",n,";",f.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),v){var c=i.divisor;e("if(",u,".divisor!==",c,"){",t.instancing,".vertexAttribDivisorANGLE(",[a,c],");",u,".divisor=",c,";}")}}function p(){e("if(",u,".buffer){",o,".disableVertexAttribArray(",a,");",u,".buffer=null;","}if(",rs.map((function(t,e){return u+"."+t+"!=="+h[e]})).join("||"),"){",o,".vertexAttrib4f(",a,",",h,");",rs.map((function(t,e){return u+"."+t+"="+h[e]+";"})).join(""),"}")}c===ss?d():c===os?p():(e("if(",c,"===",ss,"){"),d(),e("}else{"),p(),e("}"))}r.forEach((function(r){var s,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;s=c.append(t,e)}else{if(!i(ha))return;var l=t.scopeAttrib(u);nt.optional((function(){t.assert(e,l+".state","missing attribute "+u)})),s={},Object.keys(new g).forEach((function(t){s[t]=e.def(l,".",t)}))}a(t.link(r),o(r.info.type),s)}))}function $(t,e,r,i,s,o){for(var a,u=t.shared,c=u.gl,l={},h=0;h<i.length;++h){var f=i[h],d=f.name,p=f.info.type,m=f.info.size,g=r.uniforms[d];if(m>1){if(!g)continue;var _=d.replace("[0]","");if(l[_])continue;l[_]=1}var v,y=t.link(f)+".location";if(g){if(!s(g))continue;if(ua(g)){var b=g.value;if(nt.command(null!=b,'missing uniform "'+d+'"',t.commandStr),p===jo||p===Fo){nt.command("function"==typeof b&&(p===jo&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||p===Fo&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+d,t.commandStr);var x=t.link(b._texture||b.color[0]._texture);e(c,".uniform1i(",y,",",x+".bind());"),e.exit(x,".unbind();")}else if(p===Ro||p===No||p===Vo){nt.optional((function(){nt.command(hn(b),"invalid matrix for uniform "+d,t.commandStr),nt.command(p===Ro&&4===b.length||p===No&&9===b.length||p===Vo&&16===b.length,"invalid length for matrix uniform "+d,t.commandStr)}));var w=t.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),A=2;p===No?A=3:p===Vo&&(A=4),e(c,".uniformMatrix",A,"fv(",y,",false,",w,");")}else{switch(p){case xo:1===m?nt.commandType(b,"number","uniform "+d,t.commandStr):nt.command(hn(b)&&b.length===m,"uniform "+d,t.commandStr),a="1f";break;case wo:nt.command(hn(b)&&b.length&&b.length%2==0&&b.length<=2*m,"uniform "+d,t.commandStr),a="2f";break;case Ao:nt.command(hn(b)&&b.length&&b.length%3==0&&b.length<=3*m,"uniform "+d,t.commandStr),a="3f";break;case To:nt.command(hn(b)&&b.length&&b.length%4==0&&b.length<=4*m,"uniform "+d,t.commandStr),a="4f";break;case Eo:1===m?nt.commandType(b,"boolean","uniform "+d,t.commandStr):nt.command(hn(b)&&b.length===m,"uniform "+d,t.commandStr),a="1i";break;case So:1===m?nt.commandType(b,"number","uniform "+d,t.commandStr):nt.command(hn(b)&&b.length===m,"uniform "+d,t.commandStr),a="1i";break;case Mo:case ko:nt.command(hn(b)&&b.length&&b.length%2==0&&b.length<=2*m,"uniform "+d,t.commandStr),a="2i";break;case Io:case Co:nt.command(hn(b)&&b.length&&b.length%3==0&&b.length<=3*m,"uniform "+d,t.commandStr),a="3i";break;case Do:case Oo:nt.command(hn(b)&&b.length&&b.length%4==0&&b.length<=4*m,"uniform "+d,t.commandStr),a="4i"}m>1?(a+="v",b=t.global.def("["+Array.prototype.slice.call(b)+"]")):b=hn(b)?Array.prototype.slice.call(b):b,e(c,".uniform",a,"(",y,",",b,");")}continue}v=g.append(t,e)}else{if(!s(ha))continue;v=e.def(u.uniforms,"[",n.id(d),"]")}p===jo?(nt(!Array.isArray(v),"must specify a scalar prop for textures"),e("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}")):p===Fo&&(nt(!Array.isArray(v),"must specify a scalar prop for cube maps"),e("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}")),nt.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+d+'".  '+r)}function r(t,e){1===e&&nt(!Array.isArray(v),"must not specify an array type for uniform"),n("Array.isArray("+v+") && typeof "+v+'[0]===" '+t+'" || typeof '+v+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r,i){Array.isArray(v)?nt(v.length&&v.length%e==0&&v.length<=e*i,"must have length of "+(1===i?"":"n * ")+e):n(u.isArrayLike+"("+v+")&&"+v+".length && "+v+".length % "+e+" === 0 && "+v+".length<="+e*i,"invalid vector, should have length of "+(1===i?"":"n * ")+e,t.commandStr)}function s(e){nt(!Array.isArray(v),"must not specify a value type"),n("typeof "+v+'==="function"&&'+v+'._reglType==="texture'+(e===co?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(p){case So:r("number",m);break;case ko:i(2,"number",m);break;case Co:i(3,"number",m);break;case Oo:i(4,"number",m);break;case xo:r("number",m);break;case wo:i(2,"number",m);break;case Ao:i(3,"number",m);break;case To:i(4,"number",m);break;case Eo:r("boolean",m);break;case Mo:i(2,"boolean",m);break;case Io:i(3,"boolean",m);break;case Do:i(4,"boolean",m);break;case Ro:i(4,"number",m);break;case No:i(9,"number",m);break;case Vo:i(16,"number",m);break;case jo:s(co);break;case Fo:s(lo)}}));var T=1;switch(p){case jo:case Fo:var S=e.def(v,"._texture");e(c,".uniform1i(",y,",",S,".bind());"),e.exit(S,".unbind();");continue;case So:case Eo:a="1i";break;case ko:case Mo:a="2i",T=2;break;case Co:case Io:a="3i",T=3;break;case Oo:case Do:a="4i",T=4;break;case xo:a="1f";break;case wo:a="2f",T=2;break;case Ao:a="3f",T=3;break;case To:a="4f",T=4;break;case Ro:a="Matrix2fv";break;case No:a="Matrix3fv";break;case Vo:a="Matrix4fv"}if(-1===a.indexOf("Matrix")&&m>1&&(a+="v",T=1),"M"===a.charAt(0)){e(c,".uniform",a,"(",y,",");var k=Math.pow(p-Ro+2,2),C=t.global.def("new Float32Array(",k,")");Array.isArray(v)?e("false,(",kt(k,(function(t){return C+"["+t+"]="+v[t]})),",",C,")"):e("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",kt(k,(function(t){return C+"["+t+"]="+v+"["+t+"]"})),",",C,")"),e(");")}else if(T>1){for(var O=[],E=[],M=0;M<T;++M)Array.isArray(v)?E.push(v[M]):E.push(e.def(v+"["+M+"]")),o&&O.push(e.def());o&&e("if(!",t.batchId,"||",O.map((function(t,e){return t+"!=="+E[e]})).join("||"),"){",O.map((function(t,e){return t+"="+E[e]+";"})).join("")),e(c,".uniform",a,"(",y,",",E.join(","),");"),o&&e("}")}else{if(nt(!Array.isArray(v),"uniform value must not be an array"),o){var I=e.def();e("if(!",t.batchId,"||",I,"!==",v,"){",I,"=",v,";")}e(c,".uniform",a,"(",y,",",v,");"),o&&e("}")}}}function J(t,e,n,r){var i=t.shared,s=i.gl,o=i.draw,a=r.draw;function u(){var u,c=a.elements,l=e;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(l=n),u=c.append(t,l),a.elementsActive&&l("if("+u+")"+s+".bindBuffer("+uo+","+u+".buffer.buffer);")):(u=l.def(),l(u,"=",o,".",Hs,";","if(",u,"){",s,".bindBuffer(",uo,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",b?"":"if("+u+")"+s+".bindBuffer("+uo+","+u+".buffer.buffer);","}")),u}function c(){var i,s=a.count,u=e;return s?((s.contextDep&&r.contextDynamic||s.propDep)&&(u=n),i=s.append(t,u),nt.optional((function(){s.MISSING&&t.assert(e,"false","missing vertex count"),s.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(o,".",Xs),nt.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var l=u();function h(i){var s=a[i];return s?s.contextDep&&r.contextDynamic||s.propDep?s.append(t,n):s.append(t,e):e.def(o,".",i)}var f,d,p=h(Gs),m=h(Ys),g=c();if("number"==typeof g){if(0===g)return}else n("if(",g,"){"),n.exit("}");v&&(f=h(Qs),d=t.instancing);var _=l+".type",y=a.elements&&ua(a.elements)&&!a.vaoActive;function x(){function t(){n(d,".drawElementsInstancedANGLE(",[p,g,_,m+"<<(("+_+"-"+is+")>>1)",f],");")}function e(){n(d,".drawArraysInstancedANGLE(",[p,m,g,f],");")}l&&"null"!==l?y?t():(n("if(",l,"){"),t(),n("}else{"),e(),n("}")):e()}function w(){function t(){n(s+".drawElements("+[p,g,_,m+"<<(("+_+"-"+is+")>>1)"]+");")}function e(){n(s+".drawArrays("+[p,m,g]+");")}l&&"null"!==l?y?t():(n("if(",l,"){"),t(),n("}else{"),e(),n("}")):e()}v&&("number"!=typeof f||f>=0)?"string"==typeof f?(n("if(",f,">0){"),x(),n("}else if(",f,"<0){"),w(),n("}")):x():w()}function K(t,e,n,r,i){var s=D(),o=s.proc("body",i);return nt.optional((function(){s.commandStr=e.commandStr,s.command=s.link(e.commandStr)})),v&&(s.instancing=o.def(s.shared.extensions,".angle_instanced_arrays")),t(s,o,n,r),s.compile().body}function tt(t,e,n,r){Y(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Z(t,e,n,r.attributes,(function(){return!0}))),$(t,e,n,r.uniforms,(function(){return!0}),!1),J(t,e,e,n)}function et(t,e){var n=t.proc("draw",1);Y(t,n),z(t,n,e.context),H(t,n,e.framebuffer),G(t,n,e),X(t,n,e.state),Q(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)tt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),s=n.def(r,".id"),o=n.def(i,"[",s,"]");n(t.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",s,"]=",t.link((function(n){return K(tt,t,e,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function rt(t,e,n,r){function i(){return!0}t.batchId="a1",Y(t,e),Z(t,e,n,r.attributes,i),$(t,e,n,r.uniforms,i,!1),J(t,e,e,n)}function it(t,e,n,r){Y(t,e);var i=n.contextDep,s=e.def(),o="a0",a="a1",u=e.def();t.shared.props=u,t.batchId=s;var c=t.scope(),l=t.scope();function h(t){return t.contextDep&&i||t.propDep}function f(t){return!h(t)}if(e(c.entry,"for(",s,"=0;",s,"<",a,";++",s,"){",u,"=",o,"[",s,"];",l,"}",c.exit),n.needsContext&&z(t,l,n.context),n.needsFramebuffer&&H(t,l,n.framebuffer),X(t,l,n.state,h),n.profile&&h(n.profile)&&Q(t,l,n,!1,!0),r)n.useVAO?n.drawVAO?h(n.drawVAO)?l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):c(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(c(t.shared.vao,".setVAO(null);"),Z(t,c,n,r.attributes,f),Z(t,l,n,r.attributes,h)),$(t,c,n,r.uniforms,f,!1),$(t,l,n,r.uniforms,h,!0),J(t,c,l,n);else{var d=t.global.def("{}"),p=n.shader.progVar.append(t,l),m=l.def(p,".id"),g=l.def(d,"[",m,"]");l(t.shared.gl,".useProgram(",p,".program);","if(!",g,"){",g,"=",d,"[",m,"]=",t.link((function(e){return K(rt,t,n,e,2)})),"(",p,");}",g,".call(this,a0[",s,"],",s,");")}}function st(t,e){var n=t.proc("batch",2);t.batchId="0",Y(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(z(t,n,e.context),i=!1);var s=e.framebuffer,o=!1;function a(t){return t.contextDep&&r||t.propDep}s?(s.propDep?r=o=!0:s.contextDep&&r&&(o=!0),o||H(t,n,s)):H(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),G(t,n,e),X(t,n,e.state,(function(t){return!a(t)})),e.profile&&a(e.profile)||Q(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=o;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)it(t,n,e,null);else{var c=u.append(t,n);if(n(t.shared.gl,".useProgram(",c,".program);"),e.shader.program)it(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var l=t.global.def("{}"),h=n.def(c,".id"),f=n.def(l,"[",h,"]");n(t.cond(f).then(f,".call(this,a0,a1);").else(f,"=",l,"[",h,"]=",t.link((function(n){return K(it,t,e,n,2)})),"(",c,");",f,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function ot(t,e){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,s=i.current;function o(n){var s=e.shader[n];s&&r.set(i.shader,"."+n,s.append(t,r))}z(t,r,e.context),e.framebuffer&&e.framebuffer.append(t,r),oa(Object.keys(e.state)).forEach((function(n){var s=e.state[n].append(t,r);hn(s)?s.forEach((function(e,i){r.set(t.next[n],"["+i+"]",e)})):r.set(i.next,"."+n,s)})),Q(t,r,e,!0,!0),[Hs,Ys,Xs,Qs,Gs].forEach((function(n){var s=e.draw[n];s&&r.set(i.draw,"."+n,""+s.append(t,r))})),Object.keys(e.uniforms).forEach((function(s){var o=e.uniforms[s].append(t,r);Array.isArray(o)&&(o="["+o.join()+"]"),r.set(i.uniforms,"["+n.id(s)+"]",o)})),Object.keys(e.attributes).forEach((function(n){var i=e.attributes[n].append(t,r),s=t.scopeAttrib(n);Object.keys(new g).forEach((function(t){r.set(s,"."+t,i[t])}))})),e.scopeVAO&&r.set(i.vao,".targetVAO",e.scopeVAO.append(t,r)),o(Us),o(zs),Object.keys(e.state).length>0&&(r(s,".dirty=true;"),r.exit(s,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function at(t){if("object"==typeof t&&!hn(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(pt.isDynamic(t[e[n]]))return!0;return!1}}function ut(t,e,n){var r=e.static[n];if(r&&at(r)){var i=t.global,s=Object.keys(r),o=!1,a=!1,u=!1,c=t.global.def("{}");s.forEach((function(e){var n=r[e];if(pt.isDynamic(n)){"function"==typeof n&&(n=r[e]=pt.unbox(n));var s=la(n,null);o=o||s.thisDep,u=u||s.propDep,a=a||s.contextDep}else{switch(i(c,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new pt.DynamicVariable(hs,{thisDep:o,contextDep:a,propDep:u,ref:c,append:l}),delete e.static[n]}function l(t,e){s.forEach((function(n){var i=r[n];if(pt.isDynamic(i)){var s=t.invoke(e,i);e(c,".",n,"=",s,";")}}))}}function ct(t,n,r,i,s){var o=D();o.stats=o.link(s),Object.keys(n.static).forEach((function(t){ut(o,n,t)})),oo.forEach((function(e){ut(o,t,e)}));var a=U(t,n,r,i,o);return et(o,a),ot(o,a),st(o,a),e(o.compile(),{destroy:function(){a.shader.program.destroy()}})}return{next:w,current:x,procs:function(){var t=D(),e=t.proc("poll"),n=t.proc("refresh"),s=t.block();e(s),n(s);var o,a=t.shared,u=a.gl,c=a.next,l=a.current;s(l,".dirty=false;"),H(t,e),H(t,n,null,!0),v&&(o=t.link(v)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var f=n.def(a.attributes,"[",h,"]"),d=t.cond(f,".buffer");d.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",ao,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(d),v&&n(o,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(T).forEach((function(r){var i=T[r],o=s.def(c,".",r),a=t.block();a("if(",o,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",l,".",r,"=",o,";"),n(a),e("if(",o,"!==",l,".",r,"){",a,"}")})),Object.keys(S).forEach((function(r){var i,o,a=S[r],h=x[r],f=t.block();if(f(u,".",a,"("),hn(h)){var d=h.length;i=t.global.def(c,".",r),o=t.global.def(l,".",r),f(kt(d,(function(t){return i+"["+t+"]"})),");",kt(d,(function(t){return o+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",kt(d,(function(t){return i+"["+t+"]!=="+o+"["+t+"]"})).join("||"),"){",f,"}")}else i=s.def(c,".",r),o=s.def(l,".",r),f(i,");",l,".",r,"=",i,";"),e("if(",i,"!==",o,"){",f,"}");n(f)})),t.compile()}(),compile:ct}}function da(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var pa=34918,ma=34919,ga=35007,_a=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var s=[];function o(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(ga,n),s.push(n),d(s.length-1,s.length,t)}function a(){e.ext_disjoint_timer_query.endQueryEXT(ga)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var c=[];function l(){return c.pop()||new u}function h(t){c.push(t)}var f=[];function d(t,e,n){var r=l();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,f.push(r)}var p=[],m=[];function g(){var t,n,r=s.length;if(0!==r){m.length=Math.max(m.length,r+1),p.length=Math.max(p.length,r+1),p[0]=0,m[0]=0;var o=0;for(t=0,n=0;n<s.length;++n){var a=s[n];e.ext_disjoint_timer_query.getQueryObjectEXT(a,ma)?(o+=e.ext_disjoint_timer_query.getQueryObjectEXT(a,pa),i(a)):s[t++]=a,p[n+1]=o,m[n+1]=t}for(s.length=t,t=0,n=0;n<f.length;++n){var u=f[n],c=u.startQueryIndex,l=u.endQueryIndex;u.sum+=p[l]-p[c];var d=m[c],g=m[l];g===d?(u.stats.gpuTime+=u.sum/1e6,h(u)):(u.startQueryIndex=d,u.endQueryIndex=g,f[t++]=u)}f.length=t}}return{beginQuery:o,endQuery:a,pushScopeStats:d,update:g,getNumPendingQueries:function(){return s.length},clear:function(){n.push.apply(n,s);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);s.length=0,n.length=0},restore:function(){s.length=0,n.length=0}}},va=16384,ya=256,ba=1024,xa=34962,wa="webglcontextlost",Aa="webglcontextrestored",Ta=1,Sa=2,ka=3;function Ca(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function Oa(t){var n=Tt(t);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),s=r.isContextLost(),o=St(r,n);if(!o)return null;var a=_t(),u=da(),c=o.extensions,l=_a(r,c),h=gt(),f=r.drawingBufferWidth,d=r.drawingBufferHeight,p={tick:0,time:0,viewportWidth:f,viewportHeight:d,framebufferWidth:f,framebufferHeight:d,drawingBufferWidth:f,drawingBufferHeight:d,pixelRatio:n.pixelRatio},m={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=we(r,c),v=He(r,u,n,x),y=on(r,c,v,u),b=Ui(r,c,_,u,v,y,g);function x(t){return b.destroyBuffer(t)}var w=Yi(r,a,u,n),A=Qr(r,c,_,(function(){k.procs.poll()}),p,u,n),T=ci(r,c,_,u,n),S=Fi(r,c,_,A,T,u),k=fa(r,a,c,_,v,y,A,S,m,b,w,g,p,l,n),C=Ki(r,S,k.procs.poll,p,i,c,_),O=k.next,E=r.canvas,M=[],I=[],D=[],R=[n.onDestroy],N=null;function V(){if(0===M.length)return l&&l.update(),void(N=null);N=mt.next(V),X();for(var t=M.length-1;t>=0;--t){var e=M[t];e&&e(p,null,0)}r.flush(),l&&l.update()}function j(){!N&&M.length>0&&(N=mt.next(V))}function F(){N&&(mt.cancel(V),N=null)}function P(t){t.preventDefault(),s=!0,F(),I.forEach((function(t){t()}))}function q(t){r.getError(),s=!1,o.restore(),w.restore(),v.restore(),A.restore(),T.restore(),S.restore(),b.restore(),l&&l.restore(),k.procs.refresh(),j(),D.forEach((function(t){t()}))}function B(){M.length=0,F(),E&&(E.removeEventListener(wa,P),E.removeEventListener(Aa,q)),w.clear(),S.clear(),T.clear(),b.clear(),A.clear(),y.clear(),v.clear(),l&&l.clear(),R.forEach((function(t){t()}))}function L(t){function n(t){var n=e({},t);function r(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(r){n[t+"."+r]=e[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(n.vao=t.vao),n}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var s=t[i];if(pt.isDynamic(s))r[i]=pt.unbox(s,i);else{if(e&&Array.isArray(s))for(var o=0;o<s.length;++o)if(pt.isDynamic(s[o]))return void(r[i]=pt.unbox(s,i));n[i]=s}})),{dynamic:r,static:n}}nt(!!t,"invalid args to regl({...})"),nt.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),o=r(t.uniforms||{},!0),a=r(t.attributes||{},!1),u=r(n(t),!1),c={gpuTime:0,cpuTime:0,count:0},l=k.compile(u,a,o,i,c),h=l.draw,f=l.batch,d=l.scope,p=[];function m(t){for(;p.length<t;)p.push(null);return p}function g(t,e){var n;if(s&&nt.raise("context lost"),"function"==typeof t)return d.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)d.call(this,null,e,n);else{if(!Array.isArray(t))return d.call(this,t,e,0);for(n=0;n<t.length;++n)d.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return f.call(this,m(0|t),0|t)}else{if(!Array.isArray(t))return h.call(this,t);if(t.length)return f.call(this,t,t.length)}}return e(g,{stats:c,destroy:function(){l.destroy()}})}E&&(E.addEventListener(wa,P,!1),E.addEventListener(Aa,q,!1));var W=S.setFBO=L({framebuffer:pt.define.call(null,Ta,"framebuffer")});function U(t,e){var n=0;k.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=va),"depth"in e&&(r.clearDepth(+e.depth),n|=ya),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=ba),nt(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function z(t){if(nt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)W(e({framebuffer:t.framebuffer.faces[n]},t),U);else W(t,U);else U(null,t)}function H(t){function e(){var e=Ca(M,t);function n(){var t=Ca(M,n);M[t]=M[M.length-1],M.length-=1,M.length<=0&&F()}nt(e>=0,"cannot cancel a frame twice"),M[e]=n}return nt.type(t,"function","regl.frame() callback must be a function"),M.push(t),j(),{cancel:e}}function G(){var t=O.viewport,e=O.scissor_box;t[0]=t[1]=e[0]=e[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function X(){p.tick+=1,p.time=Q(),G(),k.procs.poll()}function Y(){A.refresh(),G(),k.procs.refresh(),l&&l.update()}function Q(){return(gt()-h)/1e3}function Z(t,e){var n;switch(nt.type(e,"function","listener callback must be a function"),t){case"frame":return H(e);case"lost":n=I;break;case"restore":n=D;break;case"destroy":n=R;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}Y();var $=e(L,{clear:z,prop:pt.define.bind(null,Ta),context:pt.define.bind(null,Sa),this:pt.define.bind(null,ka),draw:L({}),buffer:function(t){return v.create(t,xa,!1,!1)},elements:function(t){return y.create(t,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:T.create,framebuffer:S.create,framebufferCube:S.createCube,vao:b.createVAO,attributes:i,frame:H,on:Z,limits:_,hasExtension:function(t){return _.extensions.indexOf(t.toLowerCase())>=0},read:C,destroy:B,_gl:r,_refresh:Y,poll:function(){X(),l&&l.update()},now:Q,stats:u});return n.onDone(null,$),$}return Oa}()})),l=u((function(t,e){var n;t.exports=((n=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";r=t}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),e(++r%i.children.length)}),!1);var s=(performance||Date).now(),o=s,a=0,u=t(new n.Panel("FPS","#0ff","#002")),c=t(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new n.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){s=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(c.update(t-s,200),t>o+1e3&&(u.update(1e3*a/(t-o),100),o=t,a=0,l)){var e=performance.memory;l.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:i,setMode:e}}).Panel=function(t,e,n){var r=1/0,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,u=48*o,c=3*o,l=2*o,h=3*o,f=15*o,d=74*o,p=30*o,m=document.createElement("canvas");m.width=a,m.height=u,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,u),g.fillStyle=e,g.fillText(t,c,l),g.fillRect(h,f,d,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,f,d,p),{dom:m,update:function(u,_){r=Math.min(r,u),i=Math.max(i,u),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,f),g.fillStyle=e,g.fillText(s(u)+" "+t+" ("+s(r)+"-"+s(i)+")",c,l),g.drawImage(m,h+o,f,d-o,p,h,f,d-o,p),g.fillRect(h+d-o,f,o,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-o,f,o,s((1-u/_)*p))}}},n)}));var h=function(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,n){return e.apply(this,arguments)};case 3:return function(t,n,r){return e.apply(this,arguments)};case 4:return function(t,n,r,i){return e.apply(this,arguments)};case 5:return function(t,n,r,i,s){return e.apply(this,arguments)};case 6:return function(t,n,r,i,s,o){return e.apply(this,arguments)};case 7:return function(t,n,r,i,s,o,a){return e.apply(this,arguments)};case 8:return function(t,n,r,i,s,o,a,u){return e.apply(this,arguments)};case 9:return function(t,n,r,i,s,o,a,u,c){return e.apply(this,arguments)};case 10:return function(t,n,r,i,s,o,a,u,c,l){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}};var f=function(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]};var d=function(t){return function e(n){return 0===arguments.length||f(n)?e:t.apply(this,arguments)}};var p=function t(e,n,r){return function(){for(var i=[],s=0,o=e,a=0;a<n.length||s<arguments.length;){var u;a<n.length&&(!f(n[a])||s>=arguments.length)?u=n[a]:(u=arguments[s],s+=1),i[a]=u,f(u)||(o-=1),a+=1}return o<=0?r.apply(this,i):h(o,t(e,i,r))}},m=function(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return f(n)?e:d((function(e){return t(n,e)}));default:return f(n)&&f(r)?e:f(n)?d((function(e){return t(e,r)})):f(r)?d((function(e){return t(n,e)})):t(n,r)}}}((function(t,e){return 1===t?d(e):h(t,p(t,[],e))}));function g(){return!0}var _,v=[],y=[],b=-1,x=!1,w=!1;var A={};function T(t,e){var n,r,i,s,o=V([],g);for(i=[],s=[],n=0;n<e.length;++n)void 0!==e[n]&&(i.push(e[n]),void 0!==e[n].end&&s.push(e[n].end));return(r=V(i,t)).depsChanged=[],r.fnArgs=r.deps.concat([r,r.depsChanged]),r.end=o,o.listeners.push(r),L(s,o),o.deps=s,j(r),r}function S(t,e){return T((function(e,n){n(t(e.val))}),[e])}function k(t){return S(t,this)}function C(t){return t(this)}function O(t){return E(t,this)}function E(t,e){var n=A.stream(1),r=A.on((function(){var t=n()-1;n(t),t<=0&&n.end(!0)}));r(e.end);var i=A.stream(),s=A.combine((function(e,s){i.end(!0);var o=t(e());n(n()+1),r(o.end),i=S(s,o)}),[e]);return A.endsOn(n.end,s),s}function M(t,e){return T((function(t,e,n){n(t.val(e.val))}),[e,t])}function I(t){return M(t,this)}function D(t){return M(this,t)}function R(){return"stream("+this.val+")"}function N(){function t(e){return 0===arguments.length?t.val:(B(e,t),t)}return t.hasVal=!1,t.val=void 0,t.updaters=[],t.listeners=[],t.queued=!1,t.end=void 0,t.ap=I,t["fantasy-land/map"]=t.map=k,t["fantasy-land/ap"]=D,t["fantasy-land/of"]=t.of=A.stream,t["fantasy-land/chain"]=t.chain=O,t.pipe=C,t.constructor=A.stream,t.toJSON=function(){return t.val},t.toString=R,t}function V(t,e){var n=N();return n.fn=e,n.deps=t,n.depsMet=!1,n.depsChanged=t.length>0?[]:void 0,n.shouldUpdate=!1,L(t,n),n}function j(t){var e;if((!(e=t).end||!0!==e.end.val)&&function(t){return!0===t.depsMet||function(t){return t.depsMet=t.deps.every((function(t){return t.hasVal})),t.depsMet}(t)}(t))if(void 0===_){_=t,t.depsChanged&&(t.fnArgs[t.fnArgs.length-1]=t.depsChanged);var n=t.fn.apply(t.fn,t.fnArgs);void 0!==n&&t(n),_=void 0,void 0!==t.depsChanged&&(t.depsChanged=[]),t.shouldUpdate=!1,!1===(x||w)&&q(),function(t){return t.listeners.some((function(t){return t.shouldUpdate}))}(t)&&(w?t.listeners.forEach((function(t){t.shouldUpdate&&P(j,t)})):t(t.val))}else P(j,t)}function F(t){var e,n=t.listeners;if(!1===t.queued){for(t.queued=!0,e=0;e<n.length;++e)F(n[e]);y[++b]=t}}function P(t,e){v.push(e),e.updaters.push(t),e.shouldUpdate=!0}function q(){for(x=!0;v.length>0;){var t=v.shift(),e=t.updaters.shift();e&&t.shouldUpdate&&e(t)}x=!1}function B(t,e){e.val=t,e.hasVal=!0,void 0===_?(w=!0,function(t){var e,n,r,i=t.listeners;for(e=0;e<i.length;++e)(r=i[e]).end===t?z(r):(void 0!==r.depsChanged&&r.depsChanged.push(t),r.shouldUpdate=!0,F(r));for(;b>=0;--b)!0===(n=y[b]).shouldUpdate&&j(n),n.queued=!1}(e),v.length>0&&q(),w=!1):_===e?function(t,e){var n,r;for(n=0;n<e.length;++n)(r=e[n]).end!==t?(void 0!==r.depsChanged&&r.depsChanged.push(t),r.shouldUpdate=!0):z(r)}(e,e.listeners):P((function(e){B(t,e)}),e)}function L(t,e){for(var n=0;n<t.length;++n)t[n].listeners.push(e)}function W(t,e){var n=e.indexOf(t);e[n]=e[e.length-1],e.length--}function U(t){for(var e=0;e<t.deps.length;++e)W(t,t.deps[e].listeners);t.deps.length=0}function z(t){void 0!==t.deps&&U(t),void 0!==t.end&&U(t.end)}function H(){}A.stream=function(t){var e=V([],g),n=N();return n.end=e,n.fnArgs=[],e.listeners.push(n),arguments.length>0&&n(t),n},A.stream["fantasy-land/of"]=A.stream.of=A.stream,A.combine=m(2,T),A.isStream=function(t){return!!((e=t)&&e.constructor&&e.call&&e.apply)&&"hasVal"in t;var e},A.immediate=function(t){return!1===t.depsMet&&(t.depsMet=!0,j(t)),t},A.endsOn=function(t,e){return U(e.end),t.listeners.push(e.end),e.end.deps.push(t),e},A.map=m(2,S),A.chain=m(2,E),A.ap=m(2,M),A.on=m(2,(function(t,e){return T((function(e){t(e.val)}),[e])})),A.scan=m(3,(function(t,e,n){var r=T((function(n,r){r(e=t(e,n.val))}),[n]);return r.hasVal||r(e),r})),A.merge=m(2,(function(t,e){var n=A.immediate(T((function(t,e,n,r){r[0]?n(r[0]()):t.hasVal?n(t.val):e.hasVal&&n(e.val)}),[t,e]));return A.endsOn(T((function(){return!0}),[t.end,e.end]),n),n})),A.transduce=m(2,(function(t,e){return t=t(new H),T((function(e,n){var r=t["@@transducer/step"](void 0,e.val);return r&&!0===r["@@transducer/reduced"]?(n.end(!0),r["@@transducer/value"]):r}),[e])})),A.curryN=m,A.fromPromise=function(t){var e=A.stream();return t.then((function(t){e(t),e.end(!0)})),e},A.flattenPromise=function(t){return T((function(t,e){t().then(e)}),[t])},H.prototype["@@transducer/init"]=function(){},H.prototype["@@transducer/result"]=function(){},H.prototype["@@transducer/step"]=function(t,e){return e};var G=A,X={"@@functional/placeholder":!0};function Y(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function Q(t){return function e(n){return 0===arguments.length||Y(n)?e:t.apply(this,arguments)}}function Z(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return Y(n)?e:Q((function(e){return t(n,e)}));default:return Y(n)&&Y(r)?e:Y(n)?Q((function(e){return t(e,r)})):Y(r)?Q((function(e){return t(n,e)})):t(n,r)}}}var $=Z((function(t,e){return Number(t)+Number(e)}));function J(t,e){var n;e=e||[];var r=(t=t||[]).length,i=e.length,s=[];for(n=0;n<r;)s[s.length]=t[n],n+=1;for(n=0;n<i;)s[s.length]=e[n],n+=1;return s}function K(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,n){return e.apply(this,arguments)};case 3:return function(t,n,r){return e.apply(this,arguments)};case 4:return function(t,n,r,i){return e.apply(this,arguments)};case 5:return function(t,n,r,i,s){return e.apply(this,arguments)};case 6:return function(t,n,r,i,s,o){return e.apply(this,arguments)};case 7:return function(t,n,r,i,s,o,a){return e.apply(this,arguments)};case 8:return function(t,n,r,i,s,o,a,u){return e.apply(this,arguments)};case 9:return function(t,n,r,i,s,o,a,u,c){return e.apply(this,arguments)};case 10:return function(t,n,r,i,s,o,a,u,c,l){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function tt(t){return function e(n,r,i){switch(arguments.length){case 0:return e;case 1:return Y(n)?e:Z((function(e,r){return t(n,e,r)}));case 2:return Y(n)&&Y(r)?e:Y(n)?Z((function(e,n){return t(e,r,n)})):Y(r)?Z((function(e,r){return t(n,e,r)})):Q((function(e){return t(n,r,e)}));default:return Y(n)&&Y(r)&&Y(i)?e:Y(n)&&Y(r)?Z((function(e,n){return t(e,n,i)})):Y(n)&&Y(i)?Z((function(e,n){return t(e,r,n)})):Y(r)&&Y(i)?Z((function(e,r){return t(n,e,r)})):Y(n)?Q((function(e){return t(e,r,i)})):Y(r)?Q((function(e){return t(n,e,i)})):Y(i)?Q((function(e){return t(n,r,e)})):t(n,r,i)}}}var et=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function nt(t){return null!=t&&"function"==typeof t["@@transducer/step"]}function rt(t,e,n){return function(){if(0===arguments.length)return n();var r=Array.prototype.slice.call(arguments,0),i=r.pop();if(!et(i)){for(var s=0;s<t.length;){if("function"==typeof i[t[s]])return i[t[s]].apply(i,r);s+=1}if(nt(i)){var o=e.apply(null,r);return o(i)}}return n.apply(this,arguments)}}var it=function(){return this.xf["@@transducer/init"]()},st=function(t){return this.xf["@@transducer/result"](t)};function ot(t){return"[object String]"===Object.prototype.toString.call(t)}var at=Q((function(t){return!!et(t)||!!t&&("object"==typeof t&&(!ot(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&(t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1)))))})),ut=function(){function t(t){this.f=t}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(t){return t},t.prototype["@@transducer/step"]=function(t,e){return this.f(t,e)},t}();var ct=Z((function(t,e){return K(t.length,(function(){return t.apply(e,arguments)}))}));function lt(t,e,n){for(var r=n.next();!r.done;){if((e=t["@@transducer/step"](e,r.value))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}r=n.next()}return t["@@transducer/result"](e)}function ht(t,e,n,r){return t["@@transducer/result"](n[r](ct(t["@@transducer/step"],t),e))}var ft="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function dt(t,e,n){if("function"==typeof t&&(t=function(t){return new ut(t)}(t)),at(n))return function(t,e,n){for(var r=0,i=n.length;r<i;){if((e=t["@@transducer/step"](e,n[r]))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}r+=1}return t["@@transducer/result"](e)}(t,e,n);if("function"==typeof n["fantasy-land/reduce"])return ht(t,e,n,"fantasy-land/reduce");if(null!=n[ft])return lt(t,e,n[ft]());if("function"==typeof n.next)return lt(t,e,n);if("function"==typeof n.reduce)return ht(t,e,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}function pt(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var mt=Object.prototype.toString,gt=function(){return"[object Arguments]"===mt.call(arguments)?function(t){return"[object Arguments]"===mt.call(t)}:function(t){return pt("callee",t)}}(),_t=!{toString:null}.propertyIsEnumerable("toString"),vt=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],yt=function(){return arguments.propertyIsEnumerable("length")}(),bt=function(t,e){for(var n=0;n<t.length;){if(t[n]===e)return!0;n+=1}return!1},xt="function"!=typeof Object.keys||yt?Q((function(t){if(Object(t)!==t)return[];var e,n,r=[],i=yt&&gt(t);for(e in t)!pt(e,t)||i&&"length"===e||(r[r.length]=e);if(_t)for(n=vt.length-1;n>=0;)pt(e=vt[n],t)&&!bt(r,e)&&(r[r.length]=e),n-=1;return r})):Q((function(t){return Object(t)!==t?[]:Object.keys(t)})),wt=Number.isInteger||function(t){return t<<0===t},At=Z((function(t,e){var n=t<0?e.length+t:t;return ot(e)?e.charAt(n):e[n]})),Tt=Z((function(t,e){return t.map((function(t){for(var n,r=e,i=0;i<t.length;){if(null==r)return;n=t[i],r=wt(n)?At(n,r):r[n],i+=1}return r}))})),St=Z((function(t,e){return Tt([t],e)[0]})),kt=Z((function(t,e){return St([t],e)})),Ct=tt(dt),Ot=Q((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)})),Et=Q((function(t){return!t}));function Mt(t,e){return function(){return e.call(this,t.apply(this,arguments))}}function It(t,e){return function(){var n=arguments.length;if(0===n)return e();var r=arguments[n-1];return et(r)||"function"!=typeof r[t]?e.apply(this,arguments):r[t].apply(r,Array.prototype.slice.call(arguments,0,n-1))}}var Dt=Q(It("tail",tt(It("slice",(function(t,e,n){return Array.prototype.slice.call(n,t,e)})))(1,1/0)));function Rt(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return K(arguments[0].length,Ct(Mt,arguments[0],Dt(arguments)))}var Nt=At(0);function Vt(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}function jt(t,e,n){for(var r=0,i=n.length;r<i;){if(t(e,n[r]))return!0;r+=1}return!1}var Ft="function"==typeof Object.is?Object.is:function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};function Pt(t,e,n,r){var i=Vt(t);function s(t,e){return qt(t,e,n.slice(),r.slice())}return!jt((function(t,e){return!jt(s,e,t)}),Vt(e),i)}function qt(t,e,n,r){if(Ft(t,e))return!0;var i,s,o=Ot(t);if(o!==Ot(e))return!1;if(null==t||null==e)return!1;if("function"==typeof t["fantasy-land/equals"]||"function"==typeof e["fantasy-land/equals"])return"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e)&&"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t);if("function"==typeof t.equals||"function"==typeof e.equals)return"function"==typeof t.equals&&t.equals(e)&&"function"==typeof e.equals&&e.equals(t);switch(o){case"Arguments":case"Array":case"Object":if("function"==typeof t.constructor&&"Promise"===(i=t.constructor,null==(s=String(i).match(/^function (\w*)/))?"":s[1]))return t===e;break;case"Boolean":case"Number":case"String":if(typeof t!=typeof e||!Ft(t.valueOf(),e.valueOf()))return!1;break;case"Date":if(!Ft(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(t.source!==e.source||t.global!==e.global||t.ignoreCase!==e.ignoreCase||t.multiline!==e.multiline||t.sticky!==e.sticky||t.unicode!==e.unicode)return!1}for(var a=n.length-1;a>=0;){if(n[a]===t)return r[a]===e;a-=1}switch(o){case"Map":return t.size===e.size&&Pt(t.entries(),e.entries(),n.concat([t]),r.concat([e]));case"Set":return t.size===e.size&&Pt(t.values(),e.values(),n.concat([t]),r.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var u=xt(t);if(u.length!==xt(e).length)return!1;var c=n.concat([t]),l=r.concat([e]);for(a=u.length-1;a>=0;){var h=u[a];if(!pt(h,e)||!qt(e[h],t[h],c,l))return!1;a-=1}return!0}var Bt=Z((function(t,e){return qt(t,e,[],[])})),Lt=At(-1),Wt=Z((function(t,e){return t%e}));function Ut(t){return Z((function(e,n){return K(Math.max(0,e.length-n.length),(function(){return e.apply(this,t(n,arguments))}))}))}var zt=Ut(J),Ht=function(){function t(t,e){this.xf=e,this.f=t}return t.prototype["@@transducer/init"]=it,t.prototype["@@transducer/result"]=st,t.prototype["@@transducer/step"]=function(t,e){return this.f(e),this.xf["@@transducer/step"](t,e)},t}(),Gt=Z(rt([],Z((function(t,e){return new Ht(t,e)})),(function(t,e){return t(e),e}))),Xt=G.curryN(2,(function(t,e){return G.combine((function(e,n){t(e())&&n(e.val)}),[e])}));function Yt(t,e){var n;return G.combine((function(e,r){r.hasVal&&t(e.val,n)||(r(e.val),n=e.val)}),[e])}var Qt=function(t){return Yt(Zt,t)};function Zt(t,e){return t===e}function $t(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),i=Math.round(t.g),s=Math.round(t.b),o=t.a,a=Math.round(t.h),u=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var l=t.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===n?"rgb("+r+","+i+","+s+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+s+","+o+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+s+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+s+","+o+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+s+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+s+",a:"+o+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+u+",v:"+c+",a:"+o+"}":"unknown format"}G.curryN(2,Yt);var Jt=Array.prototype.forEach,Kt=Array.prototype.slice,te={BREAK:{},extend:function(t){return this.each(Kt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(Kt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=Kt.call(arguments);return function(){for(var e=Kt.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(Jt&&t.forEach&&t.forEach===Jt)t.forEach(e,n);else if(t.length===t.length+0){var r,i=void 0;for(i=0,r=t.length;i<r;i++)if(i in t&&e.call(n,t[i],i)===this.BREAK)return}else for(var s in t)if(e.call(n,t[s],s)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var r=void 0;return function(){var i=this,s=arguments;function o(){r=null,n||t.apply(i,s)}var a=n||!r;clearTimeout(r),r=setTimeout(o,e),a&&t.apply(i,s)}},toArray:function(t){return t.toArray?t.toArray():Kt.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},ee=[{litmus:te.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:$t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:$t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:$t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:$t}}},{litmus:te.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:te.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:te.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(te.isNumber(t.r)&&te.isNumber(t.g)&&te.isNumber(t.b)&&te.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(te.isNumber(t.r)&&te.isNumber(t.g)&&te.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(te.isNumber(t.h)&&te.isNumber(t.s)&&te.isNumber(t.v)&&te.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(te.isNumber(t.h)&&te.isNumber(t.s)&&te.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],ne=void 0,re=void 0,ie=function(){re=!1;var t=arguments.length>1?te.toArray(arguments):arguments[0];return te.each(ee,(function(e){if(e.litmus(t))return te.each(e.conversions,(function(e,n){if(ne=e.read(t),!1===re&&!1!==ne)return re=ne,ne.conversionName=n,ne.conversion=e,te.BREAK})),te.BREAK})),re},se=void 0,oe={hsv_to_rgb:function(t,e,n){var r=Math.floor(t/60)%6,i=t/60-Math.floor(t/60),s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),u=[[n,a,s],[o,n,s],[s,n,a],[s,o,n],[a,s,n],[n,s,o]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,n){var r=Math.min(t,e,n),i=Math.max(t,e,n),s=i-r,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=t===i?(e-n)/s:e===i?2+(n-t)/s:4+(t-e)/s,(o/=6)<0&&(o+=1),{h:360*o,s:s/i,v:i/255})},rgb_to_hex:function(t,e,n){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(se=8*e)|t&~(255<<se)}},ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ce=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),le=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0},he=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},fe=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},de=function(){function t(){if(ue(this,t),this.__state=ie.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ce(t,[{key:"toString",value:function(){return $t(this)}},{key:"toHexString",value:function(){return $t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function pe(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||de.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(de.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function me(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||de.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(de.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}de.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=oe.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");te.extend(t.__state,oe.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},de.recalculateHSV=function(t){var e=oe.rgb_to_hsv(t.r,t.g,t.b);te.extend(t.__state,{s:e.s,v:e.v}),te.isNaN(e.h)?te.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},de.COMPONENTS=["r","g","b","h","s","v","hex","a"],pe(de.prototype,"r",2),pe(de.prototype,"g",1),pe(de.prototype,"b",0),me(de.prototype,"h"),me(de.prototype,"s"),me(de.prototype,"v"),Object.defineProperty(de.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(de.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=oe.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var ge=function(){function t(e,n){ue(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return ce(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),_e={};te.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){te.each(t,(function(t){_e[t]=e}))}));var ve=/(\d+(\.\d+)?)px/;function ye(t){if("0"===t||te.isUndefined(t))return 0;var e=t.match(ve);return te.isNull(e)?0:parseFloat(e[1])}var be={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var r=n,i=e;te.isUndefined(i)&&(i=!0),te.isUndefined(r)&&(r=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,r){var i=n||{},s=_e[e];if(!s)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(s);switch(s){case"MouseEvents":var a=i.x||i.clientX||0,u=i.y||i.clientY||0;o.initMouseEvent(e,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=o.initKeyboardEvent||o.initKeyEvent;te.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:o.initEvent(e,i.bubbles||!1,i.cancelable||!0)}te.defaults(o,r),t.dispatchEvent(o)},bind:function(t,e,n,r){var i=r||!1;return t.addEventListener?t.addEventListener(e,n,i):t.attachEvent&&t.attachEvent("on"+e,n),be},unbind:function(t,e,n,r){var i=r||!1;return t.removeEventListener?t.removeEventListener(e,n,i):t.detachEvent&&t.detachEvent("on"+e,n),be},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return be},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),r=n.indexOf(e);-1!==r&&(n.splice(r,1),t.className=n.join(" "))}else t.className=void 0;return be},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return ye(e["border-left-width"])+ye(e["border-right-width"])+ye(e["padding-left"])+ye(e["padding-right"])+ye(e.width)},getHeight:function(t){var e=getComputedStyle(t);return ye(e["border-top-width"])+ye(e["border-bottom-width"])+ye(e["padding-top"])+ye(e["padding-bottom"])+ye(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},xe=function(t){function e(t,n){ue(this,e);var r=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),be.bind(r.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return he(e,ge),ce(e,[{key:"setValue",value:function(t){var n=le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),we=function(t){function e(t,n,r){ue(this,e);var i=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=r,o=i;if(i.__select=document.createElement("select"),te.isArray(s)){var a={};te.each(s,(function(t){a[t]=t})),s=a}return te.each(s,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),o.__select.appendChild(n)})),i.updateDisplay(),be.bind(i.__select,"change",(function(){var t=this.options[this.selectedIndex].value;o.setValue(t)})),i.domElement.appendChild(i.__select),i}return he(e,ge),ce(e,[{key:"setValue",value:function(t){var n=le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return be.isActive(this.__select)?this:(this.__select.value=this.getValue(),le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),Ae=function(t){function e(t,n){ue(this,e);var r=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=r;function s(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),be.bind(r.__input,"keyup",s),be.bind(r.__input,"change",s),be.bind(r.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),be.bind(r.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return he(e,ge),ce(e,[{key:"updateDisplay",value:function(){return be.isActive(this.__input)||(this.__input.value=this.getValue()),le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Te(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Se=function(t){function e(t,n,r){ue(this,e);var i=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=r||{};return i.__min=s.min,i.__max=s.max,i.__step=s.step,te.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=Te(i.__impliedStep),i}return he(e,ge),ce(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Te(t),this}}]),e}();var ke=function(t){function e(t,n,r){ue(this,e);var i=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));i.__truncationSuspended=!1;var s=i,o=void 0;function a(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function u(t){var e=o-t.clientY;s.setValue(s.getValue()+e*s.__impliedStep),o=t.clientY}function c(){be.unbind(window,"mousemove",u),be.unbind(window,"mouseup",c),a()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),be.bind(i.__input,"change",(function(){var t=parseFloat(s.__input.value);te.isNaN(t)||s.setValue(t)})),be.bind(i.__input,"blur",(function(){a()})),be.bind(i.__input,"mousedown",(function(t){be.bind(window,"mousemove",u),be.bind(window,"mouseup",c),o=t.clientY})),be.bind(i.__input,"keydown",(function(t){13===t.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,a())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return he(e,Se),ce(e,[{key:"updateDisplay",value:function(){var t,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(t*r)/r),le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Ce(t,e,n,r,i){return r+(t-e)/(n-e)*(i-r)}var Oe=function(t){function e(t,n,r,i,s){ue(this,e);var o=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:r,max:i,step:s})),a=o;function u(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(Ce(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function c(){be.unbind(window,"mousemove",u),be.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(Ce(e,n.left,n.right,a.__min,a.__max))}function h(){be.unbind(window,"touchmove",l),be.unbind(window,"touchend",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),be.bind(o.__background,"mousedown",(function(t){document.activeElement.blur(),be.bind(window,"mousemove",u),be.bind(window,"mouseup",c),u(t)})),be.bind(o.__background,"touchstart",(function(t){if(1!==t.touches.length)return;be.bind(window,"touchmove",l),be.bind(window,"touchend",h),l(t)})),be.addClass(o.__background,"slider"),be.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return he(e,Se),ce(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",le(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),Ee=function(t){function e(t,n,r){ue(this,e);var i=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,be.bind(i.__button,"click",(function(t){return t.preventDefault(),s.fire(),!1})),be.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return he(e,ge),ce(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),Me=function(t){function e(t,n){ue(this,e);var r=fe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));r.__color=new de(r.getValue()),r.__temp=new de(0);var i=r;r.domElement=document.createElement("div"),be.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",be.bind(r.__input,"keydown",(function(t){13===t.keyCode&&h.call(this)})),be.bind(r.__input,"blur",h),be.bind(r.__selector,"mousedown",(function(){be.addClass(this,"drag").bind(window,"mouseup",(function(){be.removeClass(i.__selector,"drag")}))})),be.bind(r.__selector,"touchstart",(function(){be.addClass(this,"drag").bind(window,"touchend",(function(){be.removeClass(i.__selector,"drag")}))}));var s,o=document.createElement("div");function a(t){d(t),be.bind(window,"mousemove",d),be.bind(window,"touchmove",d),be.bind(window,"mouseup",c),be.bind(window,"touchend",c)}function u(t){p(t),be.bind(window,"mousemove",p),be.bind(window,"touchmove",p),be.bind(window,"mouseup",l),be.bind(window,"touchend",l)}function c(){be.unbind(window,"mousemove",d),be.unbind(window,"touchmove",d),be.unbind(window,"mouseup",c),be.unbind(window,"touchend",c),f()}function l(){be.unbind(window,"mousemove",p),be.unbind(window,"touchmove",p),be.unbind(window,"mouseup",l),be.unbind(window,"touchend",l),f()}function h(){var t=ie(this.value);!1!==t?(i.__color.__state=t,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function f(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function d(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,r=n.clientX,s=n.clientY,o=(r-e.left)/(e.right-e.left),a=1-(s-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),o>1?o=1:o<0&&(o=0),i.__color.v=a,i.__color.s=o,i.setValue(i.__color.toOriginal()),!1}function p(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return te.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),te.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),te.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),te.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),te.extend(o.style,{width:"100%",height:"100%",background:"none"}),De(o,"top","rgba(0,0,0,0)","#000"),te.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(s=r.__hue_field).style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",te.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),be.bind(r.__saturation_field,"mousedown",a),be.bind(r.__saturation_field,"touchstart",a),be.bind(r.__field_knob,"mousedown",a),be.bind(r.__field_knob,"touchstart",a),be.bind(r.__hue_field,"mousedown",u),be.bind(r.__hue_field,"touchstart",u),r.__saturation_field.appendChild(o),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return he(e,ge),ce(e,[{key:"updateDisplay",value:function(){var t=ie(this.getValue());if(!1!==t){var e=!1;te.each(de.COMPONENTS,(function(n){if(!te.isUndefined(t[n])&&!te.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&te.extend(this.__color.__state,t)}te.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;te.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,De(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),te.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(),Ie=["-moz-","-o-","-webkit-","-ms-",""];function De(t,e,n,r){t.style.background="",te.each(Ie,(function(i){t.style.cssText+="background: "+i+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "}))}var Re=function(t,e){var n=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(s){}},Ne='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',Ve=function(t,e){var n=t[e];return te.isArray(arguments[2])||te.isObject(arguments[2])?new we(t,e,arguments[2]):te.isNumber(n)?te.isNumber(arguments[2])&&te.isNumber(arguments[3])?te.isNumber(arguments[4])?new Oe(t,e,arguments[2],arguments[3],arguments[4]):new Oe(t,e,arguments[2],arguments[3]):te.isNumber(arguments[4])?new ke(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ke(t,e,{min:arguments[2],max:arguments[3]}):te.isString(n)?new Ae(t,e):te.isFunction(n)?new Ee(t,e,""):te.isBoolean(n)?new xe(t,e):null};var je=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},Fe=function(){function t(){ue(this,t),this.backgroundElement=document.createElement("div"),te.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),be.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),te.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;be.bind(this.backgroundElement,"click",(function(){e.hide()}))}return ce(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),te.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",be.unbind(t.domElement,"webkitTransitionEnd",e),be.unbind(t.domElement,"transitionend",e),be.unbind(t.domElement,"oTransitionEnd",e)};be.bind(this.domElement,"webkitTransitionEnd",e),be.bind(this.domElement,"transitionend",e),be.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-be.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-be.getHeight(this.domElement)/2+"px"}}]),t}();Re(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Pe=function(){try{return!!window.localStorage}catch(t){return!1}}(),qe=void 0,Be=!0,Le=void 0,We=!1,Ue=[],ze=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),be.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=te.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=te.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),te.isUndefined(r.load)?r.load={preset:"Default"}:r.preset&&(r.load.preset=r.preset),te.isUndefined(r.parent)&&r.hideable&&Ue.push(this),r.resizable=te.isUndefined(r.parent)&&r.resizable,r.autoPlace&&te.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,s=Pe&&"true"===localStorage.getItem(Ze(this,"isLocal")),o=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(t){n.parent?n.getRoot().preset=t:r.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return r.width},set:function(t){r.width=t,tn(n,t)}},name:{get:function(){return r.name},set:function(t){r.name=t,a&&(a.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?be.addClass(n.__ul,t.CLASS_CLOSED):be.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(t){Pe&&(s=t,t?be.bind(window,"unload",o):be.unbind(window,"unload",o),localStorage.setItem(Ze(n,"isLocal"),t))}}}),te.isUndefined(r.parent)){if(this.closed=r.closed||!1,be.addClass(this.domElement,t.CLASS_MAIN),be.makeSelectable(this.domElement,!1),Pe&&s){n.useLocalStorage=!0;var u=localStorage.getItem(Ze(this,"gui"));u&&(r.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,be.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(be.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(be.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),be.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var c=document.createTextNode(r.name);be.addClass(c,"controller-name"),a=He(n,c);be.addClass(this.__ul,t.CLASS_CLOSED),be.addClass(a,"title"),be.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(te.isUndefined(r.parent)&&(Be&&(Le=document.createElement("div"),be.addClass(Le,"dg"),be.addClass(Le,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Le),Be=!1),Le.appendChild(this.domElement),be.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||tn(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},be.bind(window,"resize",this.__resizeHandler),be.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),be.bind(this.__ul,"transitionend",this.__resizeHandler),be.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&function(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function r(){be.removeClass(t.__closeButton,ze.CLASS_DRAG),be.unbind(window,"mousemove",n),be.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),e=i.clientX,be.addClass(t.__closeButton,ze.CLASS_DRAG),be.bind(window,"mousemove",n),be.bind(window,"mouseup",r),!1}t.__resize_handle=document.createElement("div"),te.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),be.bind(t.__resize_handle,"mousedown",i),be.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this),o=function(){Pe&&"true"===localStorage.getItem(Ze(n,"isLocal"))&&localStorage.setItem(Ze(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,r.parent||((i=n.getRoot()).width+=1,te.defer((function(){i.width-=1})))};function He(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function Ge(t){be.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&be.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Xe(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function Ye(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[e.property]=e,n.load&&n.load.remembered){var s=n.load.remembered,o=void 0;if(s[t.preset])o=s[t.preset];else{if(!s.Default)return;o=s.Default}if(o[r]&&void 0!==o[r][e.property]){var a=o[r][e.property];e.initialValue=a,e.setValue(a)}}}}function Qe(t,e,n,r){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new Me(e,n);else{var s=[e,n].concat(r.factoryArgs);i=Ve.apply(t,s)}r.before instanceof ge&&(r.before=r.before.__li),Ye(t,i),be.addClass(i.domElement,"c");var o=document.createElement("span");be.addClass(o,"property-name"),o.innerHTML=i.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(i.domElement);var u=He(t,a,r.before);return be.addClass(u,ze.CLASS_CONTROLLER_ROW),i instanceof Me?be.addClass(u,"color"):be.addClass(u,ae(i.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,te.extend(n,{options:function(e){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),Qe(t,n.object,n.property,{before:r,factoryArgs:[te.toArray(arguments)]})}if(te.isArray(e)||te.isObject(e)){var i=n.__li.nextElementSibling;return n.remove(),Qe(t,n.object,n.property,{before:i,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Oe){var r=new ke(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});te.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],i=r[t];n[t]=r[t]=function(){var t=Array.prototype.slice.call(arguments);return i.apply(r,t),e.apply(n,t)}})),be.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ke){var i=function(e){if(te.isNumber(n.__min)&&te.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var s=Qe(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return s.name(r),i&&s.listen(),s}return e};n.min=te.compose(i,n.min),n.max=te.compose(i,n.max)}else n instanceof xe?(be.bind(e,"click",(function(){be.fakeEvent(n.__checkbox,"click")})),be.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof Ee?(be.bind(e,"click",(function(){be.fakeEvent(n.__button,"click")})),be.bind(e,"mouseover",(function(){be.addClass(n.__button,"hover")})),be.bind(e,"mouseout",(function(){be.removeClass(n.__button,"hover")}))):n instanceof Me&&(be.addClass(e,"color"),n.updateDisplay=te.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=te.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&Xe(t.getRoot(),!0),e}),n.setValue)}(t,u,i),t.__controllers.push(i),i}function Ze(t,e){return document.location.href+"."+e}function $e(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function Je(t,e){e.style.display=t.useLocalStorage?"block":"none"}function Ke(t){var e=t.__save_row=document.createElement("li");be.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),be.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",be.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",be.addClass(r,"button"),be.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",be.addClass(i,"button"),be.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",be.addClass(s,"button"),be.addClass(s,"revert");var o=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?te.each(t.load.remembered,(function(e,n){$e(t,n,n===t.preset)})):$e(t,"Default",!1),be.bind(o,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(o),e.appendChild(n),e.appendChild(r),e.appendChild(i),e.appendChild(s),Pe){var a=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Ze(0,"isLocal"))&&u.setAttribute("checked","checked"),Je(t,a),be.bind(u,"change",(function(){t.useLocalStorage=!t.useLocalStorage,Je(t,a)}))}var c=document.getElementById("dg-new-constructor");be.bind(c,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||qe.hide()})),be.bind(n,"click",(function(){c.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),qe.show(),c.focus(),c.select()})),be.bind(r,"click",(function(){t.save()})),be.bind(i,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),be.bind(s,"click",(function(){t.revert()}))}function tn(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function en(t,e){var n={};return te.each(t.__rememberedObjects,(function(r,i){var s={},o=t.__rememberedObjectIndecesToControllers[i];te.each(o,(function(t,n){s[n]=e?t.initialValue:t.getValue()})),n[i]=s})),n}function nn(t){0!==t.length&&je.call(window,(function(){nn(t)})),te.each(t,(function(t){t.updateDisplay()}))}ze.toggleHide=function(){We=!We,te.each(Ue,(function(t){t.domElement.style.display=We?"none":""}))},ze.CLASS_AUTO_PLACE="a",ze.CLASS_AUTO_PLACE_CONTAINER="ac",ze.CLASS_MAIN="main",ze.CLASS_CONTROLLER_ROW="cr",ze.CLASS_TOO_TALL="taller-than-window",ze.CLASS_CLOSED="closed",ze.CLASS_CLOSE_BUTTON="close-button",ze.CLASS_CLOSE_TOP="close-top",ze.CLASS_CLOSE_BOTTOM="close-bottom",ze.CLASS_DRAG="drag",ze.DEFAULT_WIDTH=245,ze.TEXT_CLOSED="Close Controls",ze.TEXT_OPEN="Open Controls",ze._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||ze.toggleHide()},be.bind(window,"keydown",ze._keydownHandler,!1),te.extend(ze.prototype,{add:function(t,e){return Qe(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Qe(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;te.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Le.removeChild(this.domElement);var t=this;te.each(this.__folders,(function(e){t.removeFolder(e)})),be.unbind(window,"keydown",ze._keydownHandler,!1),Ge(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new ze(e);this.__folders[t]=n;var r=He(this,n.domElement);return be.addClass(r,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Ge(t);var e=this;te.each(t.__folders,(function(e){t.removeFolder(e)})),te.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=be.getOffset(t.__ul).top,n=0;te.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=be.getHeight(e))})),window.innerHeight-e-20<n?(be.addClass(t.domElement,ze.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(be.removeClass(t.domElement,ze.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&te.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:te.debounce((function(){this.onResize()}),50),remember:function(){if(te.isUndefined(qe)&&((qe=new Fe).domElement.innerHTML=Ne),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;te.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&Ke(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&tn(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=en(this)),t.folders={},te.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=en(this),Xe(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=en(this,!0)),this.load.remembered[t]=en(this),this.preset=t,$e(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){te.each(this.__controllers,(function(e){this.getRoot().load.remembered?Ye(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),te.each(this.__folders,(function(t){t.revert(t)})),t||Xe(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&nn(this.__listening)},updateDisplay:function(){te.each(this.__controllers,(function(t){t.updateDisplay()})),te.each(this.__folders,(function(t){t.updateDisplay()}))}});var rn=ze;const sn=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),on=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),an=(t,e)=>({startTime:e,type:"setValue",value:t}),un=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),cn=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),ln=t=>"exponentialRampToValue"===t.type,hn=t=>"linearRampToValue"===t.type,fn=t=>ln(t)||hn(t),dn=t=>"setValue"===t.type,pn=t=>"setValueCurve"===t.type,mn=(t,e,n,r)=>{const i=t[e];return void 0===i?r:fn(i)||dn(i)?i.value:pn(i)?i.values[i.values.length-1]:cn(n,mn(t,e-1,i.startTime,r),i)},gn=(t,e,n,r,i)=>void 0===n?[r.insertTime,i]:fn(n)?[n.endTime,n.value]:dn(n)?[n.startTime,n.value]:pn(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,mn(t,e-1,n.startTime,i)],_n=t=>"cancelAndHold"===t.type,vn=t=>"cancelScheduledValues"===t.type,yn=t=>_n(t)||vn(t)?t.cancelTime:ln(t)||hn(t)?t.endTime:t.startTime,bn=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,xn=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),wn=(t,{duration:e,startTime:n,values:r})=>((t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]})(r,(t-n)/e*(r.length-1)),An=t=>"setTarget"===t.type;class Tn{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=yn(t);if(_n(t)||vn(t)){const n=this._automationEvents.findIndex((n=>vn(t)&&pn(n)?n.startTime+n.duration>=e:yn(n)>=e)),r=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),_n(t)){const t=this._automationEvents[this._automationEvents.length-1];if(void 0!==r&&fn(r)){if(An(t))throw new Error("The internal list is malformed.");const n=pn(t)?t.startTime+t.duration:yn(t),i=pn(t)?t.values[t.values.length-1]:t.value,s=ln(r)?bn(e,n,i,r):xn(e,n,i,r),o=ln(r)?sn(s,e,this._currenTime):on(s,e,this._currenTime);this._automationEvents.push(o)}void 0!==t&&An(t)&&this._automationEvents.push(an(this.getValue(e),e)),void 0!==t&&pn(t)&&t.startTime+t.duration>e&&(this._automationEvents[this._automationEvents.length-1]=un(new Float32Array([6,7]),t.startTime,e-t.startTime))}}else{const n=this._automationEvents.findIndex((t=>yn(t)>e)),r=-1===n?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(void 0!==r&&pn(r)&&yn(r)+r.duration>e)return!1;const i=ln(t)?sn(t.value,t.endTime,this._currenTime):hn(t)?on(t.value,e,this._currenTime):t;if(-1===n)this._automationEvents.push(i);else{if(pn(t)&&e+t.duration>yn(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,i)}}return!0}flush(t){const e=this._automationEvents.findIndex((e=>yn(e)>t));if(e>1){const t=this._automationEvents.slice(e-1),n=t[0];An(n)&&t.unshift(an(mn(this._automationEvents,e-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=t}}getValue(t){if(0===this._automationEvents.length)return this._defaultValue;const e=this._automationEvents.findIndex((e=>yn(e)>t)),n=this._automationEvents[e],r=(-1===e?this._automationEvents.length:e)-1,i=this._automationEvents[r];if(void 0!==i&&An(i)&&(void 0===n||!fn(n)||n.insertTime>t))return cn(t,mn(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(void 0!==i&&dn(i)&&(void 0===n||!fn(n)))return i.value;if(void 0!==i&&pn(i)&&(void 0===n||!fn(n)||i.startTime+i.duration>t))return t<i.startTime+i.duration?wn(t,i):i.values[i.values.length-1];if(void 0!==i&&fn(i)&&(void 0===n||!fn(n)))return i.value;if(void 0!==n&&ln(n)){const[e,s]=gn(this._automationEvents,r,i,n,this._defaultValue);return bn(t,e,s,n)}if(void 0!==n&&hn(n)){const[e,s]=gn(this._automationEvents,r,i,n,this._defaultValue);return xn(t,e,s,n)}return this._defaultValue}}const Sn=new WeakSet,kn=new WeakMap,Cn=new WeakMap,On=new WeakMap,En=new WeakMap,Mn=new WeakMap,In=new WeakMap,Dn=new WeakMap,Rn=new WeakMap,Nn=new WeakMap,Vn={construct:()=>Vn},jn=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Fn=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(jn);for(;null!==i;){const t=i[1].slice(1,-1),s=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(s),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(jn)}return[n.join(";"),r]},Pn=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},qn=t=>{if(!(t=>{try{new new Proxy(t,Vn)}catch(e){return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Bn=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},Ln=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[r]=n;return t.delete(r),r},Wn=(t,e,n,r)=>{const i=Bn(t,e),s=Ln(i,(t=>t[0]===n&&t[1]===r));return 0===i.size&&t.delete(e),s},Un=t=>Bn(In,t),zn=t=>{if(Sn.has(t))throw new Error("The AudioNode is already stored.");Sn.add(t),Un(t).forEach((t=>t(!0)))},Hn=t=>"port"in t,Gn=t=>{if(!Sn.has(t))throw new Error("The AudioNode is not stored.");Sn.delete(t),Un(t).forEach((t=>t(!1)))},Xn=(t,e)=>{!Hn(t)&&e.every((t=>0===t.size))&&Gn(t)},Yn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Qn=(t,e)=>t.context===e,Zn=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch(e){return!1}return!0},$n=()=>new DOMException("","IndexSizeError"),Jn=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(r){if(12===r.code)throw $n();throw r}})},Kn={numberOfChannels:1},tr=-34028234663852886e22,er=-tr,nr=t=>Sn.has(t),rr={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},ir=t=>Bn(kn,t),sr=t=>Bn(On,t),or=(t,e)=>{const{activeInputs:n}=ir(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||or(n,[...e,t])}))));const r=(t=>"playbackRate"in t)(t)?[t.playbackRate]:Hn(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const i of r){const t=sr(i);void 0!==t&&t.activeInputs.forEach((([t])=>or(t,e)))}nr(t)&&Gn(t)},ar=t=>{or(t.destination,[])},ur=t=>"context"in t,cr=t=>ur(t[0]),lr=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},hr=(t,e,[n,r],i)=>{lr(t,[e,n,r],(t=>t[0]===e&&t[1]===n),i)},fr=(t,[e,n,r],i)=>{const s=t.get(e);void 0===s?t.set(e,new Set([[n,r]])):lr(s,[n,r],(t=>t[0]===n),i)},dr=t=>"inputs"in t,pr=(t,e,n,r)=>{if(dr(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},mr=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},gr=(t,e)=>{if(!Un(t).delete(e))throw new Error("Missing the expected event listener.")},_r=(t,e,n)=>{const r=Bn(t,e),i=Ln(r,(t=>t[0]===n));return 0===r.size&&t.delete(e),i},vr=(t,e,n,r)=>{dr(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},yr=t=>Bn(Cn,t),br=t=>Bn(En,t),xr=t=>Dn.has(t),wr=t=>!Sn.has(t),Ar=t=>new Promise((e=>{const n=t.createScriptProcessor(256,1,1),r=t.createGain(),i=t.createBuffer(1,2,44100),s=i.getChannelData(0);s[0]=1,s[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(n).connect(t.destination),o.connect(r),o.disconnect(r),n.onaudioprocess=r=>{const i=r.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?e(!0):e(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(t.destination)},o.start()})),Tr=(t,e)=>{const n=new Map;for(const r of t)for(const t of r){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},Sr=t=>"context"in t,kr=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=sr(e),{outputs:o}=ir(t),a=Un(t),u=o=>{const a=yr(t),u=br(e);if(o){const e=_r(s,t,n);hr(i,t,e,!1),r||xr(t)||a.connect(u,n)}else{const e=((t,e,n)=>Ln(t,(t=>t[0]===e&&t[1]===n)))(i,t,n);fr(s,e,!1),r||xr(t)||a.disconnect(u,n)}};return!!lr(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(u),nr(t)?hr(i,t,[n,u],!0):fr(s,[t,n,u],!0),!0)},Cr=(t,e,n,r,i)=>{const[s,o]=((t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=ir(e),o=mr(i[r],t,n);if(null===o)return[Wn(s,t,n,r)[2],!1];return[o[2],!0]})(t,n,r,i);if(null!==s&&(gr(t,s),!o||e||xr(t)||vr(yr(t),yr(n),r,i)),nr(n)){const{activeInputs:t}=ir(n);Xn(n,t)}},Or=(t,e,n,r)=>{const[i,s]=((t,e,n)=>{const{activeInputs:r,passiveInputs:i}=sr(e),s=mr(r,t,n);if(null===s)return[_r(i,t,n)[1],!1];return[s[2],!0]})(t,n,r);null!==i&&(gr(t,i),!s||e||xr(t)||yr(t).disconnect(br(n),r))};class Er{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,r)=>t.call(e,n,r,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const Mr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Ir(t,e,n,r,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(0===e[n].byteLength)e[n]=s.slice(i,i+128);else{const t=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const Dr=(t,e,n,r,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],r,i):0!==e[n].byteLength&&t.getChannelData(r).set(e[n],i)},Rr=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const t=[],i="number"==typeof e?e:e[r];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},Nr=async(t,e,n,r,i,o,a)=>{const u=null===e?128*Math.ceil(t.context.length/128):e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce(((t,e)=>t+e),0),h=0===l?null:n.createBuffer(l,u,n.sampleRate);if(void 0===o)throw new Error("Missing the processor constructor.");const f=ir(t),d=await((t,e)=>{const n=Bn(Nn,t),r=yr(e);return Bn(n,r)})(n,t),p=Rr(r.numberOfInputs,r.channelCount),m=Rr(r.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce(((t,e)=>s(s({},t),{[e]:new Float32Array(128)})),{});for(let s=0;s<u;s+=128){if(r.numberOfInputs>0&&null!==e)for(let t=0;t<r.numberOfInputs;t+=1)for(let n=0;n<r.channelCount;n+=1)Ir(e,p[t],n,n,s);void 0!==o.parameterDescriptors&&null!==e&&o.parameterDescriptors.forEach((({name:t},n)=>{Ir(e,g,t,c+n,s)}));for(let t=0;t<r.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===m[t][e].byteLength&&(m[t][e]=new Float32Array(128));try{const t=p.map(((t,e)=>0===f.activeInputs[e].size?[]:t)),e=a(s/n.sampleRate,n.sampleRate,(()=>d.process(t,m,g)));if(null!==h)for(let n=0,o=0;n<r.numberOfOutputs;n+=1){for(let t=0;t<i[n];t+=1)Dr(h,m[n],t,o+t,s);o+=i[n]}if(!e)break}catch(_){t.dispatchEvent(new ErrorEvent("processorerror",{colno:_.colno,filename:_.filename,lineno:_.lineno,message:_.message}));break}}return h},Vr={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},jr={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Fr={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Pr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},qr={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Br={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Lr=(t,e,n)=>{const r=e[n];if(void 0===r)throw t();return r},Wr={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Ur={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},zr=()=>new DOMException("","InvalidStateError"),Hr=()=>new DOMException("","InvalidAccessError"),Gr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Xr=(t,e,n,r,i,s,o,a,u,c,l)=>{const h=c.length;let f=a;for(let d=0;d<h;d+=1){let a=n[0]*c[d];for(let e=1;e<i;e+=1){const r=f-e&u-1;a+=n[e]*s[r],a-=t[e]*o[r]}for(let t=i;t<r;t+=1)a+=n[t]*s[f-t&u-1];for(let n=i;n<e;n+=1)a-=t[n]*o[f-n&u-1];s[f]=c[d],o[f]=a,f=f+1&u-1,l[d]=a}return f},Yr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Qr=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch(n){}return!1},Zr=(t,e,n)=>{const r=e[n];void 0!==r&&r!==t[n]&&(t[n]=r)},$r=(t,e)=>{Zr(t,e,"channelCount"),Zr(t,e,"channelCountMode"),Zr(t,e,"channelInterpretation")},Jr=t=>"function"==typeof t.getFloatTimeDomainData,Kr=(t,e,n)=>{const r=e[n];void 0!==r&&r!==t[n].value&&(t[n].value=r)},ti=t=>{var e;t.start=(e=t.start,(n=0,r=0,i)=>{if("number"==typeof i&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})},ei=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},ni=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),ri=async(t,e)=>new t(await(t=>new Promise(((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:t})=>{r.close(),i.close(),e(t)},r.onmessageerror=({data:t})=>{r.close(),i.close(),n(t)},i.postMessage(t)})))(e)),ii=(t,e)=>{const n=t.createBiquadFilter();return $r(n,e),Kr(n,e,"Q"),Kr(n,e,"detune"),Kr(n,e,"frequency"),Kr(n,e,"gain"),Zr(n,e,"type"),n},si=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return $r(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw zr()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw zr()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw zr()}})})(n),n},oi=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),ai=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return $r(n,e),Kr(n,e,"delayTime"),n},ui=(t,e)=>{const n=t.createGain();return $r(n,e),Kr(n,e,"gain"),n};function ci(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function li(t,e){let n=[0,0];for(let s=t.length-1;s>=0;s-=1)i=e,n=[(r=n)[0]*i[0]-r[1]*i[1],r[0]*i[1]+r[1]*i[0]],n[0]+=t[s];var r,i;return n}const hi=(t,e,n,r)=>t.createScriptProcessor(e,n,r),fi=()=>new DOMException("","NotSupportedError"),di={numberOfChannels:1},pi={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},mi={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},gi={disableNormalization:!1},_i={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},vi={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},yi=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},bi=(t,e,n,r)=>{let i=Object.getPrototypeOf(t);for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(o)})},xi=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(9!==r.code)throw r;xi(t,e,n+1e-7)}},wi=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},Ai=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch(r){return!1}},Ti=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},Si=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=t.disconnect,()=>{i.call(t,n),t.removeEventListener("ended",r)});var i;t.addEventListener("ended",r),oi(t,n),t.stop=(e=>{let r=!1;return(i=0)=>{if(r)try{e.call(t,i)}catch(s){n.gain.setValueAtTime(0,i)}else e.call(t,i),r=!0}})(t.stop)},ki=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},Ci=(Oi=lr,(t,e,[n,r,i],s)=>{Oi(t[r],[e,n,i],(t=>t[0]===e&&t[1]===n),s)});var Oi;const Ei=(t=>(e,n,[r,i,s],o)=>{const a=e.get(r);void 0===a?e.set(r,new Set([[i,n,s]])):t(a,[i,n,s],(t=>t[0]===i&&t[1]===n),o)})(lr),Mi=(Ii=Ln,(t,e,n,r)=>Ii(t[r],(t=>t[0]===e&&t[1]===n)));var Ii;const Di=new WeakMap,Ri=(Ni=Di,t=>{var e;return null!==(e=Ni.get(t))&&void 0!==e?e:0});var Ni;const Vi=(ji=new Map,Fi=new WeakMap,(t,e)=>{const n=Fi.get(t);if(void 0!==n)return n;const r=ji.get(t);if(void 0!==r)return r;try{const n=e();return n instanceof Promise?(ji.set(t,n),n.catch((()=>!1)).then((e=>(ji.delete(t),Fi.set(t,e),e)))):(Fi.set(t,n),n)}catch(i){return Fi.set(t,!1),!1}});var ji,Fi;const Pi="undefined"==typeof window?null:window,qi=(Bi=Vi,Li=$n,(t,e)=>{const n=t.createAnalyser();if($r(n,e),!(e.maxDecibels>e.minDecibels))throw Li();return Zr(n,e,"fftSize"),Zr(n,e,"maxDecibels"),Zr(n,e,"minDecibels"),Zr(n,e,"smoothingTimeConstant"),Bi(Jr,(()=>Jr(n)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let t=0;t<r;t+=1)e[t]=.0078125*(n[t]-128);return e}})(n),n});var Bi,Li;const Wi=(Ui=ir,t=>{const e=Ui(t);if(null===e.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer});var Ui;const zi=((t,e,n)=>async(r,i,s,o)=>{const a=t(r),u=[...o,r];await Promise.all(a.activeInputs.map(((t,o)=>Array.from(t).filter((([t])=>!u.includes(t))).map((async([t,a])=>{const c=e(t),l=await c.render(t,i,u),h=r.context.destination;n(t)||r===h&&n(r)||l.connect(s,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(ir,Wi,xr),Hi=(Gi=qi,Xi=yr,Yi=zi,()=>{const t=new WeakMap;return{render(e,n,r){const i=t.get(n);return void 0!==i?Promise.resolve(i):(async(e,n,r)=>{let i=Xi(e);if(!Qn(i,n)){const t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,fftSize:i.fftSize,maxDecibels:i.maxDecibels,minDecibels:i.minDecibels,smoothingTimeConstant:i.smoothingTimeConstant};i=Gi(n,t)}return t.set(n,i),await Yi(e,n,i,r),i})(e,n,r)}}});var Gi,Xi,Yi;const Qi=(Zi=Mn,t=>{const e=Zi.get(t);if(void 0===e)throw zr();return e});var Zi;const $i=null===(Ji=Pi)?null:Ji.hasOwnProperty("OfflineAudioContext")?Ji.OfflineAudioContext:Ji.hasOwnProperty("webkitOfflineAudioContext")?Ji.webkitOfflineAudioContext:null;var Ji;const Ki=(ts=$i,t=>null!==ts&&t instanceof ts);var ts;const es=new WeakMap,ns=(rs=ki,class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,e,n){if(null!==e){let r=this._listeners.get(e);void 0===r&&(r=rs(this,e),"function"==typeof e&&this._listeners.set(e,r)),this._nativeEventTarget.addEventListener(t,r,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const r=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===r?null:r,n)}});var rs;const is=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(Pi),ss=(os=is,t=>null!==os&&t instanceof os);var os;const as=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(Pi),us=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(Pi),cs=((t,e,n,r,i,s,o,a,u,c,l,h,f,d,p)=>class extends c{constructor(e,r,i,s){super(i),this._context=e,this._nativeAudioNode=i;const o=l(e);h(o)&&!0!==n(Ar,(()=>Ar(o)))&&(t=>{const e=new Map;var n,r;t.connect=(n=t.connect.bind(t),(t,r=0,i=0)=>{const s=Sr(t)?n(t,r,i):n(t,r),o=e.get(t);return void 0===o?e.set(t,[{input:i,output:r}]):o.every((t=>t.input!==i||t.output!==r))&&o.push({input:i,output:r}),s}),t.disconnect=(r=t.disconnect,(n,i,s)=>{if(r.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,r]of e){const i=r.filter((t=>t.output!==n));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(n))if(void 0===i)e.delete(n);else{const t=e.get(n);if(void 0!==t){const r=t.filter((t=>t.output!==i&&(t.input!==s||void 0===s)));0===r.length?e.delete(n):e.set(n,r)}}for(const[r,o]of e)o.forEach((e=>{Sr(r)?t.connect(r,e.output,e.input):t.connect(r,e.output)}))})})(i),Cn.set(this,i),In.set(this,new Set),"closed"!==e.state&&r&&zn(this),t(this,s,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=l(this._context),h=p(c);if(f(t)||d(t))throw s();if(ur(t)){const i=yr(t);try{const e=pr(this._nativeAudioNode,i,n,a),r=wr(this);(h||r)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!r&&wr(t)&&zn(t)}catch(g){if(12===g.code)throw s();throw g}if(e(this,t,n,a,h)){const e=u([this],t);Tr(e,r(h))}return t}const m=br(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||wr(this))&&this._nativeAudioNode.disconnect(m,n)}catch(g){if(12===g.code)throw s();throw g}if(kr(this,t,n,h)){const e=u([this],t);Tr(e,r(h))}}disconnect(t,e,n){let r;const o=l(this._context),c=p(o);if(void 0===t)r=((t,e)=>{const n=ir(t),r=[];for(const i of n.outputs)cr(i)?Cr(t,e,...i):Or(t,e,...i),r.push(i[0]);return n.outputs.clear(),r})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();r=((t,e,n)=>{const r=ir(t),i=[];for(const s of r.outputs)s[1]===n&&(cr(s)?Cr(t,e,...s):Or(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(ur(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(r=((t,e,n,r,i)=>{const s=ir(t);return Array.from(s.outputs).filter((t=>!(t[0]!==n||void 0!==r&&t[1]!==r||void 0!==i&&t[2]!==i))).map((n=>(cr(n)?Cr(t,e,...n):Or(t,e,...n),s.outputs.delete(n),n[0])))})(this,c,t,e,n),0===r.length)throw s()}for(const i of r){const t=u([this],i);Tr(t,a)}}})((ls=kn,(t,e,n)=>{const r=[];for(let i=0;i<n.numberOfInputs;i+=1)r.push(new Set);ls.set(t,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,r,i,s,o,a,u,c,l,h,f)=>{const d=new WeakMap;return(p,m,g,_,v)=>{const{activeInputs:y,passiveInputs:b}=s(m),{outputs:x}=s(p),w=a(p),A=s=>{const a=u(m),c=u(p);if(s){const e=Wn(b,p,g,_);t(y,p,e,!1),v||h(p)||n(c,a,g,_),f(m)&&zn(m)}else{const t=r(y,p,g,_);e(b,_,t,!1),v||h(p)||i(c,a,g,_);const n=o(m);if(0===n)l(m)&&Xn(m,y);else{const t=d.get(m);void 0!==t&&clearTimeout(t),d.set(m,setTimeout((()=>{l(m)&&Xn(m,y)}),1e3*n))}}};return!!c(x,[m,g,_],(t=>t[0]===m&&t[1]===g&&t[2]===_),!0)&&(w.add(A),l(p)?t(y,p,[g,_,A],!0):e(b,_,[p,g,A],!0),!0)}})(Ci,Ei,pr,Mi,vr,ir,Ri,Un,yr,lr,nr,xr,wr),Vi,((t,e,n,r,i,s)=>o=>(a,u)=>{const c=t.get(a);if(void 0===c){if(!o&&s(a)){const t=r(a),{outputs:s}=n(a);for(const n of s)if(cr(n)){const i=r(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,u)}else t.set(a,c+u)})(Dn,vr,ir,yr,br,nr),$n,Hr,fi,((t,e,n,r,i,s,o,a)=>(u,c)=>{const l=e.get(u);if(void 0===l)throw new Error("Missing the expected cycle count.");const h=s(u.context),f=a(h);if(l===c){if(e.delete(u),!f&&o(u)){const e=r(u),{outputs:s}=n(u);for(const n of s)if(cr(n)){const i=r(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(u,l-c)})(pr,Dn,ir,yr,br,Qi,nr,Ki),((t,e,n)=>function r(i,s){const o=ur(s)?s:n(t,s);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>r([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(es,ir,Bn),ns,Qi,ss,as,us,Ki);var ls;const hs=((t,e,n,r,i,o)=>class extends t{constructor(t,n){const a=i(t),u=s(s({},Yn),n),c=r(a,u);super(t,!1,c,o(a)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(cs,Hi,$n,qi,Qi,Ki),fs=new WeakSet,ds=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(Pi),ps=(ms=new Uint32Array(1),t=>(ms[0]=t,ms[0]));var ms;const gs=((t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const u=n.length,c=n.getChannelData(a),l=r.length;for(let t=o<0?-o:0;t+o<u&&t<l;t+=1)r[t]=c[t+o]},n.copyToChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const u=n.length,c=n.getChannelData(a),l=r.length;for(let t=o<0?-o:0;t+o<u&&t<l;t+=1)c[t+o]=r[t]}})(ps,$n),_s=(vs=ps,t=>{var e,n;t.copyFromChannel=(e=t.copyFromChannel,(n,r,i=0)=>{const s=vs(i),o=vs(r);if(s<t.length)return e.call(t,n,o,s)}),t.copyToChannel=(n=t.copyToChannel,(e,r,i=0)=>{const s=vs(i),o=vs(r);if(s<t.length)return n.call(t,e,o,s)})});var vs;const ys=((t,e,n,r,i,o,a,u)=>{let c=null;return class l{constructor(l){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:d}=s(s({},Kn),l);null===c&&(c=new i(1,1,44100));const p=null!==r&&e(o,o)?new r({length:h,numberOfChannels:f,sampleRate:d}):c.createBuffer(f,h,d);if(0===p.numberOfChannels)throw n();return"function"!=typeof p.copyFromChannel?(a(p),Jn(p)):e(Zn,(()=>Zn(p)))||u(p),t.add(p),p}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===l.prototype||t.has(e)}}})(fs,Vi,fi,ds,$i,(bs=ds,()=>{if(null===bs)return!1;try{new bs({length:1,sampleRate:44100})}catch(t){return!1}return!0}),gs,_s);var bs;const xs=(ws=ui,(t,e)=>{const n=ws(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(n).connect(t.destination);const r=()=>{e.removeEventListener("ended",r),e.disconnect(n),n.disconnect()};e.addEventListener("ended",r)});var ws;const As=(Ts=Wi,Ss=sr,ks=xr,async(t,e,n,r)=>{const i=Ss(t);await Promise.all(Array.from(i.activeInputs).map((async([t,i])=>{const s=Ts(t),o=await s.render(t,e,r);ks(t)||o.connect(n,i)})))});var Ts,Ss,ks;const Cs=(Os=As,(t,e,n,r)=>Os(e,t,n,r));var Os;const Es=((t,e,n,r,i,s,o,a,u,c,l)=>(h,f)=>{const d=h.createBufferSource();return $r(d,f),Kr(d,f,"playbackRate"),Zr(d,f,"buffer"),Zr(d,f,"loop"),Zr(d,f,"loopEnd"),Zr(d,f,"loopStart"),e(n,(()=>n(h)))||(t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw zr();e.call(t,r,i,s),n=!0}})(t.start)})(d),e(r,(()=>r(h)))||u(d),e(i,(()=>i(h)))||c(d,h),e(s,(()=>s(h)))||ti(d),e(o,(()=>o(h)))||l(d,h),e(a,(()=>a(h)))||ei(d),t(h,d),d})(xs,Vi,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch(n){return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch(r){return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch(n){return!1}return!0}),wi,Ai,Ti,(t=>{var e;t.start=(e=t.start,(n=0,r=0,i)=>{const s=t.buffer,o=null===s?r:Math.min(s.duration,r);null!==s&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})}),(Ms=bi,(t,e)=>{const n=e.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),Ms(t,"buffer",(e=>()=>{const r=e.call(t);return r===n?null:r}),(e=>r=>e.call(t,null===r?n:r)))}),Si);var Ms;const Is=((t,e)=>(n,r,i,s)=>(t(r).replay(i),e(r,n,i,s)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(sr),As),Ds=((t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(u,c,l){const h=s.get(c);return void 0!==h?Promise.resolve(h):(async(u,c,l)=>{let h=n(u);const f=Qn(h,c);if(!f){const t={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(c,t),null!==o&&h.start(...o),null!==a&&h.stop(a)}return s.set(c,h),f?await t(c,u.playbackRate,h.playbackRate,l):await r(c,u.playbackRate,h.playbackRate,l),await i(u,c,h,l),h})(u,c,l)}}})(Cs,Es,yr,Is,zi),Rs=((t,e,n,r,i,s,o,a,u,c,l,h,f)=>(d,p,m,g=null,_=null)=>{const v=new Tn(m.defaultValue),y=p?r(v):null,b={get defaultValue(){return m.defaultValue},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,b.setValueAtTime(t,d.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===y&&v.flush(d.context.currentTime),v.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(v).pop();null===y&&v.flush(d.context.currentTime),v.add(i(t));const n=Array.from(v).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return b},cancelScheduledValues:t=>(null===y&&v.flush(d.context.currentTime),v.add(s(t)),m.cancelScheduledValues(t),b),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===y&&v.flush(d.context.currentTime),v.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),b},linearRampToValueAtTime:(t,e)=>(null===y&&v.flush(d.context.currentTime),v.add(a(t,e)),m.linearRampToValueAtTime(t,e),b),setTargetAtTime:(t,e,n)=>(null===y&&v.flush(d.context.currentTime),v.add(u(t,e,n)),m.setTargetAtTime(t,e,n),b),setValueAtTime:(t,e)=>(null===y&&v.flush(d.context.currentTime),v.add(c(t,e)),m.setValueAtTime(t,e),b),setValueCurveAtTime(t,e,n){const r=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,i=d.context.sampleRate,s=Math.ceil(e*i),o=Math.floor(t*i),a=o-s,u=new Float32Array(a);for(let l=0;l<a;l+=1){const t=(r.length-1)/n*((s+l)/i-e),o=Math.floor(t),a=Math.ceil(t);u[l]=o===a?r[o]:(1-(t-o))*r[o]+(1-(a-t))*r[a]}null===y&&v.flush(d.context.currentTime),v.add(l(u,e,n)),m.setValueCurveAtTime(u,e,n);const c=o/i;c<t&&f(b,u[u.length-1],c),f(b,r[r.length-1],t)}else null===y&&v.flush(d.context.currentTime),v.add(l(r,e,n)),m.setValueCurveAtTime(r,e,n);return b}};return n.set(b,m),e.set(b,d),t(b,y),b})((Ns=On,(t,e)=>{Ns.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),es,En,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:r}=n;e.exponentialRampToValueAtTime(r,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:r}=n;e.linearRampToValueAtTime(r,t)}else if("setTarget"===n.type){const{startTime:t,target:r,timeConstant:i}=n;e.setTargetAtTime(r,t,i)}else if("setValue"===n.type){const{startTime:t,value:r}=n;e.setValueAtTime(r,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:r,values:i}=n;e.setValueCurveAtTime(i,r,t)}}}})),(t=>({cancelTime:t,type:"cancelAndHold"})),(t=>({cancelTime:t,type:"cancelScheduledValues"})),((t,e)=>({endTime:e,type:"exponentialRampToValue",value:t})),((t,e)=>({endTime:e,type:"linearRampToValue",value:t})),((t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"})),an,un,is,xi);var Ns;const Vs=((t,e,n,r,i,o,a,u)=>class extends t{constructor(t,r){const u=o(t),c=s(s({},rr),r),l=i(u,c),h=a(u),f=h?e():null;super(t,!1,l,f),this._audioBufferSourceNodeRenderer=f,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=l,this._onended=null,this._playbackRate=n(this,h,l.playbackRate,er,tr)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?u(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){zn(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),nr(this)&&Gn(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(cs,Ds,Rs,zr,Es,Qi,Ki,ki),js=((t,e,n,r,i,s,o,a)=>class extends t{constructor(t,n){const r=s(t),u=o(r),c=i(r,n,u);super(t,!1,c,u?e(a):null),this._isNodeOfNativeOfflineAudioContext=u,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(cs,(t=>{let e=null;return{render:(n,r,i)=>(null===e&&(e=(async(e,n,r)=>{const i=n.destination;return await t(e,n,i,r),i})(n,r,i)),e)}}),$n,zr,((t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch(a){}i&&"explicit"!==s.channelCountMode&&(s.channelCountMode="explicit"),0===s.maxChannelCount&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{s.channelCount=e}catch(n){if(e>s.maxChannelCount)throw n}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),s.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),s.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o})(ui,bi),Qi,Ki,zi),Fs=((t,e,n,r,i)=>()=>{const s=new WeakMap;return{render(o,a,u){const c=s.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,u)=>{let c=n(o);const l=Qn(c,a);if(!l){const t={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(a,t)}return s.set(a,c),l?(await t(a,o.Q,c.Q,u),await t(a,o.detune,c.detune,u),await t(a,o.frequency,c.frequency,u),await t(a,o.gain,c.gain,u)):(await r(a,o.Q,c.Q,u),await r(a,o.detune,c.detune,u),await r(a,o.frequency,c.frequency,u),await r(a,o.gain,c.gain,u)),await i(o,a,c,u),c})(o,a,u)}}})(Cs,ii,yr,Is,zi),Ps=(t=>(e,n)=>t.set(e,n))(Di),qs=(Bs=cs,Ls=Rs,Ws=Fs,Us=Hr,zs=ii,Hs=Qi,Gs=Ki,Xs=Ps,class extends Bs{constructor(t,e){const n=Hs(t),r=s(s({},Vr),e),i=zs(n,r),o=Gs(n);super(t,!1,i,o?Ws():null),this._Q=Ls(this,o,i.Q,er,tr),this._detune=Ls(this,o,i.detune,1200*Math.log2(er),-1200*Math.log2(er)),this._frequency=Ls(this,o,i.frequency,t.sampleRate/2,0),this._gain=Ls(this,o,i.gain,40*Math.log10(er),tr),this._nativeBiquadFilterNode=i,Xs(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(r){if(11===r.code)throw Us();throw r}if(t.length!==e.length||e.length!==n.length)throw Us()}});var Bs,Ls,Ws,Us,zs,Hs,Gs,Xs;const Ys=((t,e)=>(n,r,i)=>{const s=new Set;var o,a;return n.connect=(o=n.connect,(i,a=0,u=0)=>{const c=0===s.size;if(e(i))return o.call(n,i,a,u),t(s,[i,a,u],(t=>t[0]===i&&t[1]===a&&t[2]===u),!0),c&&r(),i;o.call(n,i,a),t(s,[i,a],(t=>t[0]===i&&t[1]===a),!0),c&&r()}),n.disconnect=(a=n.disconnect,(t,r,o)=>{const u=s.size>0;if(void 0===t)a.apply(n),s.clear();else if("number"==typeof t){a.call(n,t);for(const e of s)e[1]===t&&s.delete(e)}else{e(t)?a.call(n,t,r,o):a.call(n,t,r);for(const e of s)e[0]!==t||void 0!==r&&e[1]!==r||void 0!==o&&e[2]!==o||s.delete(e)}const c=0===s.size;u&&c&&i()}),n})(lr,as);var Qs,Zs;const $s=((t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),$r(i,r),i})(is,(Qs=zr,Zs=Ys,(t,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw Qs()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw Qs()}});const n=t.createBufferSource();Zs(e,(()=>{const t=e.numberOfInputs;for(let r=0;r<t;r+=1)n.connect(e,0,r)}),(()=>n.disconnect(e)))})),Js=((t,e,n,r,i)=>class extends t{constructor(t,o){const a=r(t),u=s(s({},jr),o);super(t,!1,n(a,u),i(a)?e():null)}})(cs,((t,e,n)=>()=>{const r=new WeakMap;return{render(i,s,o){const a=r.get(s);return void 0!==a?Promise.resolve(a):(async(i,s,o)=>{let a=e(i);if(!Qn(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(s,e)}return r.set(s,a),await n(i,s,a,o),a})(i,s,o)}}})($s,yr,zi),$s,Qi,Ki),Ks=((t,e,n,r,i,o)=>class extends t{constructor(t,a){const u=r(t),c=o(s(s({},Fr),a));super(t,!1,n(u,c),i(u)?e():null)}})(cs,((t,e,n)=>()=>{const r=new WeakMap;return{render(i,s,o){const a=r.get(s);return void 0!==a?Promise.resolve(a):(async(i,s,o)=>{let a=e(i);if(!Qn(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(s,e)}return r.set(s,a),await n(i,s,a,o),a})(i,s,o)}}})(si,yr,zi),si,Qi,Ki,(t=>s(s({},t),{channelCount:t.numberOfOutputs}))),to=((t,e,n,r,i)=>(s,o)=>{if(void 0===s.createConstantSource)return n(s,o);const a=s.createConstantSource();return $r(a,o),Kr(a,o,"offset"),e(r,(()=>r(s)))||ti(a),e(i,(()=>i(s)))||ei(a),t(s,a),a})(xs,Vi,((t,e,n,r)=>(i,a)=>{var{offset:u}=a,c=o(a,["offset"]);const l=i.createBuffer(1,2,44100),h=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),f=n(i,s(s({},c),{gain:u})),d=l.getChannelData(0);d[0]=1,d[1]=1,h.buffer=l,h.loop=!0;const p={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(t){f.channelCount=t},get channelCountMode(){return f.channelCountMode},set channelCountMode(t){f.channelCountMode=t},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(t){f.channelInterpretation=t},get context(){return f.context},get inputs(){return[]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get offset(){return f.gain},get onended(){return h.onended},set onended(t){h.onended=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2]),start(t=0){h.start.call(h,t)},stop(t=0){h.stop.call(h,t)}};return t(i,h),r(oi(p,f),(()=>h.connect(f)),(()=>h.disconnect(f)))})(xs,Es,ui,Ys),wi,Ti),eo=((t,e,n,r,i,o,a)=>class extends t{constructor(t,a){const u=i(t),c=s(s({},Pr),a),l=r(u,c),h=o(u),f=h?n():null;super(t,!1,l,f),this._constantSourceNodeRenderer=f,this._nativeConstantSourceNode=l,this._offset=e(this,h,l.offset,er,tr),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){zn(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),nr(this)&&Gn(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(cs,Rs,((t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(u,c,l){const h=s.get(c);return void 0!==h?Promise.resolve(h):(async(u,c,l)=>{let h=n(u);const f=Qn(h,c);if(!f){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(c,t),null!==o&&h.start(o),null!==a&&h.stop(a)}return s.set(c,h),f?await t(c,u.offset,h.offset,l):await r(c,u.offset,h.offset,l),await i(u,c,h,l),h})(u,c,l)}}})(Cs,to,yr,Is,zi),to,Qi,Ki,ki),no=((t,e)=>(n,r)=>{const i=n.createConvolver();if($r(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Zr(i,r,"buffer"),r.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===r.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i})(fi,bi),ro=((t,e,n,r,i,o)=>class extends t{constructor(t,a){const u=r(t),c=s(s({},qr),a),l=n(u,c);super(t,!1,l,i(u)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=l,null!==c.buffer&&o(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,o(this,0)}else this._isBufferNullified=!1,o(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(cs,((t,e,n)=>()=>{const r=new WeakMap;return{render(i,s,o){const a=r.get(s);return void 0!==a?Promise.resolve(a):(async(i,s,o)=>{let a=e(i);if(!Qn(a,s)){const e={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(s,e)}return r.set(s,a),dr(a)?await n(i,s,a.inputs[0],o):await n(i,s,a,o),a})(i,s,o)}}})(no,yr,zi),no,Qi,Ki,Ps),io=((t,e,n,r,i,o,a)=>class extends t{constructor(t,u){const c=i(t),l=s(s({},Br),u),h=r(c,l),f=o(c);super(t,!1,h,f?n(l.maxDelayTime):null),this._delayTime=e(this,f,h.delayTime),a(this,l.maxDelayTime)}get delayTime(){return this._delayTime}})(cs,Rs,((t,e,n,r,i)=>s=>{const o=new WeakMap;return{render(a,u,c){const l=o.get(u);return void 0!==l?Promise.resolve(l):(async(a,u,c)=>{let l=n(a);const h=Qn(l,u);if(!h){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:s};l=e(u,t)}return o.set(u,l),h?await t(u,a.delayTime,l.delayTime,c):await r(u,a.delayTime,l.delayTime,c),await i(a,u,l,c),l})(a,u,c)}}})(Cs,ai,yr,Is,zi),ai,Qi,Ki,Ps),so=(oo=fi,(t,e)=>{const n=t.createDynamicsCompressor();if($r(n,e),e.channelCount>2)throw oo();if("max"===e.channelCountMode)throw oo();return Kr(n,e,"attack"),Kr(n,e,"knee"),Kr(n,e,"ratio"),Kr(n,e,"release"),Kr(n,e,"threshold"),n});var oo;const ao=((t,e,n,r,i,o,a,u)=>class extends t{constructor(t,i){const c=o(t),l=s(s({},Wr),i),h=r(c,l),f=a(c);super(t,!1,h,f?n():null),this._attack=e(this,f,h.attack),this._knee=e(this,f,h.knee),this._nativeDynamicsCompressorNode=h,this._ratio=e(this,f,h.ratio),this._release=e(this,f,h.release),this._threshold=e(this,f,h.threshold),u(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(cs,Rs,((t,e,n,r,i)=>()=>{const s=new WeakMap;return{render(o,a,u){const c=s.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,u)=>{let c=n(o);const l=Qn(c,a);if(!l){const t={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(a,t)}return s.set(a,c),l?(await t(a,o.attack,c.attack,u),await t(a,o.knee,c.knee,u),await t(a,o.ratio,c.ratio,u),await t(a,o.release,c.release,u),await t(a,o.threshold,c.threshold,u)):(await r(a,o.attack,c.attack,u),await r(a,o.knee,c.knee,u),await r(a,o.ratio,c.ratio,u),await r(a,o.release,c.release,u),await r(a,o.threshold,c.threshold,u)),await i(o,a,c,u),c})(o,a,u)}}})(Cs,so,yr,Is,zi),so,fi,Qi,Ki,Ps),uo=((t,e,n,r,i,o)=>class extends t{constructor(t,a){const u=i(t),c=s(s({},Ur),a),l=r(u,c),h=o(u);super(t,!1,l,h?n():null),this._gain=e(this,h,l.gain,er,tr)}get gain(){return this._gain}})(cs,Rs,((t,e,n,r,i)=>()=>{const s=new WeakMap;return{render(o,a,u){const c=s.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,u)=>{let c=n(o);const l=Qn(c,a);if(!l){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(a,t)}return s.set(a,c),l?await t(a,o.gain,c.gain,u):await r(a,o.gain,c.gain,u),await i(o,a,c,u),c})(o,a,u)}}})(Cs,ui,yr,Is,zi),ui,Qi,Ki),co=((t,e,n,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:u,feedback:c,feedforward:l})=>{const h=ni(s,i.sampleRate),f=c instanceof Float64Array?c:new Float64Array(c),d=l instanceof Float64Array?l:new Float64Array(l),p=f.length,m=d.length,g=Math.min(p,m);if(0===p||p>20)throw r();if(0===f[0])throw e();if(0===m||m>20)throw r();if(0===d[0])throw e();if(1!==f[0]){for(let t=0;t<m;t+=1)d[t]/=f[0];for(let t=1;t<p;t+=1)f[t]/=f[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=u;const v=[],y=[],b=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),b.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,r=e.numberOfChannels;for(let i=0;i<r;i+=1){const t=e.getChannelData(i),r=n.getChannelData(i);v[i]=Xr(f,p,d,m,g,y[i],b[i],v[i],32,t,r)}};const x=i.sampleRate/2;return oi({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,r){if(e.length!==n.length||n.length!==r.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/x),s=[Math.cos(i),Math.sin(i)],o=ci(li(d,s),li(f,s));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),r[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(Hr,zr,hi,fi),lo=((t,e,n,r)=>i=>t(Qr,(()=>Qr(i)))?Promise.resolve(t(r,r)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(Vi,ui,hi,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{r.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(ui,$i)),ho=((t,e,n,r,i)=>(s,o)=>{const a=new WeakMap;let u=null;const c=async(c,l,h)=>{let f=null,d=e(c);const p=Qn(d,l);if(void 0===l.createIIRFilter?f=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=l.createIIRFilter(o,s)),a.set(l,null===f?d:f),null!==f){if(null===u){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(c.context.destination.channelCount,c.context.length,l.sampleRate);u=(async()=>{await r(c,t,t.destination,h);return((t,e,n,r)=>{const i=n instanceof Float64Array?n:new Float64Array(n),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,u=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)s[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const c=new Float32Array(32),l=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),f=t.numberOfChannels;for(let d=0;d<f;d+=1){const e=t.getChannelData(d),n=h.getChannelData(d);c.fill(0),l.fill(0),Xr(i,o,s,a,u,c,l,0,32,e,n)}return h})(await i(t),l,s,o)})()}const t=await u;return f.buffer=t,f.start(0),f}return await r(c,l,d,h),d};return{render(t,e,n){const r=a.get(e);return void 0!==r?Promise.resolve(r):c(t,e,n)}}})(Es,yr,$i,zi,lo);var fo;const po=((t,e,n,r,i,o)=>class extends t{constructor(t,a){const u=r(t),c=i(u),l=s(s({},Gr),a),h=e(u,c?null:t.baseLatency,l);super(t,!1,h,c?n(l.feedback,l.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,r,i)=>{if(n.length!==r.length||r.length!==i.length)throw Hr();return e.call(t,n,r,i)})})(h),this._nativeIIRFilterNode=h,o(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(cs,(fo=co,(t,e,n)=>{if(void 0===t.createIIRFilter)return fo(t,e,n);const r=t.createIIRFilter(n.feedforward,n.feedback);return $r(r,n),r}),ho,Qi,Ki,Ps),mo=((t,e,n,r,i)=>(s,o)=>{const a=o.listener,{forwardX:u,forwardY:c,forwardZ:l,positionX:h,positionY:f,positionZ:d,upX:p,upY:m,upZ:g}=void 0===a.forwardX?(()=>{const u=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),c=i(o),l=r(o,256,9,0),h=(e,r)=>{const i=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:r});return i.connect(u,0,e),i.start(),Object.defineProperty(i.offset,"defaultValue",{get:()=>r}),t({context:s},c,i.offset,er,tr)};let f=[0,0,-1,0,1,0],d=[0,0,0];return l.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some(((t,e)=>t!==f[e]))&&(a.setOrientation(...e),f=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some(((t,e)=>t!==d[e]))&&(a.setPosition(...n),d=n)},u.connect(l),{forwardX:h(0,0),forwardY:h(1,0),forwardZ:h(2,-1),positionX:h(6,0),positionY:h(7,0),positionZ:h(8,0),upX:h(3,0),upY:h(4,1),upZ:h(5,0)}})():a;return{get forwardX(){return u},get forwardY(){return c},get forwardZ(){return l},get positionX(){return h},get positionY(){return f},get positionZ(){return d},get upX(){return p},get upY(){return m},get upZ(){return g}}})(Rs,$s,to,hi,Ki),go=new WeakMap,_o=((t,e,n,r,i,s)=>class extends n{constructor(n,s){super(n),this._nativeContext=n,Mn.set(this,n),r(n)&&i.set(n,new Set),this._destination=new t(this,s),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?s(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(js,mo,ns,Ki,go,ki),vo=((t,e,n,r,i,s)=>(o,a)=>{const u=o.createOscillator();return $r(u,a),Kr(u,a,"detune"),Kr(u,a,"frequency"),void 0!==a.periodicWave?u.setPeriodicWave(a.periodicWave):Zr(u,a,"type"),e(n,(()=>n(o)))||ti(u),e(r,(()=>r(o)))||s(u,o),e(i,(()=>i(o)))||ei(u),t(o,u),u})(xs,Vi,wi,Ai,Ti,Si),yo=((t,e,n,r,i,o,a)=>class extends t{constructor(t,a){const u=i(t),c=s(s({},pi),a),l=n(u,c),h=o(u),f=h?r():null,d=t.sampleRate/2;super(t,!1,l,f),this._detune=e(this,h,l.detune,153600,-153600),this._frequency=e(this,h,l.frequency,d,-d),this._nativeOscillatorNode=l,this._onended=null,this._oscillatorNodeRenderer=f,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){zn(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),nr(this)&&Gn(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(cs,Rs,vo,((t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,u=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){u=t},render(c,l,h){const f=s.get(l);return void 0!==f?Promise.resolve(f):(async(c,l,h)=>{let f=n(c);const d=Qn(f,l);if(!d){const t={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:null===o?void 0:o,type:f.type};f=e(l,t),null!==a&&f.start(a),null!==u&&f.stop(u)}return s.set(l,f),d?(await t(l,c.detune,f.detune,h),await t(l,c.frequency,f.frequency,h)):(await r(l,c.detune,f.detune,h),await r(l,c.frequency,f.frequency,h)),await i(c,l,f,h),f})(c,l,h)}}})(Cs,vo,yr,Is,zi),Qi,Ki,ki),bo=(xo=Es,(t,e)=>{const n=xo(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=t.createBuffer(1,2,44100);return n.buffer=r,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}});var xo;const wo=((t,e,n,r,i)=>(a,u)=>{var{curve:c,oversample:l}=u,h=o(u,["curve","oversample"]);const f=a.createWaveShaper(),d=a.createWaveShaper();$r(f,h),$r(d,h);const p=n(a,s(s({},h),{gain:1})),m=n(a,s(s({},h),{gain:-1})),g=n(a,s(s({},h),{gain:1})),_=n(a,s(s({},h),{gain:-1}));let v=null,y=!1,b=null;const x={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(t){p.channelCount=t,m.channelCount=t,f.channelCount=t,g.channelCount=t,d.channelCount=t,_.channelCount=t},get channelCountMode(){return f.channelCountMode},set channelCountMode(t){p.channelCountMode=t,m.channelCountMode=t,f.channelCountMode=t,g.channelCountMode=t,d.channelCountMode=t,_.channelCountMode=t},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(t){p.channelInterpretation=t,m.channelInterpretation=t,f.channelInterpretation=t,g.channelInterpretation=t,d.channelInterpretation=t,_.channelInterpretation=t},get context(){return f.context},get curve(){return b},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)f.curve=n,d.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),r=new Float32Array(t+2-t%2);e[0]=n[0],r[0]=-n[t-1];const i=Math.ceil((t+1)/2),s=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*s,u=Math.floor(a),c=Math.ceil(a);e[o]=u===c?n[u]:(1-(a-u))*n[u]+(1-(c-a))*n[c],r[o]=u===c?-n[t-1-u]:-(1-(a-u))*n[t-1-u]-(1-(c-a))*n[t-1-c]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,f.curve=e,d.curve=r}b=n,y&&(r(b)&&null===v?v=t(a,p):null!==v&&(v(),v=null))},get inputs(){return[p]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get oversample(){return f.oversample},set oversample(t){f.oversample=t,d.oversample=t},addEventListener:(...t)=>p.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>p.dispatchEvent(t[0]),removeEventListener:(...t)=>p.removeEventListener(t[0],t[1],t[2])};null!==c&&(x.curve=c instanceof Float32Array?c:new Float32Array(c)),l!==x.oversample&&(x.oversample=l);return i(oi(x,g),(()=>{p.connect(f).connect(g),p.connect(m).connect(d).connect(_).connect(g),y=!0,r(b)&&(v=t(a,p))}),(()=>{p.disconnect(f),f.disconnect(g),p.disconnect(m),m.disconnect(d),d.disconnect(_),_.disconnect(g),y=!1,null!==v&&(v(),v=null)}))})(bo,zr,ui,yi,Ys),Ao=((t,e,n,r,i,s,o)=>(a,u)=>{const c=a.createWaveShaper();if(null!==s&&"webkitAudioContext"===s.name&&void 0===a.createGain().gain.automationRate)return n(a,u);$r(c,u);const l=null===u.curve||u.curve instanceof Float32Array?u.curve:new Float32Array(u.curve);if(null!==l&&l.length<2)throw e();Zr(c,{curve:l},"curve"),Zr(c,u,"oversample");let h=null,f=!1;o(c,"curve",(t=>()=>t.call(c)),(e=>n=>(e.call(c,n),f&&(r(n)&&null===h?h=t(a,c):r(n)||null===h||(h(),h=null)),n)));return i(c,(()=>{f=!0,r(c.curve)&&(h=t(a,c))}),(()=>{f=!1,null!==h&&(h(),h=null)}))})(bo,zr,wo,yi,Ys,is,bi),To=((t,e,n,r,i,a,u,c,l)=>(h,f)=>{var{coneInnerAngle:d,coneOuterAngle:p,coneOuterGain:m,distanceModel:g,maxDistance:_,orientationX:v,orientationY:y,orientationZ:b,panningModel:x,positionX:w,positionY:A,positionZ:T,refDistance:S,rolloffFactor:k}=f,C=o(f,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]);const O=h.createPanner();if(C.channelCount>2)throw u();if("max"===C.channelCountMode)throw u();$r(O,C);const E={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},M=n(h,s(s({},E),{channelInterpretation:"speakers",numberOfInputs:6})),I=r(h,s(s({},C),{gain:1})),D=r(h,s(s({},E),{gain:1})),R=r(h,s(s({},E),{gain:0})),N=r(h,s(s({},E),{gain:0})),V=r(h,s(s({},E),{gain:0})),j=r(h,s(s({},E),{gain:0})),F=r(h,s(s({},E),{gain:0})),P=i(h,256,6,1),q=a(h,s(s({},E),{curve:new Float32Array([1,1]),oversample:"none"}));let B=[v,y,b],L=[w,A,T];P.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some(((t,e)=>t!==B[e]))&&(O.setOrientation(...e),B=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some(((t,e)=>t!==L[e]))&&(O.setPosition(...n),L=n)},Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(j.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const W={get bufferSize(){},get channelCount(){return O.channelCount},set channelCount(t){if(t>2)throw u();I.channelCount=t,O.channelCount=t},get channelCountMode(){return O.channelCountMode},set channelCountMode(t){if("max"===t)throw u();I.channelCountMode=t,O.channelCountMode=t},get channelInterpretation(){return O.channelInterpretation},set channelInterpretation(t){I.channelInterpretation=t,O.channelInterpretation=t},get coneInnerAngle(){return O.coneInnerAngle},set coneInnerAngle(t){O.coneInnerAngle=t},get coneOuterAngle(){return O.coneOuterAngle},set coneOuterAngle(t){O.coneOuterAngle=t},get coneOuterGain(){return O.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();O.coneOuterGain=t},get context(){return O.context},get distanceModel(){return O.distanceModel},set distanceModel(t){O.distanceModel=t},get inputs(){return[I]},get maxDistance(){return O.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;O.maxDistance=t},get numberOfInputs(){return O.numberOfInputs},get numberOfOutputs(){return O.numberOfOutputs},get orientationX(){return D.gain},get orientationY(){return R.gain},get orientationZ(){return N.gain},get panningModel(){return O.panningModel},set panningModel(t){O.panningModel=t},get positionX(){return V.gain},get positionY(){return j.gain},get positionZ(){return F.gain},get refDistance(){return O.refDistance},set refDistance(t){if(t<0)throw new RangeError;O.refDistance=t},get rolloffFactor(){return O.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;O.rolloffFactor=t},addEventListener:(...t)=>I.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>I.dispatchEvent(t[0]),removeEventListener:(...t)=>I.removeEventListener(t[0],t[1],t[2])};d!==W.coneInnerAngle&&(W.coneInnerAngle=d),p!==W.coneOuterAngle&&(W.coneOuterAngle=p),m!==W.coneOuterGain&&(W.coneOuterGain=m),g!==W.distanceModel&&(W.distanceModel=g),_!==W.maxDistance&&(W.maxDistance=_),v!==W.orientationX.value&&(W.orientationX.value=v),y!==W.orientationY.value&&(W.orientationY.value=y),b!==W.orientationZ.value&&(W.orientationZ.value=b),x!==W.panningModel&&(W.panningModel=x),w!==W.positionX.value&&(W.positionX.value=w),A!==W.positionY.value&&(W.positionY.value=A),T!==W.positionZ.value&&(W.positionZ.value=T),S!==W.refDistance&&(W.refDistance=S),k!==W.rolloffFactor&&(W.rolloffFactor=k),1===B[0]&&0===B[1]&&0===B[2]||O.setOrientation(...B),0===L[0]&&0===L[1]&&0===L[2]||O.setPosition(...L);return l(oi(W,O),(()=>{I.connect(O),t(I,q,0,0),q.connect(D).connect(M,0,0),q.connect(R).connect(M,0,1),q.connect(N).connect(M,0,2),q.connect(V).connect(M,0,3),q.connect(j).connect(M,0,4),q.connect(F).connect(M,0,5),M.connect(P).connect(h.destination)}),(()=>{I.disconnect(O),c(I,q,0,0),q.disconnect(D),D.disconnect(M),q.disconnect(R),R.disconnect(M),q.disconnect(N),N.disconnect(M),q.disconnect(V),V.disconnect(M),q.disconnect(j),j.disconnect(M),q.disconnect(F),F.disconnect(M),M.disconnect(P),P.disconnect(h.destination)}))})(pr,zr,$s,ui,hi,Ao,fi,vr,Ys),So=(ko=To,(t,e)=>{const n=t.createPanner();return void 0===n.orientationX?ko(t,e):($r(n,e),Kr(n,e,"orientationX"),Kr(n,e,"orientationY"),Kr(n,e,"orientationZ"),Kr(n,e,"positionX"),Kr(n,e,"positionY"),Kr(n,e,"positionZ"),Zr(n,e,"coneInnerAngle"),Zr(n,e,"coneOuterAngle"),Zr(n,e,"coneOuterGain"),Zr(n,e,"distanceModel"),Zr(n,e,"maxDistance"),Zr(n,e,"panningModel"),Zr(n,e,"refDistance"),Zr(n,e,"rolloffFactor"),n)});var ko;const Co=((t,e,n,r,i,o,a)=>class extends t{constructor(t,u){const c=i(t),l=s(s({},mi),u),h=n(c,l),f=o(c);super(t,!1,h,f?r():null),this._nativePannerNode=h,this._orientationX=e(this,f,h.orientationX,er,tr),this._orientationY=e(this,f,h.orientationY,er,tr),this._orientationZ=e(this,f,h.orientationZ,er,tr),this._positionX=e(this,f,h.positionX,er,tr),this._positionY=e(this,f,h.positionY,er,tr),this._positionZ=e(this,f,h.positionZ,er,tr),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(cs,Rs,So,((t,e,n,r,i,o,a,u,c,l)=>()=>{const h=new WeakMap;let f=null;return{render(d,p,m){const g=h.get(p);return void 0!==g?Promise.resolve(g):(async(d,p,m)=>{let g=null,_=o(d);const v={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},y=s(s({},v),{coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor}),b=Qn(_,p);if("bufferSize"in _)g=r(p,s(s({},v),{gain:1}));else if(!b){const t=s(s({},y),{orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value});_=i(p,t)}if(h.set(p,null===g?_:g),null!==g){if(null===f){if(null===a)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new a(6,d.context.length,p.sampleRate),r=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});r.connect(t.destination),f=(async()=>{const e=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map((async(e,r)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===r?1:0});return await u(t,e,i.offset,m),i})));for(let t=0;t<6;t+=1)e[t].connect(r,0,t),e[t].start(0);return l(t)})()}const t=await f,o=r(p,s(s({},v),{gain:1}));await c(d,p,o,m);const h=[];for(let e=0;e<t.numberOfChannels;e+=1)h.push(t.getChannelData(e));let _=[h[0][0],h[1][0],h[2][0]],b=[h[3][0],h[4][0],h[5][0]],x=r(p,s(s({},v),{gain:1})),w=i(p,s(s({},y),{orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:b[0],positionY:b[1],positionZ:b[2]}));o.connect(x).connect(w.inputs[0]),w.connect(g);for(let e=128;e<t.length;e+=128){const t=[h[0][e],h[1][e],h[2][e]],n=[h[3][e],h[4][e],h[5][e]];if(t.some(((t,e)=>t!==_[e]))||n.some(((t,e)=>t!==b[e]))){_=t,b=n;const a=e/p.sampleRate;x.gain.setValueAtTime(0,a),x=r(p,s(s({},v),{gain:0})),w=i(p,s(s({},y),{orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:b[0],positionY:b[1],positionZ:b[2]})),x.gain.setValueAtTime(1,a),o.connect(x).connect(w.inputs[0]),w.connect(g)}}return g}return b?(await t(p,d.orientationX,_.orientationX,m),await t(p,d.orientationY,_.orientationY,m),await t(p,d.orientationZ,_.orientationZ,m),await t(p,d.positionX,_.positionX,m),await t(p,d.positionY,_.positionY,m),await t(p,d.positionZ,_.positionZ,m)):(await u(p,d.orientationX,_.orientationX,m),await u(p,d.orientationY,_.orientationY,m),await u(p,d.orientationZ,_.orientationZ,m),await u(p,d.positionX,_.positionX,m),await u(p,d.positionY,_.positionY,m),await u(p,d.positionZ,_.positionZ,m)),dr(_)?await c(d,p,_.inputs[0],m):await c(d,p,_,m),_})(d,p,m)}}})(Cs,$s,to,ui,So,yr,$i,Is,zi,lo),Qi,Ki,Ps),Oo=((t,e,n,r)=>class i{constructor(i,o){const a=e(i),u=r(s(s({},gi),o)),c=t(a,u);return n.add(c),c}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}})((t=>(e,{disableNormalization:n,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:n});if(Array.from(r).length<2)throw t();return a})($n),Qi,new WeakSet,(t=>{const{imag:e,real:n}=t;return s(s({},t),void 0===e?void 0===n?{imag:[0,0],real:[0,0]}:{imag:Array.from(n,(()=>0)),real:n}:void 0===n?{imag:e,real:Array.from(e,(()=>0))}:{imag:e,real:n})})),Eo=((t,e)=>(n,r)=>{const i=r.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,r);const s=n.createStereoPanner();return $r(s,r),Kr(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),s})(((t,e,n,r,i,a)=>{const u=16385,c=new Float32Array([1,1]),l=Math.PI/2,h={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},f=s(s({},h),{oversample:"none"}),d=(t,o,a,d,p)=>{if(1===o)return((t,e,i,o)=>{const a=new Float32Array(u),d=new Float32Array(u);for(let n=0;n<u;n+=1){const t=n/16384*l;a[n]=Math.cos(t),d[n]=Math.sin(t)}const p=n(t,s(s({},h),{gain:0})),m=r(t,s(s({},f),{curve:a})),g=r(t,s(s({},f),{curve:c})),_=n(t,s(s({},h),{gain:0})),v=r(t,s(s({},f),{curve:d}));return{connectGraph(){e.connect(p),e.connect(void 0===g.inputs?g:g.inputs[0]),e.connect(_),g.connect(i),i.connect(void 0===m.inputs?m:m.inputs[0]),i.connect(void 0===v.inputs?v:v.inputs[0]),m.connect(p.gain),v.connect(_.gain),p.connect(o,0,0),_.connect(o,0,1)},disconnectGraph(){e.disconnect(p),e.disconnect(void 0===g.inputs?g:g.inputs[0]),e.disconnect(_),g.disconnect(i),i.disconnect(void 0===m.inputs?m:m.inputs[0]),i.disconnect(void 0===v.inputs?v:v.inputs[0]),m.disconnect(p.gain),v.disconnect(_.gain),p.disconnect(o,0,0),_.disconnect(o,0,1)}}})(t,a,d,p);if(2===o)return((t,i,o,a)=>{const d=new Float32Array(u),p=new Float32Array(u),m=new Float32Array(u),g=new Float32Array(u),_=Math.floor(8192.5);for(let e=0;e<u;e+=1)if(e>_){const t=(e-_)/(16384-_)*l;d[e]=Math.cos(t),p[e]=Math.sin(t),m[e]=0,g[e]=1}else{const t=e/(16384-_)*l;d[e]=1,p[e]=0,m[e]=Math.cos(t),g[e]=Math.sin(t)}const v=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),y=n(t,s(s({},h),{gain:0})),b=r(t,s(s({},f),{curve:d})),x=n(t,s(s({},h),{gain:0})),w=r(t,s(s({},f),{curve:p})),A=r(t,s(s({},f),{curve:c})),T=n(t,s(s({},h),{gain:0})),S=r(t,s(s({},f),{curve:m})),k=n(t,s(s({},h),{gain:0})),C=r(t,s(s({},f),{curve:g}));return{connectGraph(){i.connect(v),i.connect(void 0===A.inputs?A:A.inputs[0]),v.connect(y,0),v.connect(x,0),v.connect(T,1),v.connect(k,1),A.connect(o),o.connect(void 0===b.inputs?b:b.inputs[0]),o.connect(void 0===w.inputs?w:w.inputs[0]),o.connect(void 0===S.inputs?S:S.inputs[0]),o.connect(void 0===C.inputs?C:C.inputs[0]),b.connect(y.gain),w.connect(x.gain),S.connect(T.gain),C.connect(k.gain),y.connect(a,0,0),T.connect(a,0,0),x.connect(a,0,1),k.connect(a,0,1)},disconnectGraph(){i.disconnect(v),i.disconnect(void 0===A.inputs?A:A.inputs[0]),v.disconnect(y,0),v.disconnect(x,0),v.disconnect(T,1),v.disconnect(k,1),A.disconnect(o),o.disconnect(void 0===b.inputs?b:b.inputs[0]),o.disconnect(void 0===w.inputs?w:w.inputs[0]),o.disconnect(void 0===S.inputs?S:S.inputs[0]),o.disconnect(void 0===C.inputs?C:C.inputs[0]),b.disconnect(y.gain),w.disconnect(x.gain),S.disconnect(T.gain),C.disconnect(k.gain),y.disconnect(a,0,0),T.disconnect(a,0,0),x.disconnect(a,0,1),k.disconnect(a,0,1)}}})(t,a,d,p);throw i()};return(e,r)=>{var{channelCount:u,channelCountMode:c,pan:l}=r,h=o(r,["channelCount","channelCountMode","pan"]);if("max"===c)throw i();const f=t(e,s(s({},h),{channelCount:1,channelCountMode:c,numberOfInputs:2})),p=n(e,s(s({},h),{channelCount:u,channelCountMode:c,gain:1})),m=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:l});let{connectGraph:g,disconnectGraph:_}=d(e,u,p,m,f);Object.defineProperty(m.gain,"defaultValue",{get:()=>0}),Object.defineProperty(m.gain,"maxValue",{get:()=>1}),Object.defineProperty(m.gain,"minValue",{get:()=>-1});const v={get bufferSize(){},get channelCount(){return p.channelCount},set channelCount(t){p.channelCount!==t&&(y&&_(),({connectGraph:g,disconnectGraph:_}=d(e,t,p,m,f)),y&&g()),p.channelCount=t},get channelCountMode(){return p.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();p.channelCountMode=t},get channelInterpretation(){return p.channelInterpretation},set channelInterpretation(t){p.channelInterpretation=t},get context(){return p.context},get inputs(){return[p]},get numberOfInputs(){return p.numberOfInputs},get numberOfOutputs(){return p.numberOfOutputs},get pan(){return m.gain},addEventListener:(...t)=>p.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>p.dispatchEvent(t[0]),removeEventListener:(...t)=>p.removeEventListener(t[0],t[1],t[2])};let y=!1;return a(oi(v,f),(()=>{g(),y=!0}),(()=>{_(),y=!1}))}})($s,si,ui,Ao,fi,Ys),fi),Mo=((t,e,n,r,i,o)=>class extends t{constructor(t,a){const u=i(t),c=s(s({},_i),a),l=n(u,c),h=o(u);super(t,!1,l,h?r():null),this._pan=e(this,h,l.pan)}get pan(){return this._pan}})(cs,Rs,Eo,((t,e,n,r,i)=>()=>{const s=new WeakMap;return{render(o,a,u){const c=s.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,u)=>{let c=n(o);const l=Qn(c,a);if(!l){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(a,t)}return s.set(a,c),l?await t(a,o.pan,c.pan,u):await r(a,o.pan,c.pan,u),dr(c)?await i(o,a,c.inputs[0],u):await i(o,a,c,u),c})(o,a,u)}}})(Cs,Eo,yr,Is,zi),Qi,Ki),Io=((t,e,n)=>()=>{const r=new WeakMap;return{render(i,s,o){const a=r.get(s);return void 0!==a?Promise.resolve(a):(async(i,s,o)=>{let a=e(i);if(!Qn(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(s,e)}return r.set(s,a),dr(a)?await n(i,s,a.inputs[0],o):await n(i,s,a,o),a})(i,s,o)}}})(Ao,yr,zi),Do=((t,e,n,r,i,o,a)=>class extends t{constructor(t,e){const u=i(t),c=s(s({},vi),e),l=n(u,c);super(t,!0,l,o(u)?r():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=l,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(cs,zr,Ao,Io,Qi,Ki,Ps),Ro=(t=>null!==t&&t.isSecureContext)(Pi),No=(t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return r()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(Pi),Vo=new WeakMap,jo=((t,e)=>n=>{let r=t.get(n);if(void 0!==r)return r;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,8e3),t.set(n,r),r})(Vo,$i),Fo=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(Pi),Po=Ro?((t,e,n,r,i,s,o,a,u,c,l,h)=>(f,d,p={credentials:"omit"})=>{const m=s(f);if(void 0!==m.audioWorklet)return Promise.all([i(d),Promise.resolve(t(l,l))]).then((([[t,e],n])=>{const[r,i]=Fn(t,e),s=n?i:i.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),u=new Blob([`${r};(registerProcessor=>{${s}\n})((n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),c=URL.createObjectURL(u);return m.audioWorklet.addModule(c,p).then((()=>{if(a(m))return;return o(m).audioWorklet.addModule(c,p)})).finally((()=>URL.revokeObjectURL(c)))}));const g=c.get(f);if(void 0!==g&&g.has(d))return Promise.resolve();const _=u.get(f);if(void 0!==_){const t=_.get(d);if(void 0!==t)return t}const v=i(d).then((([t,e])=>{const[r,i]=Fn(t,e);return n(`${r};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=h._AWGS.pop();if(void 0===t)throw new SyntaxError;r(m.currentTime,m.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const r=Rn.get(m);if(void 0!==r){if(r.has(t))throw e();qn(n),Pn(n.parameterDescriptors),r.set(t,n)}else qn(n),Pn(n.parameterDescriptors),Rn.set(m,new Map([[t,n]]))}),m.sampleRate,void 0,void 0)))}));return void 0===_?u.set(f,new Map([[d,v]])):_.set(d,v),v.then((()=>{const t=c.get(f);void 0===t?c.set(f,new Set([d])):t.add(d)})).finally((()=>{const t=u.get(f);void 0!==t&&t.delete(d)})),v})(Vi,fi,(t=>e=>new Promise(((n,r)=>{if(null===t)return void r(new SyntaxError);const i=t.document.head;if(null===i)r(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),u=t.onerror,c=()=>{t.onerror=u,URL.revokeObjectURL(a)};t.onerror=(e,n,i,s,o)=>n===a||n===t.location.href&&1===i&&1===s?(c(),r(o),!1):null!==u?u(e,n,i,s,o):void 0,s.onerror=()=>{c(),r(new SyntaxError)},s.onload=()=>{c(),n()},s.src=a,s.type="module",i.appendChild(s)}})))(Pi),No,(qo=()=>new DOMException("","AbortError"),async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch(e){}throw qo()}),Qi,jo,Ki,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,8e3),i=URL.createObjectURL(n);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const e=new t(r,"a",{numberOfOutputs:0}),n=r.createOscillator();e.port.onmessage=()=>s=!0,e.onprocessorerror=()=>o=!0,n.connect(e),await r.startRendering()}catch(a){}finally{URL.revokeObjectURL(i)}return s&&!o})(Fo,$i),Pi):void 0;var qo;const Bo=((t,e)=>n=>t(n)||e(n))(ss,Ki),Lo=((t,e,n,r,i,s,o,a,u,c,l)=>(h,f)=>{const d=o(h)?h:s(h);if(i.has(f)){const t=n();return Promise.reject(t)}try{i.add(f)}catch(p){}return e(u,(()=>u(d)))?d.decodeAudioData(f).then((n=>(e(a,(()=>a(n)))||l(n),t.add(n),n))):new Promise(((e,n)=>{const i=async()=>{try{await(t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((r=>{n.onmessage=()=>{e.close(),n.close(),r()},e.postMessage(t,[t])}))})(f)}catch(p){}},s=t=>{n(t),i()};try{d.decodeAudioData(f,(n=>{"function"!=typeof n.copyFromChannel&&(c(n),Jn(n)),t.add(n),i().then((()=>e(n)))}),(t=>{s(null===t?r():t)}))}catch(o){s(o)}}))})(fs,Vi,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,Qi,Bo,Zn,Qr,gs,_s),Wo=(Uo=Po,zo=hs,Ho=ys,Go=Vs,Xo=qs,Yo=Js,Qo=Ks,Zo=eo,$o=ro,Jo=Lo,Ko=io,ta=ao,ea=uo,na=po,ra=_o,ia=yo,sa=Co,oa=Oo,aa=Mo,ua=Do,class extends ra{constructor(t,e){super(t,e),this._nativeContext=t,this._audioWorklet=void 0===Uo?void 0:{addModule:(t,e)=>Uo(this,t,e)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new zo(this)}createBiquadFilter(){return new Xo(this)}createBuffer(t,e,n){return new Ho({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new Go(this)}createChannelMerger(t=6){return new Yo(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new Qo(this,{numberOfOutputs:t})}createConstantSource(){return new Zo(this)}createConvolver(){return new $o(this)}createDelay(t=1){return new Ko(this,{maxDelayTime:t})}createDynamicsCompressor(){return new ta(this)}createGain(){return new ea(this)}createIIRFilter(t,e){return new na(this,{feedback:e,feedforward:t})}createOscillator(){return new ia(this)}createPanner(){return new sa(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new oa(this,s(s({},n),{imag:e,real:t}))}createStereoPanner(){return new aa(this)}createWaveShaper(){return new ua(this)}decodeAudioData(t,e,n){return Jo(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t))).catch((t=>{throw"function"==typeof n&&n(t),t}))}});var Uo,zo,Ho,Go,Xo,Yo,Qo,Zo,$o,Jo,Ko,ta,ea,na,ra,ia,sa,oa,aa,ua;const ca=((t,e,n,r)=>class extends t{constructor(t,i){const s=n(t),o=e(s,i);if(r(s))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(cs,((t,e)=>t.createMediaElementSource(e.mediaElement)),Qi,Ki),la=((t,e,n,r)=>class extends t{constructor(t,i){const o=n(t);if(r(o))throw new TypeError;const a=s(s({},Yr),i),u=e(o,a);super(t,!1,u,null),this._nativeMediaStreamAudioDestinationNode=u}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(cs,((t,e)=>{const n=t.createMediaStreamDestination();return $r(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),Qi,Ki),ha=((t,e,n,r)=>class extends t{constructor(t,i){const s=n(t),o=e(s,i);if(r(s))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(cs,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i}),Qi,Ki),fa=((t,e,n)=>class extends t{constructor(t,r){const i=n(t);super(t,!0,e(i,r),null)}})(cs,((t,e)=>(n,{mediaStreamTrack:r})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=n.createMediaStreamSource(i);if("audio"!==r.kind)throw t();if(e(n))throw new TypeError;return s})(zr,Ki),Qi),da=((t,e,n,r,i,s,o,a,u)=>class extends t{constructor(t={}){if(null===u)throw new Error("Missing the native AudioContext constructor.");const e=new u(t);if(null===e)throw r();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:s}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/s:"interactive"===i||void 0===i?256/s:"playback"===i?1024/s:128*Math.max(2,Math.min(128,Math.round(i*s/128)))/s,this._nativeAudioContext=e,"webkitAudioContext"===u.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),ar(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(Wo,zr,fi,(()=>new DOMException("","UnknownError")),ca,la,ha,fa,is),pa=(ma=go,t=>{const e=ma.get(t);if(void 0===e)throw new Error("The context has no set of AudioWorkletNodes.");return e});var ma;const ga=(_a=pa,(t,e)=>{_a(t).add(e)});var _a;const va=(t=>(e,n,r=0,i=0)=>{const s=e[r];if(void 0===s)throw t();return Sr(n)?s.connect(n,0,i):s.connect(n,0)})($n),ya=(t=>(e,n)=>{t(e).delete(n)})(pa),ba=(t=>(e,n,r,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?Lr(t,e,n).disconnect():Sr(n)?void 0===r?e.forEach((t=>t.disconnect(n))):void 0===i?Lr(t,e,r).disconnect(n,0):Lr(t,e,r).disconnect(n,0,i):void 0===r?e.forEach((t=>t.disconnect(n))):Lr(t,e,r).disconnect(n,0))($n),xa=new WeakMap,wa=(Aa=xa,Ta=Bn,t=>Ta(Aa,t));var Aa,Ta;const Sa=((t,e,n,r,i,o,a,u,c,l,h,f,d)=>(p,m,g,_)=>{if(0===_.numberOfInputs&&0===_.numberOfOutputs)throw c();const v=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(v.some((t=>t<1)))throw c();if(v.length!==_.numberOfOutputs)throw e();if("explicit"!==_.channelCountMode)throw c();const y=_.channelCount*_.numberOfInputs,b=v.reduce(((t,e)=>t+e),0),x=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length;if(y+x>6||b>6)throw c();const w=new MessageChannel,A=[],T=[];for(let t=0;t<_.numberOfInputs;t+=1)A.push(a(p,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),T.push(i(p,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const S=[];if(void 0!==g.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:r}of g.parameterDescriptors){const i=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==_.parameterData[r]?_.parameterData[r]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?er:e},minValue:{get:()=>void 0===n?tr:n}}),S.push(i)}const k=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+x)}),C=ni(m,p.sampleRate),O=u(p,C,y+x,Math.max(1,b)),E=i(p,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),M=[];for(let t=0;t<_.numberOfOutputs;t+=1)M.push(r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[t]}));for(let t=0;t<_.numberOfInputs;t+=1){A[t].connect(T[t]);for(let e=0;e<_.channelCount;e+=1)T[t].connect(k,e,t*_.channelCount+e)}const I=new Er(void 0===g.parameterDescriptors?[]:g.parameterDescriptors.map((({name:t},e)=>{const n=S[e];return n.connect(k,0,y+e),n.start(0),[t,n.offset]})));k.connect(O);let D=_.channelInterpretation,R=null;const N=0===_.numberOfOutputs?[O]:M,V={get bufferSize(){return C},get channelCount(){return _.channelCount},set channelCount(t){throw n()},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of A)e.channelInterpretation=t;D=t},get context(){return O.context},get inputs(){return A},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return R},set onprocessorerror(t){"function"==typeof R&&V.removeEventListener("processorerror",R),R="function"==typeof t?t:null,"function"==typeof R&&V.addEventListener("processorerror",R)},get parameters(){return I},get port(){return w.port2},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,N),disconnect:l.bind(null,N),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])},j=new Map;var F,P;w.port1.addEventListener=(F=w.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=j.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{h(p.currentTime,p.sampleRate,(()=>e(t)))},j.set(e,t[1]))}}return F.call(w.port1,t[0],t[1],t[2])}),w.port1.removeEventListener=(P=w.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=j.get(t[1]);void 0!==e&&(j.delete(t[1]),t[1]=e)}return P.call(w.port1,t[0],t[1],t[2])});let q=null;Object.defineProperty(w.port1,"onmessage",{get:()=>q,set:t=>{"function"==typeof q&&w.port1.removeEventListener("message",q),q="function"==typeof t?t:null,"function"==typeof q&&(w.port1.addEventListener("message",q),w.port1.start())}}),g.prototype.port=w.port1;let B=null;((t,e,n,r)=>{let i=Nn.get(t);void 0===i&&(i=new WeakMap,Nn.set(t,i));const s=ri(n,r);return i.set(e,s),s})(p,V,g,_).then((t=>B=t));const L=Rr(_.numberOfInputs,_.channelCount),W=Rr(_.numberOfOutputs,v),U=void 0===g.parameterDescriptors?[]:g.parameterDescriptors.reduce(((t,{name:e})=>s(s({},t),{[e]:new Float32Array(128)})),{});let z=!0;const H=()=>{_.numberOfOutputs>0&&O.disconnect(E);for(let t=0,e=0;t<_.numberOfOutputs;t+=1){const n=M[t];for(let r=0;r<v[t];r+=1)E.disconnect(n,e+r,r);e+=v[t]}},G=new Map;O.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==B){const r=f(V);for(let i=0;i<C;i+=128){for(let e=0;e<_.numberOfInputs;e+=1)for(let n=0;n<_.channelCount;n+=1)Ir(t,L[e],n,n,i);void 0!==g.parameterDescriptors&&g.parameterDescriptors.forEach((({name:e},n)=>{Ir(t,U,e,y+n,i)}));for(let t=0;t<_.numberOfInputs;t+=1)for(let e=0;e<v[t];e+=1)0===W[t][e].byteLength&&(W[t][e]=new Float32Array(128));try{const t=L.map(((t,e)=>{if(r[e].size>0)return G.set(e,C/128),t;const n=G.get(e);return void 0===n?[]:(t.every((t=>t.every((t=>0===t))))&&(1===n?G.delete(e):G.set(e,n-1)),t)})),n=h(p.currentTime+i/p.sampleRate,p.sampleRate,(()=>B.process(t,W,U)));z=n;for(let r=0,s=0;r<_.numberOfOutputs;r+=1){for(let t=0;t<v[r];t+=1)Dr(e,W[r],t,s+t,i);s+=v[r]}}catch(n){z=!1,V.dispatchEvent(new ErrorEvent("processorerror",{colno:n.colno,filename:n.filename,lineno:n.lineno,message:n.message}))}if(!z){for(let t=0;t<_.numberOfInputs;t+=1){A[t].disconnect(T[t]);for(let e=0;e<_.channelCount;e+=1)T[i].disconnect(k,e,t*_.channelCount+e)}if(void 0!==g.parameterDescriptors){const t=g.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=S[e];t.disconnect(k,0,y+e),t.stop()}}k.disconnect(O),O.onaudioprocess=null,X?H():Z();break}}}};let X=!1;const Y=a(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Q=()=>O.connect(Y).connect(p.destination),Z=()=>{O.disconnect(Y),Y.disconnect()};return Q(),d(V,(()=>{if(z){Z(),_.numberOfOutputs>0&&O.connect(E);for(let t=0,e=0;t<_.numberOfOutputs;t+=1){const n=M[t];for(let r=0;r<v[t];r+=1)E.connect(n,e+r,r);e+=v[t]}}X=!0}),(()=>{z&&(Q(),H()),X=!1}))})(va,$n,zr,$s,si,to,ui,hi,fi,ba,No,wa,Ys),ka=((t,e,n,r,i)=>(o,a,u,c,l,h)=>{if(null!==u)try{const e=new u(o,c,h),r=new Map;let a=null;if(Object.defineProperties(e,{channelCount:{get:()=>h.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>a,set:t=>{"function"==typeof a&&e.removeEventListener("processorerror",a),a="function"==typeof t?t:null,"function"==typeof a&&e.addEventListener("processorerror",a)}}}),e.addEventListener=(d=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=r.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],s({},n)))},r.set(e,t[1]))}}return d.call(e,"error",t[1],t[2]),d.call(e,...t)}),e.removeEventListener=(f=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=r.get(t[1]);void 0!==e&&(r.delete(t[1]),t[1]=e)}return f.call(e,"error",t[1],t[2]),f.call(e,t[0],t[1],t[2])}),0!==h.numberOfOutputs){const t=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(o.destination);return i(e,(()=>t.disconnect()),(()=>t.connect(o.destination)))}return e}catch(p){if(11===p.code)throw r();throw p}var f,d;if(void 0===l)throw r();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(h),e(o,a,l,h)})(zr,Sa,ui,fi,Ys),Ca=((t,e,n,r,i,s,o,a,u,c,l,h,f,d,p,m)=>(g,_,v)=>{const y=new WeakMap;let b=null;return{render(x,w,A){a(w,x);const T=y.get(w);return void 0!==T?Promise.resolve(T):(async(a,x,w)=>{let A=l(a),T=null;const S=Qn(A,x),k=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=k.reduce(((t,e)=>t+e),0),n=i(x,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),s=[];for(let e=0;e<a.numberOfOutputs;e+=1)s.push(r(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:k[e]}));const c=o(x,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});c.connect=e.bind(null,s),c.disconnect=u.bind(null,s),T=[n,s,c]}else S||(A=new h(x,g));if(y.set(x,null===T?A:T[2]),null!==T){if(null===b){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===f)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=t+e,u=async()=>{const u=new f(n,128*Math.ceil(a.context.length/128),x.sampleRate),c=[],l=[];for(let t=0;t<_.numberOfInputs;t+=1)c.push(o(u,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),l.push(i(u,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=s(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(u,t,e.offset,w),e}))),g=r(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){c[t].connect(l[t]);for(let e=0;e<_.channelCount;e+=1)l[t].connect(g,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(g,0,t+e),n.start(0);return g.connect(u.destination),await Promise.all(c.map((t=>p(a,u,t,w)))),m(u)};b=Nr(a,0===n?null:await u(),x,_,k,v,c)}const t=await b,e=n(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[u,l,h]=T;null!==t&&(e.buffer=t,e.start(0)),e.connect(u);for(let n=0,r=0;n<a.numberOfOutputs;n+=1){const t=l[n];for(let e=0;e<k[n];e+=1)u.connect(t,r+e,e);r+=k[n]}return h}if(S)for(const[e,n]of a.parameters.entries())await t(x,n,A.parameters.get(e),w);else for(const[t,e]of a.parameters.entries())await d(x,e,A.parameters.get(t),w);return await p(a,x,A,w),A})(x,w,A)}}})(Cs,va,Es,$s,si,to,ui,ya,ba,No,yr,Fo,$i,Is,zi,lo),Oa=(Ea=Vo,t=>Ea.get(t));var Ea;const Ma=(t=>(e,n)=>{t.set(e,n)})(xa),Ia=Ro?((t,e,n,r,i,o,a,u,c,l,h,f,d)=>class extends e{constructor(e,d,p){var m;const g=u(e),_=c(g),v=h(s(s({},Mr),p)),y=Rn.get(g),b=null==y?void 0:y.get(d),x=_||"closed"!==g.state?g:null!==(m=a(g))&&void 0!==m?m:g,w=i(x,_?null:e.baseLatency,l,d,b,v);super(e,!0,w,_?r(d,v,b):null);const A=[];w.parameters.forEach(((t,e)=>{const r=n(this,_,t);A.push([e,r])})),this._nativeAudioWorkletNode=w,this._onprocessorerror=null,this._parameters=new Er(A),_&&t(g,this);const{activeInputs:T}=o(this);f(w,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(ga,cs,Rs,Ca,ka,ir,Oa,Qi,Ki,Fo,(t=>s(s({},t),{outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),Ma,ki):void 0,Da=((t,e)=>(n,r,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,i)}catch(s){if("SyntaxError"===s.name)throw t();throw s}})(fi,$i),Ra=((t,e,n,r,i,s,o,a)=>{const u=[];return(c,l)=>n(c).render(c,l,u).then((()=>Promise.all(Array.from(r(l)).map((t=>n(t).render(t,l,u)))))).then((()=>i(l))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),Jn(n)):e(s,(()=>s(n)))||a(n),t.add(n),n)))})(fs,Vi,Wi,pa,lo,Zn,gs,_s),Na=((t,e,n,r,i)=>class extends t{constructor(t,n,i){let o;if("number"==typeof t&&void 0!==n&&void 0!==i)o={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");o=t}const{length:a,numberOfChannels:u,sampleRate:c}=s(s({},di),o),l=r(u,a,c);e(Qr,(()=>Qr(l)))||l.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(l.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(l,u),this._length=a,this._nativeOfflineAudioContext=l,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,ar(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(Wo,Vi,zr,Da,Ra),Va=((t,e)=>n=>{const r=t.get(n);return e(r)||e(n)})(Mn,ss),ja=(Fa=Cn,Pa=as,t=>Fa.has(t)||Pa(t));var Fa,Pa;const qa=(Ba=En,La=us,t=>Ba.has(t)||La(t));var Ba,La;const Wa=((t,e)=>n=>{const r=t.get(n);return e(r)||e(n)})(Mn,Ki);function Ua(t,e){if(!t)throw new Error(e)}function za(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function Ha(t){t.isOffline||"running"===t.state||Xa('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Ga=console;function Xa(...t){Ga.warn(...t)}function Ya(t){return void 0===t}function Qa(t){return!Ya(t)}function Za(t){return"number"==typeof t}function $a(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Ja(t){return"boolean"==typeof t}function Ka(t){return Array.isArray(t)}function tu(t){return"string"==typeof t}function eu(t){return tu(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const nu="object"==typeof self?self:null,ru=nu&&(nu.hasOwnProperty("AudioContext")||nu.hasOwnProperty("webkitAudioContext"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function iu(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function su(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(e){s(e)}}function a(t){try{u(r.throw(t))}catch(e){s(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))}class ou{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function au(t){return qa(t)}function uu(t){return ja(t)}function cu(t){return Wa(t)}function lu(t){return Va(t)}function hu(t){return t instanceof AudioBuffer}function fu(t,e){return"value"===t||au(e)||uu(e)||hu(e)}function du(t,...e){if(!e.length)return t;const n=e.shift();if($a(t)&&$a(n))for(const r in n)fu(r,n[r])?t[r]=n[r]:$a(n[r])?(t[r]||Object.assign(t,{[r]:{}}),du(t[r],n[r])):Object.assign(t,{[r]:n[r]});return du(t,...e)}function pu(t,e,n=[],r){const i={},s=Array.from(e);if($a(s[0])&&r&&!Reflect.has(s[0],r)){Object.keys(s[0]).some((e=>Reflect.has(t,e)))||(du(i,{[r]:s[0]}),n.splice(n.indexOf(r),1),s.shift())}if(1===s.length&&$a(s[0]))du(i,s[0]);else for(let o=0;o<n.length;o++)Qa(s[o])&&(i[n[o]]=s[o]);return du(t,i)}function mu(t,e){return Ya(t)?e:t}function gu(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class _u{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||nu&&this.toString()===nu.TONE_DEBUG_CLASS)&&function(...t){Ga.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}_u.version="14.7.77";function vu(t,e){return t>e+1e-6}function yu(t,e){return vu(t,e)||xu(t,e)}function bu(t,e){return t+1e-6<e}function xu(t,e){return Math.abs(t-e)<1e-6}function wu(t,e,n){return Math.max(Math.min(t,n),e)}class Au extends _u{constructor(){super(),this.name="Timeline",this._timeline=[];const t=pu(Au.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Ua(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Ua(yu(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(xu(this._timeline[e].time,t)){for(let n=e;n>=0&&xu(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&yu(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][e]<=t)return r-1;for(;n<i;){let r=Math.floor(n+(i-n)/2);const s=this._timeline[r],o=this._timeline[r+1];if(xu(s[e],t)){for(let n=r;n<this._timeline.length;n++){if(!xu(this._timeline[n][e],t))break;r=n}return r}if(bu(s[e],t)&&vu(o[e],t))return r;vu(s[e],t)?i=r:n=r+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let r=this._search(t),i=this._search(e);return-1!==r&&-1!==i?(this._timeline[r].time!==t&&(r+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,r,i)):-1===r&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&xu(this._timeline[n].time,t)){let r=n;for(let e=n;e>=0&&xu(this._timeline[e].time,t);e--)r=e;this._iterate((t=>{e(t)}),r,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Tu=[];function Su(t){Tu.push(t)}const ku=[];function Cu(t){ku.push(t)}class Ou extends _u{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Ya(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...r)=>{e(...r),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((n=>{if(Ya(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Ya(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,r=n.length;t<r;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(Ou.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Eu extends Ou{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Mu extends Eu{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Au,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=pu(Mu.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new da(t)}({latencyHint:t.latencyHint}),this._ticker=new ou(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,Tu.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){Ua(lu(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){Ua(lu(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){Ua(lu(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Ua(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Ua(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Ua(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Ua(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return Ua(Qa(Ia),"This node only works in a secure context (https or localhost)"),new Ia(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return su(this,void 0,void 0,(function*(){Ua(Qa(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return su(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,tu(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return lu(this._context)?this._context.resume():Promise.resolve()}close(){return su(this,void 0,void 0,(function*(){var t;lu(this._context)&&(yield this._context.close()),this._initialized&&(t=this,ku.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=t;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=e,r.loop=!0,r.start(0),this._constants.set(t,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),r()},id:n,time:i+e})};return r(),n}}function Iu(t,e){Ka(e)?e.forEach((e=>Iu(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function Du(t,e){Ka(e)?e.forEach((e=>Du(t,e))):Object.defineProperty(t,e,{writable:!0})}const Ru=()=>{};class Nu extends _u{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ru;const t=pu(Nu.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&hu(t.url)||t.url instanceof Nu?this.set(t.url):tu(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:Ru,onload:Ru,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Pu().sampleRate}set(t){return t instanceof Nu?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return su(this,void 0,void 0,(function*(){const e=Nu.load(t).then((t=>{this.set(t),this.onload(this)}));Nu.downloads.push(e);try{yield e}finally{const t=Nu.downloads.indexOf(e);Nu.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Ka(t)&&t[0].length>0,n=e?t.length:1,r=e?t[0].length:t.length,i=Pu(),s=i.createBuffer(n,r,i.sampleRate),o=e||1!==n?t:[t];for(let a=0;a<n;a++)s.copyToChannel(o[a],a);return this._buffer=s,this}toMono(t){if(Za(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Za(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),r=Math.floor(e*this.sampleRate);Ua(n<r,"The start time must be less than the end time");const i=r-n,s=Pu().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let o=0;o<this.numberOfChannels;o++)s.copyToChannel(this.getChannelData(o).subarray(n,r),o);return new Nu(s)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new Nu).fromArray(t)}static fromUrl(t){return su(this,void 0,void 0,(function*(){const e=new Nu;return yield e.load(t)}))}static load(t){return su(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let r=n[0];for(const t of n)if(Nu.supportsType(t)){r=t;break}t=t.replace(e[0],r)}const n=""===Nu.baseUrl||Nu.baseUrl.endsWith("/")?Nu.baseUrl:Nu.baseUrl+"/",r=yield fetch(n+t);if(!r.ok)throw new Error(`could not load url: ${t}`);const i=yield r.arrayBuffer();return yield Pu().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return su(this,void 0,void 0,(function*(){for(yield Promise.resolve();Nu.downloads.length;)yield Nu.downloads[0]}))}}Nu.baseUrl="",Nu.downloads=[];class Vu extends Mu{constructor(){var t,e,n;super({clockSource:"offline",context:cu(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new Na(t,e,n)),lookAhead:0,updateInterval:cu(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=cu(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return su(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return su(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Nu(e)}))}close(){return Promise.resolve()}}const ju=new class extends Eu{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return su(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let Fu=ju;function Pu(){var t;return Fu===ju&&ru&&(t=new Mu,Fu=lu(t)?new Mu(t):cu(t)?new Vu(t):t),Fu}function qu(){return Fu.resume()}if(nu&&!nu.TONE_SILENCE_LOGGING){const t=` * Tone.js ${"v"}14.7.77 * `;console.log(`%c${t}`,"background: #000; color: #fff")}function Bu(t){return Math.pow(2,t/12)}let Lu=440;function Wu(t){return Math.round(Uu(t))}function Uu(t){return 69+12*Math.log2(t/Lu)}function zu(t){return Lu*Math.pow(2,(t-69)/12)}class Hu extends _u{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),r="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/n)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let r=0;return t&&"0"!==t&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(r+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(r+=this._beatsToUnits(parseFloat(n)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Hu&&this.fromType(this._val),Ya(this._val))return this._noArg();if(tu(this._val)&&Ya(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if($a(this._val)){let t=0;for(const e in this._val)if(Qa(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Qa(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return tu(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Gu extends Hu{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Gu(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),r=this.valueOf();return r+(Math.round(r/n)*n-r)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const t=Math.pow(2,i);e.push(t+"n."),e.push(t+"n"),e.push(t+"t")}e.push("0");let n=e[0],r=new Gu(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Gu(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(r-t)&&(n=e,r=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let r=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=r.toString();i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3)));return[n,e,r].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Wu(this.toFrequency())}_now(){return this.context.now()}}class Xu extends Gu{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Lu}static set A4(t){!function(t){Lu=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Xu.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Yu[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:Xu.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let r=1;return t&&"0"!==t&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(r*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}})}transpose(t){return new Xu(this.context,this.valueOf()*Bu(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return Wu(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Xu.A4);let n=Math.round(12*e)+57;const r=Math.floor(n/12);r<0&&(n+=-12*r);return Qu[n%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return zu(t)}static ftom(t){return Wu(t)}}const Yu={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Qu=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Zu extends Gu{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class $u extends _u{constructor(){super();const t=pu($u.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Pu()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Gu(this.context,t).toSeconds()}toFrequency(t){return new Xu(this.context,t).toFrequency()}toTicks(t){return new Zu(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Ya(t[n])&&delete e[n]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];Qa(n)&&Qa(n.value)&&Qa(n.setValueAtTime)?t[e]=n.value:n instanceof $u?t[e]=n._getPartialProperties(t[e]):Ka(n)||Za(n)||tu(n)||Ja(n)?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Qa(this[e])&&(this[e]&&Qa(this[e].value)&&Qa(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof $u?this[e].set(t[e]):this[e]=t[e])})),this}}class Ju extends Au{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return za(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let r=n;r<this._timeline.length;r++){const e=this._timeline[r];if(e.state===t)return e}}}class Ku extends $u{constructor(){super(pu(Ku.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=pu(Ku.getDefaults(),arguments,["param","units","convert"]);for(Ua(Qa(t.param)&&(au(t.param)||t.param instanceof Ku),"param must be an AudioParam");!au(t.param);)t.param=t.param._param;this._swappable=!!Qa(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Au(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Qa(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign($u.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Qa(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Qa(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Qa(this.maxValue)&&Qa(this.minValue)&&za(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?(e=t,Math.log(e)/Math.LN10*20):t;var e}setValueAtTime(t,e){const n=this.toSeconds(e),r=this._fromType(t);return Ua(isFinite(r)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),r=this._events.get(e);let i=this._initialValue;if(null===r)i=this._initialValue;else if("setTargetAtTime"!==r.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=r.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=r.value;if("setTargetAtTime"===r.type){const e=this._events.getBefore(r.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(r.time,t,n.time,n.value,e):this._exponentialInterpolate(r.time,t,n.time,n.value,e)}else i=r.value;else{const t=this._events.getBefore(r.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===r.type&&(i=this._exponentialApproach(r.time,n,r.value,r.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),r=this.toSeconds(e);return Ua(isFinite(n)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,r),this._param.linearRampToValueAtTime(n,r),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=xu(n,0)?this._minOutput:n,this._assertRange(n);const r=this.toSeconds(e);return Ua(isFinite(n)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,r),this._param.exponentialRampToValueAtTime(n,r),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const r=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,r),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const r=this._fromType(t);Ua(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(r),Ua(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(r,i,n),this}setValueCurveAtTime(t,e,n,r=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*r;this.setValueAtTime(this._toType(i),e);const s=n/(t.length-1);for(let o=1;o<t.length;o++){const n=this._fromType(t[o])*r;this.linearRampToValueAtTime(this._toType(n),e+o*s)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Ua(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));Ua(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const r=this._events.get(e),i=this._events.getAfter(e);return r&&xu(r.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const r=this._events.getAfter(n.time),i=r?r.time:e+2,s=(i-e)/10;for(let n=e;n<i;n+=s)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Ua(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,r,i){return n+(e-n)*Math.exp(-(i-t)/r)}_linearInterpolate(t,e,n,r,i){return e+(i-t)/(n-t)*(r-e)}_exponentialInterpolate(t,e,n,r,i){return e*Math.pow(r/e,(i-t)/(n-t))}}class tc extends $u{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Qa(this.input)?au(this.input)||this.input instanceof Ku?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Qa(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Qa(t)&&(t instanceof tc||uu(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Ua(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return nc(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Xa("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return rc(this,t,e,n),this}chain(...t){return ec(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Qa(this.input)&&(this.input instanceof tc?this.input.dispose():uu(this.input)&&this.input.disconnect()),Qa(this.output)&&(this.output instanceof tc?this.output.dispose():uu(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function ec(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof tc?t.connect(e):uu(t)&&nc(t,e),e)),e)}function nc(t,e,n=0,r=0){for(Ua(Qa(t),"Cannot connect from undefined node"),Ua(Qa(e),"Cannot connect to undefined node"),(e instanceof tc||uu(e))&&Ua(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Ua(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof tc||e instanceof Ku;)Qa(e.input)&&(e=e.input);for(;t instanceof tc;)Qa(t.output)&&(t=t.output);au(e)?t.connect(e,n):t.connect(e,n,r)}function rc(t,e,n=0,r=0){if(Qa(e))for(;e instanceof tc;)e=e.input;for(;!uu(t);)Qa(t.output)&&(t=t.output);au(e)?t.disconnect(e,n):uu(e)?t.disconnect(e,n,r):t.disconnect()}class ic extends tc{constructor(){super(pu(ic.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=pu(ic.getDefaults(),arguments,["gain","units"]);this.gain=new Ku({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),Iu(this,"gain")}static getDefaults(){return Object.assign(tc.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class sc extends tc{constructor(t){super(t),this.onended=Ru,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ic({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(tc.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ru})}_startGain(t,e=1){Ua(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Ua(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ru&&(this.onended(this),this.onended=Ru,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Ua(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class oc extends sc{constructor(){super(pu(oc.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=pu(oc.getDefaults(),arguments,["offset"]);nc(this._source,this._gainNode),this.offset=new Ku({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(sc.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ac extends tc{constructor(){super(pu(ac.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=pu(ac.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new oc({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(tc.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return uc(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,r){return this._param.setValueCurveAtTime(t,e,n,r),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function uc(t,e,n,r){(e instanceof Ku||au(e)||e instanceof ac&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ac&&(e.overridden=!0)),nc(t,e,n,r)}class cc extends Ku{constructor(){super(pu(cc.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Au(1/0),this._multiplier=1;const t=pu(cc.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ku.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const r=this._fromType(t),i=this._events.get(e),s=Math.round(Math.max(1/n,1));for(let o=0;o<=s;o++){const t=n*o+e,s=this._exponentialApproach(i.time,i.value,r,n,t);this.linearRampToValueAtTime(this._toType(s),t)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const r=this._events.get(n),i=this._events.previousEvent(r),s=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(s,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const r=this._events.get(n),i=this._events.previousEvent(r),s=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(s,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),r=this._events.get(e),i=Math.round(Math.max(10*(e-r.time),1)),s=(e-r.time)/i;for(let o=0;o<=i;o++){const t=s*o+r.time,i=this._exponentialInterpolate(r.time,r.value,e,n,t);this.linearRampToValueAtTime(this._toType(i),t)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Ya(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let r=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(r=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+r)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),r=this.getTicksAtTime(e);return this.getTimeOfTick(r+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const r=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-e.time),s=Math.sqrt(Math.pow(r,2)-2*i*(e.ticks-t)),o=(-r+s)/i,a=(-r-s)/i;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),r=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class lc extends ac{constructor(){super(pu(lc.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=pu(lc.getDefaults(),arguments,["value"]);this.input=this._param=new cc({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(ac.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class hc extends $u{constructor(){super(pu(hc.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Ju,this._tickOffset=new Au;const t=pu(hc.getDefaults(),arguments,["frequency"]);this.frequency=new lc({context:this.context,units:t.units,value:t.frequency}),Iu(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},$u.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Qa(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);let i=n,s=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(s=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(s+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(r),s}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let r=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=r.time;const n=this._tickOffset.get(t.time);n&&n.time>=r.time&&(i=n.seconds,e=n.time),"started"===r.state&&"started"!==t.state&&(i+=t.time-e),r=t})),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),r=this._state.get(e),i=Math.max(n.time,r.time),s=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(s)}forEachTickBetween(t,e,n){let r=this._state.get(t);this._state.forEachBetween(t,e,(e=>{r&&"started"===r.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(r.time,t),e.time-this.sampleTime,n),r=e}));let i=null;if(r&&"started"===r.state){const o=Math.max(r.time,t),a=this.frequency.getTicksAtTime(o),u=a-this.frequency.getTicksAtTime(r.time);let c=Math.ceil(u)-u;c=xu(c,1)?0:c;let l=this.frequency.getTimeOfTick(a+c);for(;l<e;){try{n(l,Math.round(this.getTicksAtTime(l)))}catch(s){i=s;break}l+=this.frequency.getDurationOfTicks(1,l)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class fc extends $u{constructor(){super(pu(fc.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Ru,this._lastUpdate=0,this._state=new Ju("stopped"),this._boundLoop=this._loop.bind(this);const t=pu(fc.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new hc({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Iu(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign($u.getDefaults(),{callback:Ru,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Ha(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ou.mixin(fc);class dc extends tc{constructor(){super(pu(dc.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=pu(dc.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new Ku({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),Iu(this,"delayTime")}static getDefaults(){return Object.assign(tc.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class pc extends _u{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=pu(pc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Ru,onload:Ru,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Ua(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=Ru,r=Ru){return tu(e)?this._buffers.set(t.toString(),new Nu(this.baseUrl+e,n,r)):this._buffers.set(t.toString(),new Nu(e,n,r)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class mc extends Xu{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return Wu(super._frequencyToUnits(t))}_ticksToUnits(t){return Wu(super._ticksToUnits(t))}_beatsToUnits(t){return Wu(super._beatsToUnits(t))}_secondsToUnits(t){return Wu(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return zu(this.toMidi())}transpose(t){return new mc(this.context,this.toMidi()+t)}}class gc extends Zu{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class _c extends $u{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Au,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Su((t=>{t.draw=new _c({context:t})})),Cu((t=>{t.draw.dispose()}));class vc extends _u{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Ua(Qa(t.time),"Events must have a time property"),Ua(Qa(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new yc(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),r=t.right;r&&(t.right=r.left,r.left=t),null!==e?n?e.left=r:e.right=r:this._setRoot(r)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),r=t.left;r&&(t.left=r.right,r.right=t),null!==e?n?e.left=r:e.right=r:this._setRoot(r)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class yc{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class bc extends tc{constructor(){super(pu(bc.getDefaults(),arguments,["volume"])),this.name="Volume";const t=pu(bc.getDefaults(),arguments,["volume"]);this.input=this.output=new ic({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,Iu(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(tc.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class xc extends tc{constructor(){super(pu(xc.getDefaults(),arguments)),this.name="Destination",this.input=new bc({context:this.context}),this.output=new ic({context:this.context}),this.volume=this.input.volume;const t=pu(xc.getDefaults(),arguments);ec(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(tc.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),ec(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Su((t=>{t.destination=new xc({context:t})})),Cu((t=>{t.destination.dispose()}));class wc extends _u{constructor(t){super(),this.name="TimelineValue",this._timeline=new Au({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class Ac{constructor(t,e){this.id=Ac._eventId++;const n=Object.assign(Ac.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:Ru,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Ac._eventId=0;class Tc extends Ac{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(Tc.getDefaults(),e);this.duration=new gc(t.context,n.duration).valueOf(),this._interval=new gc(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Ac.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new gc(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new gc(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new gc(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Sc extends $u{constructor(){super(pu(Sc.getDefaults(),arguments)),this.name="Transport",this._loop=new wc(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Au,this._repeatedEvents=new vc,this._syncedSignals=[],this._swingAmount=0;const t=pu(Sc.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new fc({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Iu(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign($u.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),r=Math.sin(n*Math.PI)*this._swingAmount;t+=new gc(this.context,2*this._swingTicks/3).toSeconds()*r}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new Ac(this,{callback:t,time:new Zu(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,r=1/0){const i=new Tc(this,{callback:t,duration:new Gu(this.context,r).toTicks(),interval:new Gu(this.context,e).toTicks(),time:new Zu(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new Ac(this,{callback:t,once:!0,time:new Zu(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new gc(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return Qa(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Ka(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Gu(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Gu(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new gc(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new gc(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),r=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",r),this._clock.setTicksAtTime(t,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const r=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/r}else e=0}const n=new ic(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Du(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ou.mixin(Sc),Su((t=>{t.transport=new Sc({context:t})})),Cu((t=>{t.transport.dispose()}));class kc extends tc{constructor(t){super(t),this.input=void 0,this._state=new Ju("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ru,this._syncedStop=Ru,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new bc({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,Iu(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(tc.getDefaults(),{mute:!1,onstop:Ru,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let r=Ya(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(r=this._clampToCurrentTime(r),this._synced||"started"!==this._state.getValueAtTime(r))if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const t=this._state.get(r);t&&(t.offset=this.toSeconds(mu(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),r);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else Ha(this.context),this._start(r,e,n);else Ua(vu(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,e,n);return this}stop(t){let e=Ya(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Qa(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const r=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-r),this._start(t,this.toSeconds(n.offset)+r,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ru,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Cc extends sc{constructor(){super(pu(Cc.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=pu(Cc.getDefaults(),arguments,["url","onload"]);nc(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ku({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Nu(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(sc.getDefaults(),{url:new Nu,loop:!1,loopEnd:0,loopStart:0,onload:Ru,onerror:Ru,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,r=1){Ua(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,r),e=this.loop?mu(e,this.loopStart):mu(e,0);let s=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;yu(s,t)&&(s=(s-e)%n+e),xu(s,this.buffer.duration)&&(s=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,bu(s,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,s)),Qa(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Oc extends kc{constructor(){super(pu(Oc.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=pu(Oc.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(kc.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(Ua(t in Mc,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=Mc[this._type];this._source=new Cc({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Ec={brown:null,pink:null,white:null},Mc={get brown(){if(!Ec.brown){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;let r=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;n[t]=(r+.02*e)/1.02,r=n[t],n[t]*=3.5}}Ec.brown=(new Nu).fromArray(t)}return Ec.brown},get pink(){if(!Ec.pink){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);let r,i,s,o,a,u,c;t[e]=n,r=i=s=o=a=u=c=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;r=.99886*r+.0555179*e,i=.99332*i+.0750759*e,s=.969*s+.153852*e,o=.8665*o+.3104856*e,a=.55*a+.5329522*e,u=-.7616*u-.016898*e,n[t]=r+i+s+o+a+u+c+.5362*e,n[t]*=.11,c=.115926*e}}Ec.pink=(new Nu).fromArray(t)}return Ec.pink},get white(){if(!Ec.white){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;for(let t=0;t<220500;t++)n[t]=2*Math.random()-1}Ec.white=(new Nu).fromArray(t)}return Ec.white}};function Ic(t,e){return su(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,r=new Vu(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0);return(yield r.render()).getChannelData(0)}))}class Dc extends sc{constructor(){super(pu(Dc.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=pu(Dc.getDefaults(),arguments,["frequency","type"]);nc(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ku({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ku({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),Iu(this,["frequency","detune"])}static getDefaults(){return Object.assign(sc.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Rc extends kc{constructor(){super(pu(Rc.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=pu(Rc.getDefaults(),arguments,["frequency","type"]);this.frequency=new ac({context:this.context,units:"frequency",value:t.frequency}),Iu(this,"frequency"),this.detune=new ac({context:this.context,units:"cents",value:t.detune}),Iu(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(kc.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new Dc({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return Rc._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=Rc._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Qa(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),r=this.context.createPeriodicWave(e,n);this._wave=r,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Rc._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),Rc._periodicWaveCache.length>100&&Rc._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){za(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const r=new Float32Array(n),i=new Float32Array(n);let s=1;if("custom"===t){if(s=this._partials.length+1,this._partialCount=this._partials.length,n=s,0===this._partials.length)return[r,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(s=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],s=Math.max(s,2),n=s):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=s?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(r[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(r[o]=0,i[o]=0)}return[r,i]}_inverseFFT(t,e,n){let r=0;const i=t.length;for(let s=0;s<i;s++)r+=t[s]*Math.cos(s*n)+e[s]*Math.sin(s*n);return r}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const r=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*r),n);return wu(-this._inverseFFT(t,e,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Rc._periodicWaveCache=[];class Nc extends tc{constructor(){super(Object.assign(pu(Nc.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return uc(this,t,e,n),this}}class Vc extends Nc{constructor(){super(Object.assign(pu(Vc.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=pu(Vc.getDefaults(),arguments,["mapping","length"]);Ka(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(ac.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let r=0,i=e;r<i;r++){const e=r/(i-1)*2-1;n[r]=t(e,r)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Ua(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class jc extends Nc{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Vc({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Fc extends ac{constructor(){super(Object.assign(pu(Fc.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=pu(Fc.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new ic({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(ac.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Pc extends kc{constructor(){super(pu(Pc.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new jc({context:this.context}),this._modulationNode=new ic({context:this.context});const t=pu(Pc.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Rc({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Rc({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Fc({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Iu(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Rc.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class qc extends kc{constructor(){super(pu(qc.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new ic({context:this.context,gain:0});const t=pu(qc.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Rc({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new ac({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Rc({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Fc({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Fc({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Iu(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Rc.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Bc extends kc{constructor(){super(pu(Bc.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new ic({context:this.context,gain:0}),this._thresh=new Vc({context:this.context,mapping:t=>t<=0?-1:1});const t=pu(Bc.getDefaults(),arguments,["frequency","width"]);this.width=new ac({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Rc({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Iu(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(kc.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Lc extends kc{constructor(){super(pu(Lc.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=pu(Lc.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new ac({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ac({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,Iu(this,["frequency","detune"])}static getDefaults(){return Object.assign(Rc.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,r)=>t.detune.value=e+n*r))}}get count(){return this._oscillators.length}set count(t){if(za(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new Rc({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):Ru});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class Wc extends kc{constructor(){super(pu(Wc.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Fc({context:this.context,value:2});const t=pu(Wc.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Bc({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Rc({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Iu(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(kc.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Uc={am:Pc,fat:Lc,fm:qc,oscillator:Rc,pulse:Bc,pwm:Wc};class zc extends kc{constructor(){super(pu(zc.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=pu(zc.getDefaults(),arguments,["frequency","type"]);this.frequency=new ac({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ac({context:this.context,units:"cents",value:t.detune}),Iu(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(Rc.getDefaults(),qc.getDefaults(),Pc.getDefaults(),Lc.getDefaults(),Bc.getDefaults(),Wc.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Uc[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof Uc[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Za(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Za(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&tu(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return su(this,void 0,void 0,(function*(){return Ic(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Hc extends ac{constructor(){super(Object.assign(pu(Hc.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new ic({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,ec(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ac.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Gc extends Nc{constructor(){super(Object.assign(pu(Gc.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=pu(Gc.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Fc({context:this.context,value:t.max-t.min}),this._add=this.output=new Hc({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Nc.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Xc extends Nc{constructor(){super(Object.assign(pu(Xc.getDefaults(),arguments))),this.name="Zero",this._gain=new ic({context:this.context}),this.output=this._gain,this.input=void 0,nc(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),rc(this.context.getConstant(0),this._gain),this}}class Yc extends tc{constructor(){super(pu(Yc.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ku.prototype._fromType,this._toType=Ku.prototype._toType,this._is=Ku.prototype._is,this._clampValue=Ku.prototype._clampValue;const t=pu(Yc.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new Rc(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ic({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new ac({context:this.context,units:"audioRange",value:0}),this._zeros=new Xc({context:this.context}),this._a2g=new jc({context:this.context}),this._scaler=this.output=new Gc({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Iu(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(Rc.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof Ku||t instanceof ac)&&(this.convert=t.convert,this.units=t.units),uc(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Qc(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){za(r,t,e),n.set(this,r)}})}}function Zc(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){za(this.toSeconds(r),t,e),n.set(this,r)}})}}class $c extends kc{constructor(){super(pu($c.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=pu($c.getDefaults(),arguments,["url","onload"]);this._buffer=new Nu({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(kc.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ru,onerror:Ru,playbackRate:1,reverse:!1})}load(t){return su(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=Ru){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?mu(e,this._loopStart):mu(e,0);const r=this.toSeconds(e),i=n;n=mu(n,Math.max(this._buffer.duration-r,0));let s=this.toSeconds(n);s/=this._playbackRate,t=this.toSeconds(t);const o=new Cc({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+s),this._state.setStateAtTime("stopped",t+s,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Ya(i)?o.start(t,r):o.start(t,r,s-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&za(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&za(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}iu([Zc(0)],$c.prototype,"fadeIn",void 0),iu([Zc(0)],$c.prototype,"fadeOut",void 0);class Jc extends Nc{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Vc({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Kc extends Nc{constructor(){super(Object.assign(pu(Kc.getDefaults(),arguments,["value"]))),this.name="Pow";const t=pu(Kc.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new Vc({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(Nc.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class tl extends tc{constructor(){super(pu(tl.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new ac({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=pu(tl.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(tc.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(tu(t))return t;{let n;for(n in el)if(el[n][e]===t)return n;return t}}_setCurve(t,e,n){if(tu(n)&&Reflect.has(el,n)){const r=el[n];$a(r)?"_decayCurve"!==t&&(this[t]=r[e]):this[t]=r}else{if(!Ka(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){Ua(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let r=this._attackCurve;for(let t=1;t<r.length;t++)if(r[t-1]<=i&&i<=r[t]){r=this._attackCurve.slice(t),r[0]=i;break}this._sig.setValueCurveAtTime(r,t,n,e)}if(r&&this.sustain<1){const i=e*this.sustain,s=t+n;this.log("decay",s),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,r+s):this._sig.exponentialApproachValueAtTime(i,s,r)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(Ua(Ka(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return uc(this,t,e,n),this}asArray(t=1024){return su(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new Vu(1,e,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),s=.1*i,o=i+s,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(r+s)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}iu([Zc(0)],tl.prototype,"attack",void 0),iu([Zc(0)],tl.prototype,"decay",void 0),iu([Qc(0,1)],tl.prototype,"sustain",void 0),iu([Zc(0)],tl.prototype,"release",void 0);const el=(()=>{const t=128;let e,n;const r=[];for(e=0;e<t;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*n}i[127]=1;const s=[];for(e=0;e<t;e++)s[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,r=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(r*(1-n))}function u(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:u(a),Out:a},cosine:{In:r,Out:(c=r,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:o,Out:u(o)},step:{In:s,Out:u(s)}};var c})();class nl extends tc{constructor(){super(pu(nl.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=pu(nl.getDefaults(),arguments);this._volume=this.output=new bc({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Iu(this,"volume")}static getDefaults(){return Object.assign(tc.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const r=t[e],i=this.context.transport.schedule((r=>{t[e]=r,n.apply(this,t)}),r);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,r){const i=this.toSeconds(n),s=this.toSeconds(e);return this.triggerAttack(t,i,r),this.triggerRelease(i+s),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class rl extends nl{constructor(){super(pu(rl.getDefaults(),arguments));const t=pu(rl.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(nl.getDefaults(),{detune:0,onsilence:Ru,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const r=this.toSeconds(e);return this._triggerEnvelopeAttack(r,n),this.setNote(t,r),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),r=t instanceof Xu?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,t,n)}else this.frequency.setValueAtTime(r,n);return this}}iu([Zc(0)],rl.prototype,"portamento",void 0);class il extends tl{constructor(){super(pu(il.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ic({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class sl extends rl{constructor(){super(pu(sl.getDefaults(),arguments)),this.name="Synth";const t=pu(sl.getDefaults(),arguments);this.oscillator=new zc(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new il(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),Iu(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(rl.getDefaults(),{envelope:Object.assign(gu(tl.getDefaults(),Object.keys(tc.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(gu(zc.getDefaults(),[...Object.keys(kc.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class ol extends tc{constructor(){super(pu(ol.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const t=pu(ol.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Ku({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Ku({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Ku({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Ku({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(tc.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){Ua(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let s=0;s<t;s++){const n=19980*Math.pow(s/t,2)+20;e[s]=n}const n=new Float32Array(t),r=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,n,r),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class al extends tc{constructor(){super(pu(al.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new ic({context:this.context}),this.output=new ic({context:this.context}),this._filters=[];const t=pu(al.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new ac({context:this.context,units:"positive",value:t.Q}),this.frequency=new ac({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ac({context:this.context,units:"cents",value:t.detune}),this.gain=new ac({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,Iu(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(tc.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){Ua(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._type=t,this._filters.forEach((e=>e.type=t))}get rolloff(){return this._rolloff}set rolloff(t){const e=Za(t)?t:parseInt(t,10),n=[-12,-24,-48,-96];let r=n.indexOf(e);Ua(-1!==r,`rolloff can only be ${n.join(", ")}`),r+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach((t=>t.disconnect())),this._filters=new Array(r);for(let i=0;i<r;i++){const t=new ol({context:this.context});t.type=this._type,this.frequency.connect(t.frequency),this.detune.connect(t.detune),this.Q.connect(t.Q),this.gain.connect(t.gain),this._filters[i]=t}this._internalChannels=this._filters,ec(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new ol({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(t).map((()=>1));return this._filters.forEach((()=>{e.getFrequencyResponse(t).forEach(((t,e)=>n[e]*=t))})),e.dispose(),n}dispose(){return super.dispose(),this._filters.forEach((t=>{t.dispose()})),Du(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class ul extends tl{constructor(){super(pu(ul.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const t=pu(ul.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new Kc({context:this.context,value:t.exponent}),this._scale=this.output=new Gc({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(tl.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);za(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class cl extends rl{constructor(){super(pu(cl.getDefaults(),arguments)),this.name="MonoSynth";const t=pu(cl.getDefaults(),arguments);this.oscillator=new zc(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new al(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new ul(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new il(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Iu(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(rl.getDefaults(),{envelope:Object.assign(gu(tl.getDefaults(),Object.keys(tc.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(gu(al.getDefaults(),Object.keys(tc.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(gu(ul.getDefaults(),Object.keys(tc.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(gu(zc.getDefaults(),Object.keys(kc.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class ll extends sl{constructor(){super(pu(ll.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=pu(ll.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,Iu(this,["oscillator","envelope"])}static getDefaults(){return du(rl.getDefaults(),sl.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),r=this.toFrequency(t instanceof Xu?t.toFrequency():t),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(r,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}iu([Qc(0)],ll.prototype,"octaves",void 0),iu([Zc(0)],ll.prototype,"pitchDecay",void 0);class hl extends nl{constructor(){super(pu(hl.getDefaults(),arguments)),this.name="NoiseSynth";const t=pu(hl.getDefaults(),arguments);this.noise=new Oc(Object.assign({context:this.context},t.noise)),this.envelope=new il(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(nl.getDefaults(),{envelope:Object.assign(gu(tl.getDefaults(),Object.keys(tc.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(gu(Oc.getDefaults(),Object.keys(kc.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const fl=new Set;function dl(t){fl.add(t)}function pl(t,e){const n=`registerProcessor("${t}", ${e})`;fl.add(n)}dl('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');dl("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");dl("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");pl("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class ml extends nl{constructor(){super(pu(ml.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const t=pu(ml.getDefaults(),arguments,["voice","options"]);Ua(!Za(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(nl.getDefaults(),{maxPolyphony:32,options:{},voice:sl})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex((e=>e.voice===t));this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}Xa("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,n){t.forEach((t=>{const r=new mc(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,n),this._activeVoices.push({midi:r,voice:i,released:!1}),this.log("triggerAttack",t,e))}))}_triggerRelease(t,e){t.forEach((t=>{const n=new mc(this.context,t).toMidi(),r=this._activeVoices.find((({midi:t,released:e})=>t===n&&!e));r&&(r.voice.triggerRelease(e),r.released=!0,this.log("triggerRelease",t,e))}))}_scheduleEvent(t,e,n,r){Ua(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,r):this._triggerRelease(e,n):this.context.setTimeout((()=>{this._scheduleEvent(t,e,n,r)}),n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);const r=this.toSeconds(e);return this._scheduleEvent("attack",t,r,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("release",t,n),this}triggerAttackRelease(t,e,n,r){const i=this.toSeconds(n);if(this.triggerAttack(t,i,r),Ka(e)){Ua(Ka(t),"If the duration is an array, the notes must also be an array"),t=t;for(let n=0;n<t.length;n++){const r=e[Math.min(n,e.length-1)],s=this.toSeconds(r);Ua(s>0,"The duration must be greater than 0"),this.triggerRelease(t[n],i+s)}}else{const n=this.toSeconds(e);Ua(n>0,"The duration must be greater than 0"),this.triggerRelease(t,i+n)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){const e=gu(t,["onsilence","context"]);return this.options=du(this.options,e),this._voices.forEach((t=>t.set(e))),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach((({voice:t})=>{t.triggerRelease(e)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((t=>t.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class gl extends nl{constructor(){super(pu(gl.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=pu(gl.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const r=parseInt(n,10);if(Ua(eu(n)||Za(r)&&isFinite(r),`url key is neither a note or midi pitch: ${n}`),eu(n)){const r=new Xu(this.context,n).toMidi();e[r]=t.urls[n]}else Za(r)&&isFinite(r)&&(e[r]=t.urls[r])})),this._buffers=new pc({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(nl.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ru,onerror:Ru,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const r=Uu(new Xu(this.context,t).toFrequency()),i=Math.round(r),s=r-i,o=this._findClosest(i),a=i-o,u=this._buffers.get(a),c=Bu(o+s),l=new Cc({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);l.start(e,0,u.duration/c,n),Ka(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(l),l.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(l);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new Xu(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,r=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,r),Ka(e)?(Ua(Ka(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const r=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(r))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(Ua(eu(t)||isFinite(t),`note must be a pitch or midi: ${t}`),eu(t)){const r=new Xu(this.context,t).toMidi();this._buffers.add(r,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}iu([Zc(0)],gl.prototype,"attack",void 0),iu([Zc(0)],gl.prototype,"release",void 0);class _l extends $u{constructor(){super(pu(_l.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new Ju("stopped"),this._startOffset=0;const t=pu(_l.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign($u.getDefaults(),{callback:Ru,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,(t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const n=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||Za(this._loop)&&this._loop>1){e=1/0,Za(this._loop)&&(e=this._loop*this._getLoopDuration());const r=this._state.getAfter(n);null!==r&&(e=Math.min(e,r.time-n)),e!==1/0&&(this._state.setStateAtTime("stopped",n+e+1,{id:-1}),e=new gc(this.context,e));const i=new gc(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new gc(this.context,n),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new gc(this.context,n))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let n=e;null!==t&&(n=t.time),this._rescheduleEvents(n)}return this}cancel(t){t=mu(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,(t=>{this.context.transport.clear(t.id)})),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;Ja(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new gc(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new gc(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const n=this._getLoopDuration();return(t-e.time)%n/n}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class vl extends $u{constructor(){super(pu(vl.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const t=pu(vl.getDefaults(),arguments,["callback","interval"]);this._event=new _l({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign($u.getDefaults(),{interval:"4n",callback:Ru,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class yl extends _l{constructor(){super(pu(yl.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new Ju("stopped"),this._events=new Set;const t=pu(yl.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach((t=>{Ka(t)?this.add(t[0],t[1]):this.add(t)}))}static getDefaults(){return Object.assign(_l.getDefaults(),{events:[]})}start(t,e){const n=this.toTicks(t);if("started"!==this._state.getValueAtTime(n)){e=mu(e,this._loop?this._loopStart:0),e=this._loop?mu(e,this._loopStart):mu(e,0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:n}),this._forEach((e=>{this._startNote(e,n,t)}))}return this}_startNote(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(new gc(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(new gc(this.context,e))):t.startOffset>=n&&t.start(new gc(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach((t=>{t.startOffset+=this._startOffset}))}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach((e=>{e.stop(t)})),this}at(t,e){const n=new Zu(this.context,t).toTicks(),r=new gc(this.context,1).toSeconds(),i=this._events.values();let s=i.next();for(;!s.done;){const t=s.value;if(Math.abs(n-t.startOffset)<r)return Qa(e)&&(t.value=e),t;s=i.next()}return Qa(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const n=this.toTicks(t);let r;return e instanceof _l?(r=e,r.callback=this._tick.bind(this)):r=new _l({callback:this._tick.bind(this),context:this.context,value:e}),r.startOffset=n,r.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(r),this._restartEvent(r),this}_restartEvent(t){this._state.forEach((e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new gc(this.context,e.time))}))}remove(t,e){return $a(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach((n=>{n.startOffset===t&&(Ya(e)||Qa(e)&&n.value===e)&&(this._events.delete(n),n.dispose())})),this}clear(){return this._forEach((t=>t.dispose())),this._events.clear(),this}cancel(t){return this._forEach((e=>e.cancel(t))),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach((e=>{e instanceof yl?e._forEach(t):t(e)})),this}_setAll(t,e){this._forEach((n=>{n[t]=e}))}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach((e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)}))}get loopEnd(){return new gc(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((e=>{e.loopEnd=t,this._testLoopBoundries(e)}))}get loopStart(){return new gc(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*bl(t){let e=0;for(;e<t.length;)e=Al(e,t),yield t[e],e++}function*xl(t){let e=t.length-1;for(;e>=0;)e=Al(e,t),yield t[e],e--}function*wl(t,e){for(;;)yield*e(t)}function Al(t,e){return wu(t,0,e.length-1)}function*Tl(t,e){let n=e?0:t.length-1;for(;;)n=Al(n,t),yield t[n],e?(n++,n>=t.length-1&&(e=!1)):(n--,n<=0&&(e=!0))}function*Sl(t){let e=0,n=0;for(;e<t.length;)e=Al(e,t),yield t[e],n++,e+=n%2?2:-1}function*kl(t){let e=t.length-1,n=0;for(;e>=0;)e=Al(e,t),yield t[e],n++,e+=n%2?-2:1}function*Cl(t){const e=[];for(let n=0;n<t.length;n++)e.push(n);for(;e.length>0;){const n=Al(e.splice(Math.floor(e.length*Math.random()),1)[0],t);yield t[n]}}function*Ol(t,e="up",n=0){switch(Ua(t.length>0,"The array must have more than one value in it"),e){case"up":yield*wl(t,bl);case"down":yield*wl(t,xl);case"upDown":yield*Tl(t,!0);case"downUp":yield*Tl(t,!1);case"alternateUp":yield*wl(t,Sl);case"alternateDown":yield*wl(t,kl);case"random":yield*function*(t){for(;;){const e=Math.floor(Math.random()*t.length);yield t[e]}}(t);case"randomOnce":yield*wl(t,Cl);case"randomWalk":yield*function*(t){let e=Math.floor(Math.random()*t.length);for(;;)0===e?e++:e===t.length-1||Math.random()<.5?e--:e++,yield t[e]}(t)}}class El extends vl{constructor(){super(pu(El.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const t=pu(El.getDefaults(),arguments,["callback","values","pattern"]);this.callback=t.callback,this._values=t.values,this._pattern=Ol(t.values,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(vl.getDefaults(),{pattern:"up",values:[],callback:Ru})}_tick(t){const e=this._pattern.next();this._value=e.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=Ol(this._values,this._type)}}class Ml extends _l{constructor(){super(pu(Ml.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new yl({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const t=pu(Ml.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(gu(_l.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null!==e&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new gc(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,n)=>(tu(e)&&isFinite(parseInt(e,10))&&Ka(n)?t[e]=this._createSequence(n):t[e]=n,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,n){t.forEach(((t,r)=>{const i=r*e+n;if(Ka(t))this._rescheduleSequence(t,e/t.length,i);else{const e=new gc(this.context,i,"i").toSeconds();this._part.add(e,t)}}))}_indexTime(t){return new gc(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=0===t?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class Il extends tc{constructor(){super(Object.assign(pu(Il.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Jc({context:this.context}),this.a=new ic({context:this.context,gain:0}),this.b=new ic({context:this.context,gain:0}),this.output=new ic({context:this.context}),this._internalChannels=[this.a,this.b];const t=pu(Il.getDefaults(),arguments,["fade"]);this.fade=new ac({context:this.context,units:"normalRange",value:t.fade}),Iu(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",nc(this._split,this.a.gain,0),nc(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(tc.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Dl extends tc{constructor(t){super(t),this.name="Effect",this._dryWet=new Il({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ic({context:this.context}),this.effectReturn=new ic({context:this.context}),this.input=new ic({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Iu(this,"wet")}static getDefaults(){return Object.assign(tc.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}pl("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Rl extends tc{constructor(){super(pu(Rl.getDefaults(),arguments,["channels"])),this.name="Split";const t=pu(Rl.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(tc.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Nl extends tc{constructor(){super(pu(Nl.getDefaults(),arguments,["channels"])),this.name="Merge";const t=pu(Nl.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(tc.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Vl extends tc{constructor(t){super(t),this.name="StereoEffect",this.input=new ic({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new Il({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new Rl({context:this.context,channels:2}),this._merge=new Nl({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Iu(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),ec(...t),nc(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),ec(...t),nc(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(tc.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class jl extends Vl{constructor(t){super(t),this.feedback=new ac({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new ic({context:this.context}),this._feedbackR=new ic({context:this.context}),this._feedbackSplit=new Rl({context:this.context,channels:2}),this._feedbackMerge=new Nl({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Iu(this,["feedback"])}static getDefaults(){return Object.assign(Vl.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Fl extends Dl{constructor(){super(pu(Fl.getDefaults(),arguments,["distortion"])),this.name="Distortion";const t=pu(Fl.getDefaults(),arguments,["distortion"]);this._shaper=new Vc({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(Dl.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,n=Math.PI/180;this._shaper.setMap((t=>Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t))))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Pl extends jl{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Iu(this,["feedback"])}}class ql extends Pl{constructor(){super(pu(ql.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const t=pu(ql.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new dc({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new dc({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new dc({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new ac({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Iu(this,["delayTime"])}static getDefaults(){return Object.assign(Pl.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Bl extends tc{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ku({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ku({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ku({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ku({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ku({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ku({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ku({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ku({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ku({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(tc.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function Ll(){return Pu().now()}Su((t=>{t.listener=new Bl({context:t})})),Cu((t=>{t.listener.dispose()}));const Wl=Pu().transport;Pu().destination,Pu().destination,Pu().listener;const Ul=Pu().draw;Pu();var zl="undefined"!=typeof Float32Array?Float32Array:Array;function Hl(t){zl=t}function Gl(){var t=new zl(2);return zl!=Float32Array&&(t[0]=0,t[1]=0),t}function Xl(t,e){var n=new zl(2);return n[0]=t,n[1]=e,n}function Yl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ql(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function Zl(t,e){return t[0]=-e[0],t[1]=-e[1],t}function $l(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function Jl(t){return t[0]=0,t[1]=0,t}function Kl(t,e){var n=t[0],r=t[1],i=e[0],s=e[1];return Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var th=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t};Gl();var eh=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hole=e.pipe=e.untupled=e.tupled=e.absurd=e.decrement=e.increment=e.tuple=e.flow=e.flip=e.constVoid=e.constUndefined=e.constNull=e.constFalse=e.constTrue=e.constant=e.not=e.unsafeCoerce=e.identity=e.getEndomorphismMonoid=e.getRing=e.getSemiring=e.getMonoid=e.getSemigroup=e.getBooleanAlgebra=void 0;e.getBooleanAlgebra=function(t){return function(){return{meet:function(e,n){return function(r){return t.meet(e(r),n(r))}},join:function(e,n){return function(r){return t.join(e(r),n(r))}},zero:function(){return t.zero},one:function(){return t.one},implies:function(e,n){return function(r){return t.implies(e(r),n(r))}},not:function(e){return function(n){return t.not(e(n))}}}}};e.getSemigroup=function(t){return function(){return{concat:function(e,n){return function(r){return t.concat(e(r),n(r))}}}}};e.getMonoid=function(t){var n=e.getSemigroup(t);return function(){return{concat:n().concat,empty:function(){return t.empty}}}};e.getSemiring=function(t){return{add:function(e,n){return function(r){return t.add(e(r),n(r))}},zero:function(){return t.zero},mul:function(e,n){return function(r){return t.mul(e(r),n(r))}},one:function(){return t.one}}};e.getRing=function(t){var n=e.getSemiring(t);return{add:n.add,mul:n.mul,one:n.one,zero:n.zero,sub:function(e,n){return function(r){return t.sub(e(r),n(r))}}}};function n(t){return t}function r(t){return function(){return t}}function i(t){throw new Error("Called `absurd` function which should be uncallable")}e.getEndomorphismMonoid=function(){return{concat:function(t,e){return function(n){return e(t(n))}},empty:n}},e.identity=n,e.unsafeCoerce=n,e.not=function(t){return function(e){return!t(e)}},e.constant=r,e.constTrue=r(!0),e.constFalse=r(!1),e.constNull=r(null),e.constUndefined=r(void 0),e.constVoid=e.constUndefined,e.flip=function(t){return function(e,n){return t(n,e)}},e.flow=function(t,e,n,r,i,s,o,a,u){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return n(e(t.apply(this,arguments)))};case 4:return function(){return r(n(e(t.apply(this,arguments))))};case 5:return function(){return i(r(n(e(t.apply(this,arguments)))))};case 6:return function(){return s(i(r(n(e(t.apply(this,arguments))))))};case 7:return function(){return o(s(i(r(n(e(t.apply(this,arguments)))))))};case 8:return function(){return a(o(s(i(r(n(e(t.apply(this,arguments))))))))};case 9:return function(){return u(a(o(s(i(r(n(e(t.apply(this,arguments)))))))))}}},e.tuple=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.increment=function(t){return t+1},e.decrement=function(t){return t-1},e.absurd=i,e.tupled=function(t){return function(e){return t.apply(void 0,e)}},e.untupled=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t(e)}},e.pipe=function(t,e,n,r,i,s,o,a,u,c,l,h,f,d,p,m,g,_,v,y){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return i(r(n(e(t))));case 6:return s(i(r(n(e(t)))));case 7:return o(s(i(r(n(e(t))))));case 8:return a(o(s(i(r(n(e(t)))))));case 9:return u(a(o(s(i(r(n(e(t))))))));case 10:return c(u(a(o(s(i(r(n(e(t)))))))));case 11:return l(c(u(a(o(s(i(r(n(e(t))))))))));case 12:return h(l(c(u(a(o(s(i(r(n(e(t)))))))))));case 13:return f(h(l(c(u(a(o(s(i(r(n(e(t))))))))))));case 14:return d(f(h(l(c(u(a(o(s(i(r(n(e(t)))))))))))));case 15:return p(d(f(h(l(c(u(a(o(s(i(r(n(e(t))))))))))))));case 16:return m(p(d(f(h(l(c(u(a(o(s(i(r(n(e(t)))))))))))))));case 17:return g(m(p(d(f(h(l(c(u(a(o(s(i(r(n(e(t))))))))))))))));case 18:return _(g(m(p(d(f(h(l(c(u(a(o(s(i(r(n(e(t)))))))))))))))));case 19:return v(_(g(m(p(d(f(h(l(c(u(a(o(s(i(r(n(e(t))))))))))))))))));case 20:return y(v(_(g(m(p(d(f(h(l(c(u(a(o(s(i(r(n(e(t)))))))))))))))))))}},e.hole=i})),nh=u((function(t,e){function n(t,e,r){return function(i){for(var s=Array(r.length+1),o=0;o<r.length;o++)s[o]=r[o];return s[r.length]=i,0===e?t.apply(null,s):n(t,e-1,s)}}Object.defineProperty(e,"__esModule",{value:!0}),e.sequenceS=e.sequenceT=e.getApplySemigroup=e.apS=e.apSecond=e.apFirst=e.ap=void 0,e.ap=function(t,e){return function(n){return function(r){return t.ap(t.map(r,(function(t){return function(n){return e.ap(t,n)}})),n)}}},e.apFirst=function(t){return function(e){return function(n){return t.ap(t.map(n,(function(t){return function(){return t}})),e)}}},e.apSecond=function(t){return function(e){return function(n){return t.ap(t.map(n,(function(){return function(t){return t}})),e)}}},e.apS=function(t){return function(e,n){return function(r){return t.ap(t.map(r,(function(t){return function(n){var r;return Object.assign({},t,((r={})[e]=n,r))}})),n)}}},e.getApplySemigroup=function(t){return function(e){return{concat:function(n,r){return t.ap(t.map(n,(function(t){return function(n){return e.concat(t,n)}})),r)}}}};var r={1:function(t){return[t]},2:function(t){return function(e){return[t,e]}},3:function(t){return function(e){return function(n){return[t,e,n]}}},4:function(t){return function(e){return function(n){return function(r){return[t,e,n,r]}}}},5:function(t){return function(e){return function(n){return function(r){return function(i){return[t,e,n,r,i]}}}}}};function i(t){return r.hasOwnProperty(t)||(r[t]=n(eh.tuple,t-1,[])),r[t]}e.sequenceT=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=e.length,s=i(r),o=t.map(e[0],s),a=1;a<r;a++)o=t.ap(o,e[a]);return o}},e.sequenceS=function(t){return function(e){for(var r=Object.keys(e),i=r.length,s=function(t){var e=t.length;switch(e){case 1:return function(e){var n;return(n={})[t[0]]=e,n};case 2:return function(e){return function(n){var r;return(r={})[t[0]]=e,r[t[1]]=n,r}};case 3:return function(e){return function(n){return function(r){var i;return(i={})[t[0]]=e,i[t[1]]=n,i[t[2]]=r,i}}};case 4:return function(e){return function(n){return function(r){return function(i){var s;return(s={})[t[0]]=e,s[t[1]]=n,s[t[2]]=r,s[t[3]]=i,s}}}};case 5:return function(e){return function(n){return function(r){return function(i){return function(s){var o;return(o={})[t[0]]=e,o[t[1]]=n,o[t[2]]=r,o[t[3]]=i,o[t[4]]=s,o}}}}};default:return n((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i={},s=0;s<e;s++)i[t[s]]=n[s];return i}),e-1,[])}}(r),o=t.map(e[r[0]],s),a=1;a<i;a++)o=t.ap(o,e[r[a]]);return o}}})),rh=u((function(t,e){function n(t,e){return function(n){return function(r){return t.map(r,(function(t){return e.map(t,n)}))}}}Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctorComposition=e.bindTo=e.flap=e.map=void 0,e.map=n,e.flap=function(t){return function(e){return function(n){return t.map(n,(function(t){return t(e)}))}}},e.bindTo=function(t){return function(e){return function(n){return t.map(n,(function(t){var n;return(n={})[e]=t,n}))}}},e.getFunctorComposition=function(t,e){var r=n(t,e);return{map:function(t,e){return eh.pipe(t,r(e))}}}})),ih=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getApplicativeComposition=e.getApplicativeMonoid=void 0,e.getApplicativeMonoid=function(t){var e=nh.getApplySemigroup(t);return function(n){return{concat:e(n).concat,empty:t.of(n.empty)}}},e.getApplicativeComposition=function(t,e){var n=rh.getFunctorComposition(t,e).map,r=nh.ap(t,e);return{map:n,of:function(n){return t.of(e.of(n))},ap:function(t,e){return eh.pipe(t,r(e))}}}})),sh=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.bind=e.chainFirst=void 0,e.chainFirst=function(t){return function(e){return function(n){return t.chain(n,(function(n){return t.map(e(n),(function(){return n}))}))}}},e.bind=function(t){return function(e,n){return function(r){return t.chain(r,(function(r){return t.map(n(r),(function(t){var n;return Object.assign({},r,((n={})[e]=t,n))}))}))}}}})),oh=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getMonoid=e.getSemigroup=e.io=e.sequenceArray=e.traverseArray=e.traverseArrayWithIndex=e.apS=e.bind=e.bindTo=e.Do=e.FromIO=e.ChainRec=e.MonadIO=e.chainFirst=e.Monad=e.Chain=e.Applicative=e.apSecond=e.apFirst=e.Apply=e.Pointed=e.flap=e.Functor=e.URI=e.fromIO=e.flatten=e.chain=e.of=e.ap=e.map=void 0;var n=function(t,e){return function(){return e(t())}},r=function(t,e){return function(){return t()(e())}},i=function(t,e){return function(){return e(t())()}},s=function(t,e){return function(){for(var n=e(t)();"Left"===n._tag;)n=e(n.left)();return n.right}};e.map=function(t){return function(e){return n(e,t)}};e.ap=function(t){return function(e){return r(e,t)}},e.of=eh.constant;e.chain=function(t){return function(e){return i(e,t)}},e.flatten=e.chain(eh.identity),e.fromIO=eh.identity,e.URI="IO",e.Functor={URI:e.URI,map:n},e.flap=rh.flap(e.Functor),e.Pointed={URI:e.URI,of:e.of},e.Apply={URI:e.URI,map:n,ap:r},e.apFirst=nh.apFirst(e.Apply),e.apSecond=nh.apSecond(e.Apply),e.Applicative={URI:e.URI,map:n,ap:r,of:e.of},e.Chain={URI:e.URI,map:n,ap:r,chain:i},e.Monad={URI:e.URI,map:n,ap:r,of:e.of,chain:i},e.chainFirst=sh.chainFirst(e.Chain),e.MonadIO={URI:e.URI,map:n,ap:r,of:e.of,chain:i,fromIO:e.fromIO},e.ChainRec={URI:e.URI,map:n,ap:r,chain:i,chainRec:s},e.FromIO={URI:e.URI,fromIO:eh.identity},e.Do=e.of({}),e.bindTo=rh.bindTo(e.Functor),e.bind=sh.bind(e.Chain),e.apS=nh.apS(e.Apply);e.traverseArrayWithIndex=function(t){return function(e){return function(){return e.map((function(e,n){return t(n,e)()}))}}};e.traverseArray=function(t){return e.traverseArrayWithIndex((function(e,n){return t(n)}))},e.sequenceArray=e.traverseArray(eh.identity),e.io={URI:e.URI,map:n,of:e.of,ap:r,chain:i,fromIO:e.fromIO,chainRec:s},e.getSemigroup=nh.getApplySemigroup(e.Apply),e.getMonoid=ih.getApplicativeMonoid(e.Applicative)})),ah=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.randomElem=e.randomBool=e.randomRange=e.randomInt=e.random=void 0;function n(t,n){return eh.pipe(e.random,oh.map((function(e){return Math.floor((n-t+1)*e+t)})))}e.random=function(){return Math.random()},e.randomInt=n,e.randomRange=function(t,n){return eh.pipe(e.random,oh.map((function(e){return(n-t)*e+t})))},e.randomBool=eh.pipe(e.random,oh.map((function(t){return t<.5})));e.randomElem=function(t){return eh.pipe(n(0,t.length-1),oh.map((function(e){return t[e]})))}})),uh=u((function(t,e){function n(t){return{equals:function(e,n){return e===n||t(e,n)}}}Object.defineProperty(e,"__esModule",{value:!0}),e.eqDate=e.eqNumber=e.eqString=e.eqBoolean=e.eq=e.strictEqual=e.getStructEq=e.getTupleEq=e.Contravariant=e.getMonoid=e.getSemigroup=e.eqStrict=e.URI=e.contramap=e.tuple=e.struct=e.fromEquals=void 0,e.fromEquals=n;e.struct=function(t){return n((function(e,n){for(var r in t)if(!t[r].equals(e[r],n[r]))return!1;return!0}))};e.tuple=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n((function(e,n){return t.every((function(t,r){return t.equals(e[r],n[r])}))}))};e.contramap=function(t){return function(e){return n((function(n,r){return e.equals(t(n),t(r))}))}},e.URI="Eq",e.eqStrict={equals:function(t,e){return t===e}};var r={equals:function(){return!0}};e.getSemigroup=function(){return{concat:function(t,e){return n((function(n,r){return t.equals(n,r)&&e.equals(n,r)}))}}};e.getMonoid=function(){return{concat:e.getSemigroup().concat,empty:r}},e.Contravariant={URI:e.URI,contramap:function(t,n){return eh.pipe(t,e.contramap(n))}},e.getTupleEq=e.tuple,e.getStructEq=e.struct,e.strictEqual=e.eqStrict.equals,e.eq=e.Contravariant,e.eqBoolean=e.eqStrict,e.eqString=e.eqStrict,e.eqNumber=e.eqStrict,e.eqDate={equals:function(t,e){return t.valueOf()===e.valueOf()}}})),ch=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ordDate=e.ordNumber=e.ordString=e.ordBoolean=e.ord=e.getDualOrd=e.getTupleOrd=e.between=e.clamp=e.max=e.min=e.geq=e.leq=e.gt=e.lt=e.Contravariant=e.getMonoid=e.getSemigroup=e.URI=e.contramap=e.reverse=e.tuple=e.fromCompare=e.equalsDefault=void 0;e.equalsDefault=function(t){return function(e,n){return e===n||0===t(e,n)}};e.fromCompare=function(t){return{equals:e.equalsDefault(t),compare:function(e,n){return e===n?0:t(e,n)}}};e.tuple=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.fromCompare((function(e,n){for(var r=0;r<t.length-1;r++){var i=t[r].compare(e[r],n[r]);if(0!==i)return i}return t[r].compare(e[r],n[r])}))};e.reverse=function(t){return e.fromCompare((function(e,n){return t.compare(n,e)}))};e.contramap=function(t){return function(n){return e.fromCompare((function(e,r){return n.compare(t(e),t(r))}))}},e.URI="Ord";e.getSemigroup=function(){return{concat:function(t,n){return e.fromCompare((function(e,r){var i=t.compare(e,r);return 0!==i?i:n.compare(e,r)}))}}};e.getMonoid=function(){return{concat:e.getSemigroup().concat,empty:e.fromCompare((function(){return 0}))}},e.Contravariant={URI:e.URI,contramap:function(t,n){return eh.pipe(t,e.contramap(n))}};e.lt=function(t){return function(e,n){return-1===t.compare(e,n)}};e.gt=function(t){return function(e,n){return 1===t.compare(e,n)}};e.leq=function(t){return function(e,n){return 1!==t.compare(e,n)}};e.geq=function(t){return function(e,n){return-1!==t.compare(e,n)}};e.min=function(t){return function(e,n){return e===n||t.compare(e,n)<1?e:n}};e.max=function(t){return function(e,n){return e===n||t.compare(e,n)>-1?e:n}};e.clamp=function(t){var n=e.min(t),r=e.max(t);return function(t,e){return function(i){return r(n(i,e),t)}}};e.between=function(t){var n=e.lt(t),r=e.gt(t);return function(t,e){return function(i){return!n(i,t)&&!r(i,e)}}},e.getTupleOrd=e.tuple,e.getDualOrd=e.reverse,e.ord=e.Contravariant;var n={equals:uh.eqStrict.equals,compare:function(t,e){return t<e?-1:t>e?1:0}};e.ordBoolean=n,e.ordString=n,e.ordNumber=n,e.ordDate=eh.pipe(e.ordNumber,e.contramap((function(t){return t.valueOf()})))})),lh=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.boundedNumber=void 0,e.boundedNumber={equals:ch.ordNumber.equals,compare:ch.ordNumber.compare,top:1/0,bottom:-1/0}})),hh=u((function(t,e){function n(t,e){var n=e.zero,r=function(i,s){return t.equals(s,n)?i:r(s,e.mod(i,s))};return r}Object.defineProperty(e,"__esModule",{value:!0}),e.fieldNumber=e.lcm=e.gcd=void 0,e.gcd=n,e.lcm=function(t,e){var r=e.zero,i=n(t,e);return function(n,s){return t.equals(n,r)||t.equals(s,r)?r:e.div(e.mul(n,s),i(n,s))}},e.fieldNumber={add:function(t,e){return t+e},zero:0,mul:function(t,e){return t*e},one:1,sub:function(t,e){return t-e},degree:function(t){return 1},div:function(t,e){return t/e},mod:function(t,e){return t%e}}})),fh=u((function(t,e){var n=a&&a.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.fromReadonlyNonEmptyArray=e.has=e.isLeft=e.isSome=void 0;e.isSome=function(t){return"Some"===t._tag};e.isLeft=function(t){return"Left"===t._tag},e.has=Object.prototype.hasOwnProperty;e.fromReadonlyNonEmptyArray=function(t){return n([t[0]],t.slice(1))}})),dh=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.showNumber=e.showString=e.showBoolean=e.getStructShow=e.getTupleShow=e.tuple=e.struct=void 0;var s=i(fh);e.struct=function(t){return{show:function(e){var n="{";for(var r in t)s.has.call(t,r)&&(n+=" "+r+": "+t[r].show(e[r])+",");return n.length>1&&(n=n.slice(0,-1)+" "),n+="}"}}};e.tuple=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return{show:function(e){return"["+e.map((function(e,n){return t[n].show(e)})).join(", ")+"]"}}},e.getTupleShow=e.tuple,e.getStructShow=e.struct,e.showBoolean={show:function(t){return JSON.stringify(t)}},e.showString={show:function(t){return JSON.stringify(t)}},e.showNumber={show:function(t){return JSON.stringify(t)}}})),ph=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.semigroupProduct=e.semigroupSum=e.semigroupString=e.getFunctionSemigroup=e.semigroupAny=e.semigroupAll=e.fold=e.getIntercalateSemigroup=e.getMeetSemigroup=e.getJoinSemigroup=e.getDualSemigroup=e.getStructSemigroup=e.getTupleSemigroup=e.getFirstSemigroup=e.getLastSemigroup=e.getObjectSemigroup=e.concatAll=e.semigroupVoid=e.last=e.first=e.intercalate=e.tuple=e.struct=e.reverse=e.constant=e.max=e.min=void 0;var s=i(fh),o=i(ch);e.min=function(t){return{concat:o.min(t)}};e.max=function(t){return{concat:o.max(t)}};e.constant=function(t){return{concat:function(){return t}}};e.reverse=function(t){return{concat:function(e,n){return t.concat(n,e)}}};e.struct=function(t){return{concat:function(e,n){var r={};for(var i in t)s.has.call(t,i)&&(r[i]=t[i].concat(e[i],n[i]));return r}}};e.tuple=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return{concat:function(e,n){return t.map((function(t,r){return t.concat(e[r],n[r])}))}}};e.intercalate=function(t){return function(e){return{concat:function(n,r){return e.concat(n,e.concat(t,r))}}}};e.first=function(){return{concat:eh.identity}};e.last=function(){return{concat:function(t,e){return e}}},e.semigroupVoid=e.constant(void 0);e.concatAll=function(t){return function(e){return function(n){return n.reduce(t.concat,e)}}};e.getObjectSemigroup=function(){return{concat:function(t,e){return Object.assign({},t,e)}}},e.getLastSemigroup=e.last,e.getFirstSemigroup=e.first,e.getTupleSemigroup=e.tuple,e.getStructSemigroup=e.struct,e.getDualSemigroup=e.reverse,e.getJoinSemigroup=e.max,e.getMeetSemigroup=e.min,e.getIntercalateSemigroup=e.intercalate,e.fold=function(t){var n=e.concatAll(t);return function(t,e){return void 0===e?n(t):n(t)(e)}},e.semigroupAll={concat:function(t,e){return t&&e}},e.semigroupAny={concat:function(t,e){return t||e}},e.getFunctionSemigroup=eh.getSemigroup,e.semigroupString={concat:function(t,e){return t+e}},e.semigroupSum={concat:function(t,e){return t+e}},e.semigroupProduct={concat:function(t,e){return t*e}}})),mh=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.monoidProduct=e.monoidSum=e.monoidString=e.getEndomorphismMonoid=e.getFunctionMonoid=e.monoidAny=e.monoidAll=e.fold=e.getMeetMonoid=e.getJoinMonoid=e.getDualMonoid=e.getStructMonoid=e.getTupleMonoid=e.concatAll=e.monoidVoid=e.tuple=e.struct=e.reverse=e.max=e.min=void 0;var s=i(fh),o=i(ph);e.min=function(t){return{concat:o.min(t).concat,empty:t.top}};e.max=function(t){return{concat:o.max(t).concat,empty:t.bottom}};e.reverse=function(t){return{concat:o.reverse(t).concat,empty:t.empty}};e.struct=function(t){var e={};for(var n in t)s.has.call(t,n)&&(e[n]=t[n].empty);return{concat:o.struct(t).concat,empty:e}};e.tuple=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return{concat:o.tuple.apply(o,t).concat,empty:t.map((function(t){return t.empty}))}},e.monoidVoid={concat:o.semigroupVoid.concat,empty:void 0};e.concatAll=function(t){return o.concatAll(t)(t.empty)},e.getTupleMonoid=e.tuple,e.getStructMonoid=e.struct,e.getDualMonoid=e.reverse,e.getJoinMonoid=e.max,e.getMeetMonoid=e.min,e.fold=e.concatAll,e.monoidAll={concat:o.semigroupAll.concat,empty:!0},e.monoidAny={concat:o.semigroupAny.concat,empty:!1},e.getFunctionMonoid=eh.getMonoid;e.getEndomorphismMonoid=function(){return e.reverse(eh.getEndomorphismMonoid())},e.monoidString={concat:o.semigroupString.concat,empty:""},e.monoidSum={concat:o.semigroupSum.concat,empty:0},e.monoidProduct={concat:o.semigroupProduct.concat,empty:1}})),gh=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MonoidProduct=e.MonoidSum=e.SemigroupProduct=e.SemigroupSum=e.Show=e.Field=e.Bounded=e.Ord=e.Eq=void 0;var s=i(lh),o=i(uh),u=i(hh),c=i(ch),l=i(dh);e.Eq=o.eqNumber,e.Ord=c.ordNumber,e.Bounded=s.boundedNumber,e.Field=u.fieldNumber,e.Show=l.showNumber,e.SemigroupSum=ph.semigroupSum,e.SemigroupProduct=ph.semigroupProduct,e.MonoidSum=mh.monoidSum,e.MonoidProduct=mh.monoidProduct})),_h=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.right=e.left=e.flap=e.Functor=e.Bifunctor=e.URI=e.bimap=e.mapLeft=e.map=e.separated=void 0;e.separated=function(t,e){return{left:t,right:e}};e.map=function(t){return function(n){return e.separated(e.left(n),t(e.right(n)))}};e.mapLeft=function(t){return function(n){return e.separated(t(e.left(n)),e.right(n))}};e.bimap=function(t,n){return function(r){return e.separated(t(e.left(r)),n(e.right(r)))}},e.URI="Separated",e.Bifunctor={URI:e.URI,mapLeft:function(t,n){return eh.pipe(t,e.mapLeft(n))},bimap:function(t,n,r){return eh.pipe(t,e.bimap(n,r))}},e.Functor={URI:e.URI,map:function(t,n){return eh.pipe(t,e.map(n))}},e.flap=rh.flap(e.Functor);e.left=function(t){return t.left};e.right=function(t){return t.right}})),vh=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.getFirstMonoid=e.getOrd=e.getEq=e.getShow=e.URI=e.wilt=e.wither=e.sequence=e.traverse=e.partitionMap=e.partition=e.filterMap=e.filter=e.separate=e.compact=e.reduceRight=e.foldMap=e.reduce=e.duplicate=e.extend=e.throwError=e.zero=e.alt=e.altW=e.flatten=e.chain=e.of=e.ap=e.map=e.toUndefined=e.toNullable=e.chainNullableK=e.fromNullableK=e.tryCatchK=e.tryCatch=e.fromNullable=e.getOrElse=e.getOrElseW=e.fold=e.match=e.foldW=e.matchW=e.fromEither=e.getRight=e.getLeft=e.fromPredicate=e.some=e.none=e.isNone=e.isSome=void 0,e.getApplyMonoid=e.getApplySemigroup=e.option=e.mapNullable=e.sequenceArray=e.traverseArray=e.traverseArrayWithIndex=e.apS=e.bind=e.bindTo=e.Do=e.getRefinement=e.exists=e.elem=e.MonadThrow=e.Witherable=e.Traversable=e.Filterable=e.Compactable=e.Extend=e.Alternative=e.Alt=e.Foldable=e.chainFirst=e.Monad=e.Chain=e.Applicative=e.apSecond=e.apFirst=e.Apply=e.Pointed=e.flap=e.Functor=e.getMonoid=e.getLastMonoid=void 0;var s=i(fh);e.isSome=s.isSome;e.isNone=function(t){return"None"===t._tag},e.none={_tag:"None"};function o(t){return"Right"===t._tag?e.none:e.some(t.left)}function u(t){return"Left"===t._tag?e.none:e.some(t.right)}e.some=function(t){return{_tag:"Some",value:t}},e.fromPredicate=function(t){return function(n){return t(n)?e.some(n):e.none}},e.getLeft=o,e.getRight=u,e.fromEither=u;e.matchW=function(t,n){return function(r){return e.isNone(r)?t():n(r.value)}},e.foldW=e.matchW,e.match=e.matchW,e.fold=e.match;e.getOrElseW=function(t){return function(n){return e.isNone(n)?t():n.value}},e.getOrElse=e.getOrElseW;e.fromNullable=function(t){return null==t?e.none:e.some(t)};e.tryCatch=function(t){try{return e.some(t())}catch(n){return e.none}};e.tryCatchK=function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.tryCatch((function(){return t.apply(void 0,n)}))}};e.fromNullableK=function(t){return eh.flow(t,e.fromNullable)};e.chainNullableK=function(t){return function(n){return e.isNone(n)?e.none:e.fromNullable(t(n.value))}},e.toNullable=e.match(eh.constNull,eh.identity),e.toUndefined=e.match(eh.constUndefined,eh.identity);var c=function(t,n){return eh.pipe(t,e.map(n))},l=function(t,n){return eh.pipe(t,e.ap(n))},h=function(t,n){return eh.pipe(t,e.chain(n))},f=function(t,n,r){return eh.pipe(t,e.reduce(n,r))},d=function(t){var n=e.foldMap(t);return function(t,e){return eh.pipe(t,n(e))}},p=function(t,n,r){return eh.pipe(t,e.reduceRight(n,r))},m=function(t){var n=e.traverse(t);return function(t,e){return eh.pipe(t,n(e))}},g=function(t,n){return eh.pipe(t,e.alt(n))},_=function(t,n){return eh.pipe(t,e.filter(n))},v=function(t,n){return eh.pipe(t,e.filterMap(n))},y=function(t,n){return eh.pipe(t,e.extend(n))},b=function(t,n){return eh.pipe(t,e.partition(n))},x=function(t,n){return eh.pipe(t,e.partitionMap(n))},w=function(t){var n=e.wither(t);return function(t,e){return eh.pipe(t,n(e))}},A=function(t){var n=e.wilt(t);return function(t,e){return eh.pipe(t,n(e))}};e.map=function(t){return function(n){return e.isNone(n)?e.none:e.some(t(n.value))}};e.ap=function(t){return function(n){return e.isNone(n)||e.isNone(t)?e.none:e.some(n.value(t.value))}},e.of=e.some;e.chain=function(t){return function(n){return e.isNone(n)?e.none:t(n.value)}},e.flatten=e.chain(eh.identity);e.altW=function(t){return function(n){return e.isNone(n)?t():n}},e.alt=e.altW;e.zero=function(){return e.none};e.throwError=function(){return e.none};e.extend=function(t){return function(n){return e.isNone(n)?e.none:e.some(t(n))}},e.duplicate=e.extend(eh.identity);e.reduce=function(t,n){return function(r){return e.isNone(r)?t:n(t,r.value)}};e.foldMap=function(t){return function(n){return function(r){return e.isNone(r)?t.empty:n(r.value)}}};e.reduceRight=function(t,n){return function(r){return e.isNone(r)?t:n(r.value,t)}},e.compact=e.flatten;var T=_h.separated(e.none,e.none);e.separate=function(t){return e.isNone(t)?T:_h.separated(o(t.value),u(t.value))};e.filter=function(t){return function(n){return e.isNone(n)?e.none:t(n.value)?n:e.none}};e.filterMap=function(t){return function(n){return e.isNone(n)?e.none:t(n.value)}};e.partition=function(t){return function(e){return _h.separated(_(e,(function(e){return!t(e)})),_(e,t))}};e.partitionMap=function(t){return eh.flow(e.map(t),e.separate)};e.traverse=function(t){return function(n){return function(r){return e.isNone(r)?t.of(e.none):t.map(n(r.value),e.some)}}};e.sequence=function(t){return function(n){return e.isNone(n)?t.of(e.none):t.map(n.value,e.some)}};e.wither=function(t){return function(n){return function(r){return e.isNone(r)?t.of(e.none):n(r.value)}}};function S(t){return{equals:function(n,r){return n===r||(e.isNone(n)?e.isNone(r):!e.isNone(r)&&t.equals(n.value,r.value))}}}e.wilt=function(t){return function(n){return function(r){return e.isNone(r)?t.of(T):t.map(n(r.value),(function(t){return _h.separated(o(t),u(t))}))}}},e.URI="Option",e.getShow=function(t){return{show:function(n){return e.isNone(n)?"none":"some("+t.show(n.value)+")"}}},e.getEq=S,e.getOrd=function(t){return{equals:S(t).equals,compare:function(n,r){return n===r?0:e.isSome(n)?e.isSome(r)?t.compare(n.value,r.value):1:-1}}},e.getFirstMonoid=function(){return{concat:function(t,n){return e.isNone(t)?n:t},empty:e.none}},e.getLastMonoid=function(){return{concat:function(t,n){return e.isNone(n)?t:n},empty:e.none}},e.getMonoid=function(t){return{concat:function(n,r){return e.isNone(n)?r:e.isNone(r)?n:e.some(t.concat(n.value,r.value))},empty:e.none}},e.Functor={URI:e.URI,map:c},e.flap=rh.flap(e.Functor),e.Pointed={URI:e.URI,of:e.of},e.Apply={URI:e.URI,map:c,ap:l},e.apFirst=nh.apFirst(e.Apply),e.apSecond=nh.apSecond(e.Apply),e.Applicative={URI:e.URI,map:c,ap:l,of:e.of},e.Chain={URI:e.URI,map:c,ap:l,chain:h},e.Monad={URI:e.URI,map:c,ap:l,of:e.of,chain:h},e.chainFirst=sh.chainFirst(e.Chain),e.Foldable={URI:e.URI,reduce:f,foldMap:d,reduceRight:p},e.Alt={URI:e.URI,map:c,alt:g},e.Alternative={URI:e.URI,map:c,ap:l,of:e.of,alt:g,zero:e.zero},e.Extend={URI:e.URI,map:c,extend:y},e.Compactable={URI:e.URI,compact:e.compact,separate:e.separate},e.Filterable={URI:e.URI,map:c,compact:e.compact,separate:e.separate,filter:_,filterMap:v,partition:b,partitionMap:x},e.Traversable={URI:e.URI,map:c,reduce:f,foldMap:d,reduceRight:p,traverse:m,sequence:e.sequence},e.Witherable={URI:e.URI,map:c,reduce:f,foldMap:d,reduceRight:p,traverse:m,sequence:e.sequence,compact:e.compact,separate:e.separate,filter:_,filterMap:v,partition:b,partitionMap:x,wither:w,wilt:A},e.MonadThrow={URI:e.URI,map:c,ap:l,of:e.of,chain:h,throwError:e.throwError},e.elem=function(t){return function(n,r){return!e.isNone(r)&&t.equals(n,r.value)}},e.exists=function(t){return function(n){return!e.isNone(n)&&t(n.value)}},e.getRefinement=function(t){return function(n){return e.isSome(t(n))}},e.Do=e.of({}),e.bindTo=rh.bindTo(e.Functor),e.bind=sh.bind(e.Chain),e.apS=nh.apS(e.Apply);e.traverseArrayWithIndex=function(t){return function(n){for(var r=[],i=0;i<n.length;i++){var s=t(i,n[i]);if(e.isNone(s))return e.none;r.push(s.value)}return e.some(r)}};e.traverseArray=function(t){return e.traverseArrayWithIndex((function(e,n){return t(n)}))},e.sequenceArray=e.traverseArray(eh.identity),e.mapNullable=e.chainNullableK,e.option={URI:e.URI,map:c,of:e.of,ap:l,chain:h,reduce:f,foldMap:d,reduceRight:p,traverse:m,sequence:e.sequence,zero:e.zero,alt:g,extend:y,compact:e.compact,separate:e.separate,filter:_,filterMap:v,partition:b,partitionMap:x,wither:w,wilt:A,throwError:e.throwError},e.getApplySemigroup=nh.getApplySemigroup(e.Apply),e.getApplyMonoid=ih.getApplicativeMonoid(e.Applicative)})),yh=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},s=a&&a.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.traverse=e.reduceRightWithIndex=e.foldMapWithIndex=e.reduceWithIndex=e.reduceRight=e.foldMap=e.reduce=e.mapWithIndex=e.map=e.flatten=e.duplicate=e.extend=e.chain=e.ap=e.alt=e.altW=e.of=e.chunksOf=e.splitAt=e.chop=e.chainWithIndex=e.intersperse=e.prependAll=e.unzip=e.zip=e.zipWith=e.modifyAt=e.updateAt=e.sort=e.groupBy=e.groupSort=e.group=e.reverse=e.concat=e.fromArray=e.unappend=e.unprepend=e.fromReadonlyArray=e.makeBy=e.rotate=e.union=e.sortBy=e.uniq=e.unsafeUpdateAt=e.unsafeInsertAt=e.append=e.prepend=e.isOutOfBound=e.isNonEmpty=e.empty=void 0,e.readonlyNonEmptyArray=e.fold=e.prependToAll=e.insertAt=e.snoc=e.cons=e.unsnoc=e.uncons=e.filterWithIndex=e.filter=e.concatAll=e.max=e.min=e.init=e.last=e.tail=e.head=e.apS=e.bind=e.bindTo=e.Do=e.Comonad=e.Alt=e.TraversableWithIndex=e.Traversable=e.FoldableWithIndex=e.Foldable=e.Monad=e.chainFirst=e.Chain=e.Applicative=e.apSecond=e.apFirst=e.Apply=e.FunctorWithIndex=e.Pointed=e.flap=e.Functor=e.getEq=e.getSemigroup=e.getShow=e.URI=e.extract=e.traverseWithIndex=e.sequence=void 0;var o=i(fh),u=i(vh),c=i(ph);e.empty=[];e.isNonEmpty=function(t){return t.length>0};e.isOutOfBound=function(t,e){return t<0||t>=e.length};e.prepend=function(t){return function(e){return s([t],e)}};e.append=function(t){return function(e){return l(e,[t])}};e.unsafeInsertAt=function(t,n,r){if(e.isNonEmpty(r)){var i=o.fromReadonlyNonEmptyArray(r);return i.splice(t,0,n),i}return[n]};e.unsafeUpdateAt=function(t,e,n){if(n[t]===e)return n;var r=o.fromReadonlyNonEmptyArray(n);return r[t]=e,r};e.uniq=function(t){return function(n){if(1===n.length)return n;for(var r=[e.head(n)],i=function(e){r.every((function(n){return!t.equals(n,e)}))&&r.push(e)},s=0,o=e.tail(n);s<o.length;s++){i(o[s])}return r}};e.sortBy=function(t){if(e.isNonEmpty(t)){var n=ch.getMonoid();return e.sort(t.reduce(n.concat,n.empty))}return eh.identity};e.union=function(t){var n=e.uniq(t);return function(t,e){return n(l(t,e))}};e.rotate=function(t){return function(n){var r=n.length,i=Math.round(t)%r;if(e.isOutOfBound(Math.abs(i),n)||0===i)return n;if(i<0){var s=e.splitAt(-i)(n),o=s[0];return l(s[1],o)}return e.rotate(i-r)(n)}};e.makeBy=function(t,e){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r};e.fromReadonlyArray=function(t){return e.isNonEmpty(t)?u.some(t):u.none};e.unprepend=function(t){return[e.head(t),e.tail(t)]};e.unappend=function(t){return[e.init(t),e.last(t)]};function l(t,e){return t.concat(e)}e.fromArray=function(t){return e.fromReadonlyArray(t.slice())},e.concat=l;function h(t){return function(n){var r=n.length;if(0===r)return e.empty;for(var i=[],s=n[0],o=[s],a=1;a<r;a++){var u=n[a];t.equals(u,s)?o.push(u):(i.push(o),o=[s=u])}return i.push(o),i}}e.reverse=function(t){return 1===t.length?t:s([e.last(t)],t.slice(0,-1).reverse())},e.group=h,e.groupSort=function(t){var n=e.sort(t),r=h(t);return function(t){return e.isNonEmpty(t)?r(n(t)):e.empty}};e.groupBy=function(t){return function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=t(s);n.hasOwnProperty(o)?n[o].push(s):n[o]=[s]}return n}};e.sort=function(t){return function(e){return 1===e.length?e:e.slice().sort(t.compare)}};e.updateAt=function(t,n){return e.modifyAt(t,(function(){return n}))};e.modifyAt=function(t,n){return function(r){return e.isOutOfBound(t,r)?u.none:u.some(e.unsafeUpdateAt(t,n(r[t]),r))}};e.zipWith=function(t,e,n){for(var r=[n(t[0],e[0])],i=Math.min(t.length,e.length),s=1;s<i;s++)r[s]=n(t[s],e[s]);return r},e.zip=function t(n,r){return void 0===r?function(e){return t(e,n)}:e.zipWith(n,r,(function(t,e){return[t,e]}))};e.unzip=function(t){for(var e=[t[0][0]],n=[t[0][1]],r=1;r<t.length;r++)e[r]=t[r][0],n[r]=t[r][1];return[e,n]};e.prependAll=function(t){return function(e){for(var n=[t,e[0]],r=1;r<e.length;r++)n.push(t,e[r]);return n}};e.intersperse=function(t){return function(n){var r=e.tail(n);return e.isNonEmpty(r)?eh.pipe(r,e.prependAll(t),e.prepend(e.head(n))):n}};e.chainWithIndex=function(t){return function(n){for(var r=o.fromReadonlyNonEmptyArray(t(0,e.head(n))),i=1;i<n.length;i++)r.push.apply(r,t(i,n[i]));return r}};e.chop=function(t){return function(n){for(var r=t(n),i=[r[0]],s=r[1];e.isNonEmpty(s);){var o=t(s),a=o[0],u=o[1];i.push(a),s=u}return i}};e.splitAt=function(t){return function(n){var r=Math.max(1,t);return r>=n.length?[n,e.empty]:[eh.pipe(n.slice(1,r),e.prepend(e.head(n))),n.slice(r)]}};e.chunksOf=function(t){return e.chop(e.splitAt(t))};var f=function(t,n){return eh.pipe(t,e.map(n))},d=function(t,n){return eh.pipe(t,e.mapWithIndex(n))},p=function(t,n){return eh.pipe(t,e.ap(n))},m=function(t,n){return eh.pipe(t,e.chain(n))},g=function(t,n){return eh.pipe(t,e.extend(n))},_=function(t,n,r){return eh.pipe(t,e.reduce(n,r))},v=function(t){var n=e.foldMap(t);return function(t,e){return eh.pipe(t,n(e))}},y=function(t,n,r){return eh.pipe(t,e.reduceRight(n,r))},b=function(t){var n=e.traverse(t);return function(t,e){return eh.pipe(t,n(e))}},x=function(t,n){return eh.pipe(t,e.alt(n))},w=function(t,n,r){return eh.pipe(t,e.reduceWithIndex(n,r))},A=function(t){var n=e.foldMapWithIndex(t);return function(t,e){return eh.pipe(t,n(e))}},T=function(t,n,r){return eh.pipe(t,e.reduceRightWithIndex(n,r))},S=function(t){var n=e.traverseWithIndex(t);return function(t,e){return eh.pipe(t,n(e))}};e.of=function(t){return[t]};e.altW=function(t){return function(e){return l(e,t())}},e.alt=e.altW;e.ap=function(t){return e.chain((function(n){return eh.pipe(t,e.map(n))}))};e.chain=function(t){return e.chainWithIndex((function(e,n){return t(n)}))};e.extend=function(t){return function(n){for(var r=e.tail(n),i=[t(n)];e.isNonEmpty(r);)i.push(t(r)),r=e.tail(r);return i}},e.duplicate=e.extend(eh.identity),e.flatten=e.chain(eh.identity);e.map=function(t){return e.mapWithIndex((function(e,n){return t(n)}))};e.mapWithIndex=function(t){return function(n){for(var r=[t(0,e.head(n))],i=1;i<n.length;i++)r.push(t(i,n[i]));return r}};e.reduce=function(t,n){return e.reduceWithIndex(t,(function(t,e,r){return n(e,r)}))};e.foldMap=function(t){return function(e){return function(n){return n.slice(1).reduce((function(n,r){return t.concat(n,e(r))}),e(n[0]))}}};e.reduceRight=function(t,n){return e.reduceRightWithIndex(t,(function(t,e,r){return n(e,r)}))};e.reduceWithIndex=function(t,e){return function(n){return n.reduce((function(t,n,r){return e(r,t,n)}),t)}};e.foldMapWithIndex=function(t){return function(e){return function(n){return n.slice(1).reduce((function(n,r,i){return t.concat(n,e(i+1,r))}),e(0,n[0]))}}};e.reduceRightWithIndex=function(t,e){return function(n){return n.reduceRight((function(t,n,r){return e(r,n,t)}),t)}};e.traverse=function(t){var n=e.traverseWithIndex(t);return function(t){return n((function(e,n){return t(n)}))}};e.sequence=function(t){return e.traverseWithIndex(t)((function(t,e){return e}))};e.traverseWithIndex=function(t){return function(n){return function(r){for(var i=t.map(n(0,e.head(r)),e.of),s=1;s<r.length;s++)i=t.ap(t.map(i,(function(t){return function(n){return eh.pipe(t,e.append(n))}})),n(s,r[s]));return i}}};e.extract=function(t){return t[0]},e.URI="ReadonlyNonEmptyArray";e.getShow=function(t){return{show:function(e){return"["+e.map(t.show).join(", ")+"]"}}};e.getSemigroup=function(){return{concat:l}};e.getEq=function(t){return uh.fromEquals((function(e,n){return e.length===n.length&&e.every((function(e,r){return t.equals(e,n[r])}))}))},e.Functor={URI:e.URI,map:f},e.flap=rh.flap(e.Functor),e.Pointed={URI:e.URI,of:e.of},e.FunctorWithIndex={URI:e.URI,map:f,mapWithIndex:d},e.Apply={URI:e.URI,map:f,ap:p},e.apFirst=nh.apFirst(e.Apply),e.apSecond=nh.apSecond(e.Apply),e.Applicative={URI:e.URI,map:f,ap:p,of:e.of},e.Chain={URI:e.URI,map:f,ap:p,chain:m},e.chainFirst=sh.chainFirst(e.Chain),e.Monad={URI:e.URI,map:f,ap:p,of:e.of,chain:m},e.Foldable={URI:e.URI,reduce:_,foldMap:v,reduceRight:y},e.FoldableWithIndex={URI:e.URI,reduce:_,foldMap:v,reduceRight:y,reduceWithIndex:w,foldMapWithIndex:A,reduceRightWithIndex:T},e.Traversable={URI:e.URI,map:f,reduce:_,foldMap:v,reduceRight:y,traverse:b,sequence:e.sequence},e.TraversableWithIndex={URI:e.URI,map:f,mapWithIndex:d,reduce:_,foldMap:v,reduceRight:y,traverse:b,sequence:e.sequence,reduceWithIndex:w,foldMapWithIndex:A,reduceRightWithIndex:T,traverseWithIndex:S},e.Alt={URI:e.URI,map:f,alt:x},e.Comonad={URI:e.URI,map:f,extend:g,extract:e.extract},e.Do=e.of({}),e.bindTo=rh.bindTo(e.Functor),e.bind=sh.bind(e.Chain),e.apS=nh.apS(e.Apply),e.head=e.extract;e.tail=function(t){return t.slice(1)};e.last=function(t){return t[t.length-1]};e.init=function(t){return t.slice(0,-1)};e.min=function(t){var e=c.min(t);return function(t){return t.reduce(e.concat)}};e.max=function(t){var e=c.max(t);return function(t){return t.reduce(e.concat)}};e.concatAll=function(t){return function(e){return e.reduce(t.concat)}},e.filter=function(t){return e.filterWithIndex((function(e,n){return t(n)}))};e.filterWithIndex=function(t){return function(n){return e.fromReadonlyArray(n.filter((function(e,n){return t(n,e)})))}},e.uncons=e.unprepend,e.unsnoc=e.unappend,e.cons=function(t,n){return void 0===n?e.prepend(t):eh.pipe(n,e.prepend(t))};e.snoc=function(t,e){return l(t,[e])};e.insertAt=function(t,n){return function(r){return t<0||t>r.length?u.none:u.some(e.unsafeInsertAt(t,n,r))}},e.prependToAll=e.prependAll,e.fold=e.concatAll,e.readonlyNonEmptyArray={URI:e.URI,of:e.of,map:f,mapWithIndex:d,ap:p,chain:m,extend:g,extract:e.extract,reduce:_,foldMap:v,reduceRight:y,traverse:b,sequence:e.sequence,reduceWithIndex:w,foldMapWithIndex:A,reduceRightWithIndex:T,traverseWithIndex:S,alt:x}})),bh=u((function(t,e){var n=a&&a.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.uniq=e.elem=e.rotate=e.intersperse=e.prependAll=e.unzip=e.zip=e.zipWith=e.sort=e.lefts=e.rights=e.reverse=e.modifyAt=e.deleteAt=e.updateAt=e.insertAt=e.findLastIndex=e.findLastMap=e.findLast=e.findFirstMap=e.findFirst=e.findIndex=e.dropLeftWhile=e.dropRight=e.dropLeft=e.spanLeft=e.takeLeftWhile=e.takeRight=e.takeLeft=e.init=e.tail=e.last=e.head=e.lookup=e.isOutOfBound=e.size=e.isNonEmpty=e.isEmpty=e.scanRight=e.scanLeft=e.chainWithIndex=e.foldRight=e.matchRight=e.foldLeft=e.matchLeft=e.replicate=e.range=e.makeBy=e.append=e.prepend=void 0,e.Pointed=e.flap=e.Functor=e.getOrd=e.getEq=e.getMonoid=e.getSemigroup=e.getShow=e.URI=e.unfold=e.wilt=e.wither=e.traverseWithIndex=e.sequence=e.traverse=e.reduceRightWithIndex=e.reduceRight=e.reduceWithIndex=e.foldMap=e.reduce=e.foldMapWithIndex=e.duplicate=e.extend=e.filterWithIndex=e.partitionMapWithIndex=e.partitionMap=e.partitionWithIndex=e.partition=e.compact=e.filterMap=e.filterMapWithIndex=e.filter=e.separate=e.mapWithIndex=e.map=e.flatten=e.chain=e.ap=e.alt=e.altW=e.zero=e.of=e.difference=e.intersection=e.union=e.comprehension=e.chunksOf=e.splitAt=e.chop=e.sortBy=void 0,e.readonlyArray=e.prependToAll=e.snoc=e.cons=e.apS=e.bind=e.bindTo=e.Do=e.some=e.every=e.empty=e.fromArray=e.toArray=e.unsafeDeleteAt=e.unsafeUpdateAt=e.unsafeInsertAt=e.Witherable=e.TraversableWithIndex=e.Traversable=e.FoldableWithIndex=e.Foldable=e.FilterableWithIndex=e.Filterable=e.Compactable=e.Extend=e.Alternative=e.Alt=e.Unfoldable=e.chainFirst=e.Monad=e.Chain=e.Applicative=e.apSecond=e.apFirst=e.Apply=e.FunctorWithIndex=void 0;var s=i(gh),o=i(vh),u=i(yh);e.prepend=u.prepend,e.append=u.append;e.makeBy=function(t,n){return t<=0?e.empty:u.makeBy(t,n)};e.range=function(t,n){return t<=n?e.makeBy(n-t+1,(function(e){return t+e})):[t]};e.replicate=function(t,n){return e.makeBy(t,(function(){return n}))};e.matchLeft=function(t,n){return function(r){return e.isNonEmpty(r)?n(u.head(r),u.tail(r)):t()}},e.foldLeft=e.matchLeft;e.matchRight=function(t,n){return function(r){return e.isNonEmpty(r)?n(u.init(r),u.last(r)):t()}},e.foldRight=e.matchRight;e.chainWithIndex=function(t){return function(n){if(e.isEmpty(n))return e.empty;for(var r=[],i=0;i<n.length;i++)r.push.apply(r,t(i,n[i]));return r}};e.scanLeft=function(t,e){return function(n){var r=n.length,i=new Array(r+1);i[0]=t;for(var s=0;s<r;s++)i[s+1]=e(i[s],n[s]);return i}};e.scanRight=function(t,e){return function(n){var r=n.length,i=new Array(r+1);i[r]=t;for(var s=r-1;s>=0;s--)i[s]=e(n[s],i[s+1]);return i}};e.isEmpty=function(t){return 0===t.length},e.isNonEmpty=u.isNonEmpty;e.size=function(t){return t.length},e.isOutOfBound=u.isOutOfBound,e.lookup=function t(n,r){return void 0===r?function(e){return t(n,e)}:e.isOutOfBound(n,r)?o.none:o.some(r[n])};e.head=function(t){return e.isNonEmpty(t)?o.some(u.head(t)):o.none};e.last=function(t){return e.isNonEmpty(t)?o.some(u.last(t)):o.none};e.tail=function(t){return e.isNonEmpty(t)?o.some(u.tail(t)):o.none};e.init=function(t){return e.isNonEmpty(t)?o.some(u.init(t)):o.none};e.takeLeft=function(t){return function(n){return e.isOutOfBound(t,n)?n:0===t?e.empty:n.slice(0,t)}};e.takeRight=function(t){return function(n){return e.isOutOfBound(t,n)?n:0===t?e.empty:n.slice(-t)}},e.takeLeftWhile=function(t){return function(n){for(var r=[],i=0,s=n;i<s.length;i++){var o=s[i];if(!t(o))break;r.push(o)}var a=r.length;return a===n.length?n:0===a?e.empty:r}};var c=function(t,e){for(var n=t.length,r=0;r<n&&e(t[r]);r++);return r};e.spanLeft=function(t){return function(n){var r=e.splitAt(c(n,t))(n);return{init:r[0],rest:r[1]}}};e.dropLeft=function(t){return function(n){return t<=0||e.isEmpty(n)?n:t>=n.length?e.empty:n.slice(t,n.length)}};e.dropRight=function(t){return function(n){return t<=0||e.isEmpty(n)?n:t>=n.length?e.empty:n.slice(0,n.length-t)}};e.dropLeftWhile=function(t){return function(n){var r=c(n,t);return 0===r?n:r===n.length?e.empty:n.slice(r)}};e.findIndex=function(t){return function(e){for(var n=0;n<e.length;n++)if(t(e[n]))return o.some(n);return o.none}},e.findFirst=function(t){return function(e){for(var n=0;n<e.length;n++)if(t(e[n]))return o.some(e[n]);return o.none}};e.findFirstMap=function(t){return function(e){for(var n=0;n<e.length;n++){var r=t(e[n]);if(o.isSome(r))return r}return o.none}},e.findLast=function(t){return function(e){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return o.some(e[n]);return o.none}};e.findLastMap=function(t){return function(e){for(var n=e.length-1;n>=0;n--){var r=t(e[n]);if(o.isSome(r))return r}return o.none}};e.findLastIndex=function(t){return function(e){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return o.some(n);return o.none}},e.insertAt=u.insertAt;e.updateAt=function(t,n){return e.modifyAt(t,(function(){return n}))};e.deleteAt=function(t){return function(n){return e.isOutOfBound(t,n)?o.none:o.some(e.unsafeDeleteAt(t,n))}};e.modifyAt=function(t,n){return function(r){return e.isOutOfBound(t,r)?o.none:o.some(e.unsafeUpdateAt(t,n(r[t]),r))}};e.reverse=function(t){return t.length<=1?t:t.slice().reverse()};e.rights=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];"Right"===r._tag&&e.push(r.right)}return e};e.lefts=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];"Left"===r._tag&&e.push(r.left)}return e};e.sort=function(t){return function(e){return e.length<=1?e:e.slice().sort(t.compare)}};e.zipWith=function(t,e,n){for(var r=[],i=Math.min(t.length,e.length),s=0;s<i;s++)r[s]=n(t[s],e[s]);return r},e.zip=function t(n,r){return void 0===r?function(e){return t(e,n)}:e.zipWith(n,r,(function(t,e){return[t,e]}))};e.unzip=function(t){for(var e=[],n=[],r=0;r<t.length;r++)e[r]=t[r][0],n[r]=t[r][1];return[e,n]};e.prependAll=function(t){var n=u.prependAll(t);return function(t){return e.isNonEmpty(t)?n(t):t}};e.intersperse=function(t){var n=u.intersperse(t);return function(t){return e.isNonEmpty(t)?n(t):t}};function l(t){return function(e,n){if(void 0===n){var r=l(t);return function(t){return r(e,t)}}for(var i,s=0;s<n.length;s++)if(i=n[s],t.equals(i,e))return!0;return!1}}e.rotate=function(t){var n=u.rotate(t);return function(t){return e.isNonEmpty(t)?n(t):t}},e.elem=l;e.uniq=function(t){var n=u.uniq(t);return function(t){return e.isNonEmpty(t)?n(t):t}};e.sortBy=function(t){var n=u.sortBy(t);return function(t){return e.isNonEmpty(t)?n(t):t}};e.chop=function(t){var n=u.chop(t);return function(t){return e.isNonEmpty(t)?n(t):e.empty}};e.splitAt=function(t){return function(n){return t>=1&&e.isNonEmpty(n)?u.splitAt(t)(n):e.isEmpty(n)?[n,e.empty]:[e.empty,n]}};e.chunksOf=function(t){var n=u.chunksOf(t);return function(t){return e.isNonEmpty(t)?n(t):e.empty}},e.comprehension=function(t,n,r){void 0===r&&(r=function(){return!0});var i=function(t,s){return e.isNonEmpty(s)?eh.pipe(u.head(s),e.chain((function(n){return i(eh.pipe(t,e.append(n)),u.tail(s))}))):r.apply(void 0,t)?[n.apply(void 0,t)]:e.empty};return i(e.empty,t)},e.union=function t(n){var r=u.union(n);return function(i,s){if(void 0===s){var o=t(n);return function(t){return o(t,i)}}return e.isNonEmpty(i)&&e.isNonEmpty(s)?r(i,s):e.isNonEmpty(i)?i:s}},e.intersection=function t(e){var n=l(e);return function(r,i){if(void 0===i){var s=t(e);return function(t){return s(t,r)}}return r.filter((function(t){return n(t,i)}))}},e.difference=function t(e){var n=l(e);return function(r,i){if(void 0===i){var s=t(e);return function(t){return s(t,r)}}return r.filter((function(t){return!n(t,i)}))}};var h=function(t,n){return eh.pipe(t,e.map(n))},f=function(t,n){return eh.pipe(t,e.mapWithIndex(n))},d=function(t,n){return eh.pipe(t,e.ap(n))},p=function(t,n){return eh.pipe(t,e.chain(n))},m=function(t,n){return eh.pipe(t,e.filter(n))},g=function(t,n){return eh.pipe(t,e.filterMap(n))},_=function(t,n){return eh.pipe(t,e.partition(n))},v=function(t,n){return eh.pipe(t,e.partitionMap(n))},y=function(t,n){return eh.pipe(t,e.partitionWithIndex(n))},b=function(t,n){return eh.pipe(t,e.partitionMapWithIndex(n))},x=function(t,n){return eh.pipe(t,e.alt(n))},w=function(t,n,r){return eh.pipe(t,e.reduce(n,r))},A=function(t){var n=e.foldMap(t);return function(t,e){return eh.pipe(t,n(e))}},T=function(t,n,r){return eh.pipe(t,e.reduceRight(n,r))},S=function(t,n,r){return eh.pipe(t,e.reduceWithIndex(n,r))},k=function(t){var n=e.foldMapWithIndex(t);return function(t,e){return eh.pipe(t,n(e))}},C=function(t,n,r){return eh.pipe(t,e.reduceRightWithIndex(n,r))},O=function(t,n){return eh.pipe(t,e.filterMapWithIndex(n))},E=function(t,n){return eh.pipe(t,e.filterWithIndex(n))},M=function(t,n){return eh.pipe(t,e.extend(n))},I=function(t){var n=e.traverse(t);return function(t,e){return eh.pipe(t,n(e))}},D=function(t){var n=e.traverseWithIndex(t);return function(t,e){return eh.pipe(t,n(e))}},R=function(t){var n=e.wither(t);return function(t,e){return eh.pipe(t,n(e))}},N=function(t){var n=e.wilt(t);return function(t,e){return eh.pipe(t,n(e))}};e.of=u.of;e.zero=function(){return e.empty};e.altW=function(t){return function(e){return e.concat(t())}},e.alt=e.altW;e.ap=function(t){return e.chain((function(n){return eh.pipe(t,e.map(n))}))};e.chain=function(t){return function(n){return eh.pipe(n,e.chainWithIndex((function(e,n){return t(n)})))}},e.flatten=e.chain(eh.identity);e.map=function(t){return function(e){return e.map((function(e){return t(e)}))}};e.mapWithIndex=function(t){return function(e){return e.map((function(e,n){return t(n,e)}))}};e.separate=function(t){for(var e=[],n=[],r=0,i=t;r<i.length;r++){var s=i[r];"Left"===s._tag?e.push(s.left):n.push(s.right)}return _h.separated(e,n)};e.filter=function(t){return function(e){return e.filter(t)}};e.filterMapWithIndex=function(t){return function(e){for(var n=[],r=0;r<e.length;r++){var i=t(r,e[r]);o.isSome(i)&&n.push(i.value)}return n}};e.filterMap=function(t){return e.filterMapWithIndex((function(e,n){return t(n)}))},e.compact=e.filterMap(eh.identity);e.partition=function(t){return e.partitionWithIndex((function(e,n){return t(n)}))};e.partitionWithIndex=function(t){return function(e){for(var n=[],r=[],i=0;i<e.length;i++){var s=e[i];t(i,s)?r.push(s):n.push(s)}return _h.separated(n,r)}};e.partitionMap=function(t){return e.partitionMapWithIndex((function(e,n){return t(n)}))};e.partitionMapWithIndex=function(t){return function(e){for(var n=[],r=[],i=0;i<e.length;i++){var s=t(i,e[i]);"Left"===s._tag?n.push(s.left):r.push(s.right)}return _h.separated(n,r)}};e.filterWithIndex=function(t){return function(e){return e.filter((function(e,n){return t(n,e)}))}};e.extend=function(t){return function(e){return e.map((function(n,r){return t(e.slice(r))}))}},e.duplicate=e.extend(eh.identity);e.foldMapWithIndex=function(t){return function(e){return function(n){return n.reduce((function(n,r,i){return t.concat(n,e(i,r))}),t.empty)}}};e.reduce=function(t,n){return e.reduceWithIndex(t,(function(t,e,r){return n(e,r)}))};e.foldMap=function(t){var n=e.foldMapWithIndex(t);return function(t){return n((function(e,n){return t(n)}))}};e.reduceWithIndex=function(t,e){return function(n){for(var r=n.length,i=t,s=0;s<r;s++)i=e(s,i,n[s]);return i}};e.reduceRight=function(t,n){return e.reduceRightWithIndex(t,(function(t,e,r){return n(e,r)}))};e.reduceRightWithIndex=function(t,e){return function(n){return n.reduceRight((function(t,n,r){return e(r,n,t)}),t)}};e.traverse=function(t){var n=e.traverseWithIndex(t);return function(t){return n((function(e,n){return t(n)}))}};e.sequence=function(t){return function(n){return w(n,t.of(e.zero()),(function(n,r){return t.ap(t.map(n,(function(t){return function(n){return eh.pipe(t,e.append(n))}})),r)}))}};e.traverseWithIndex=function(t){return function(n){return e.reduceWithIndex(t.of(e.zero()),(function(r,i,s){return t.ap(t.map(i,(function(t){return function(n){return eh.pipe(t,e.append(n))}})),n(r,s))}))}};e.wither=function(t){var n=e.traverse(t);return function(r){return function(i){return t.map(eh.pipe(i,n(r)),e.compact)}}};e.wilt=function(t){var n=e.traverse(t);return function(r){return function(i){return t.map(eh.pipe(i,n(r)),e.separate)}}};e.unfold=function(t,e){for(var n=[],r=t;;){var i=e(r);if(!o.isSome(i))break;var s=i.value,a=s[0],u=s[1];n.push(a),r=u}return n},e.URI="ReadonlyArray";e.getShow=function(t){return{show:function(e){return"["+e.map(t.show).join(", ")+"]"}}};e.getSemigroup=function(){return{concat:function(t,n){return e.isEmpty(t)?n:e.isEmpty(n)?t:t.concat(n)}}};e.getMonoid=function(){return{concat:e.getSemigroup().concat,empty:e.empty}};e.getEq=function(t){return uh.fromEquals((function(e,n){return e.length===n.length&&e.every((function(e,r){return t.equals(e,n[r])}))}))};e.getOrd=function(t){return ch.fromCompare((function(e,n){for(var r=e.length,i=n.length,o=Math.min(r,i),a=0;a<o;a++){var u=t.compare(e[a],n[a]);if(0!==u)return u}return s.Ord.compare(r,i)}))},e.Functor={URI:e.URI,map:h},e.flap=rh.flap(e.Functor),e.Pointed={URI:e.URI,of:e.of},e.FunctorWithIndex={URI:e.URI,map:h,mapWithIndex:f},e.Apply={URI:e.URI,map:h,ap:d},e.apFirst=nh.apFirst(e.Apply),e.apSecond=nh.apSecond(e.Apply),e.Applicative={URI:e.URI,map:h,ap:d,of:e.of},e.Chain={URI:e.URI,map:h,ap:d,chain:p},e.Monad={URI:e.URI,map:h,ap:d,of:e.of,chain:p},e.chainFirst=sh.chainFirst(e.Chain),e.Unfoldable={URI:e.URI,unfold:e.unfold},e.Alt={URI:e.URI,map:h,alt:x},e.Alternative={URI:e.URI,map:h,ap:d,of:e.of,alt:x,zero:e.zero},e.Extend={URI:e.URI,map:h,extend:M},e.Compactable={URI:e.URI,compact:e.compact,separate:e.separate},e.Filterable={URI:e.URI,map:h,compact:e.compact,separate:e.separate,filter:m,filterMap:g,partition:_,partitionMap:v},e.FilterableWithIndex={URI:e.URI,map:h,mapWithIndex:f,compact:e.compact,separate:e.separate,filter:m,filterMap:g,partition:_,partitionMap:v,partitionMapWithIndex:b,partitionWithIndex:y,filterMapWithIndex:O,filterWithIndex:E},e.Foldable={URI:e.URI,reduce:w,foldMap:A,reduceRight:T},e.FoldableWithIndex={URI:e.URI,reduce:w,foldMap:A,reduceRight:T,reduceWithIndex:S,foldMapWithIndex:k,reduceRightWithIndex:C},e.Traversable={URI:e.URI,map:h,reduce:w,foldMap:A,reduceRight:T,traverse:I,sequence:e.sequence},e.TraversableWithIndex={URI:e.URI,map:h,mapWithIndex:f,reduce:w,foldMap:A,reduceRight:T,reduceWithIndex:S,foldMapWithIndex:k,reduceRightWithIndex:C,traverse:I,sequence:e.sequence,traverseWithIndex:D},e.Witherable={URI:e.URI,map:h,compact:e.compact,separate:e.separate,filter:m,filterMap:g,partition:_,partitionMap:v,reduce:w,foldMap:A,reduceRight:T,traverse:I,sequence:e.sequence,wither:R,wilt:N},e.unsafeInsertAt=u.unsafeInsertAt;e.unsafeUpdateAt=function(t,n,r){return e.isNonEmpty(r)?u.unsafeUpdateAt(t,n,r):r};e.unsafeDeleteAt=function(t,e){var n=e.slice();return n.splice(t,1),n};e.toArray=function(t){return t.slice()};e.fromArray=function(t){return e.isEmpty(t)?e.empty:t.slice()},e.empty=u.empty;e.every=function(t){return function(e){return e.every(t)}};e.some=function(t){return function(e){return e.some(t)}},e.Do=e.of({}),e.bindTo=rh.bindTo(e.Functor),e.bind=sh.bind(e.Chain),e.apS=nh.apS(e.Apply),e.cons=u.cons,e.snoc=u.snoc,e.prependToAll=e.prependAll,e.readonlyArray={URI:e.URI,compact:e.compact,separate:e.separate,map:h,ap:d,of:e.of,chain:p,filter:m,filterMap:g,partition:_,partitionMap:v,mapWithIndex:f,partitionMapWithIndex:b,partitionWithIndex:y,filterMapWithIndex:O,filterWithIndex:E,alt:x,zero:e.zero,unfold:e.unfold,reduce:w,foldMap:A,reduceRight:T,traverse:I,sequence:e.sequence,reduceWithIndex:S,foldMapWithIndex:k,reduceRightWithIndex:C,traverseWithIndex:D,extend:M,wither:R,wilt:N}}));export{Nt as A,Lt as B,bh as C,Ul as D,Qt as E,c as F,rn as G,l as H,Yc as L,cl as M,hl as N,ml as P,ah as R,Ml as S,Wl as T,bc as V,X as _,$ as a,Rt as b,kt as c,Xl as d,Bt as e,Xt as f,Yl as g,$l as h,Gl as i,Ql as j,Zl as k,G as l,Wt as m,Et as n,Kl as o,zt as p,Hl as q,Ll as r,th as s,Gt as t,ql as u,qu as v,Fl as w,ll as x,El as y,Jl as z};
